(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[411],{2272:function(e,t,r){"use strict";r.r(t);var n=r(6992),i=r(7294),a=(r(8938),function(e){n.L.call(this,e)});a.prototype=Object.assign(Object.create(n.L.prototype),{constructor:a,load:function(e,t,r,i){var a=this,o=new n.F(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(r){try{t(a.parse(r))}catch(l){i?i(l):console.error(l),a.manager.itemError(e)}}),r,i)},parse:function(e){function t(e,t,r){for(var n=0,i=e.length;n<i;n++)if(e[n]!==t.getUint8(r+n,!1))return!1;return!0}var r,i=function(e){if("string"===typeof e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}(e);return function(e){var r;if(50,84+50*(r=new DataView(e)).getUint32(80,!0)===r.byteLength)return!0;for(var n=[115,111,108,105,100],i=0;i<5;i++)if(t(n,r,i))return!1;return!0}(i)?function(e){for(var t,r,i,a,o,s,c,u,l=new DataView(e),p=l.getUint32(80,!0),h=!1,f=0;f<70;f++)1129270351==l.getUint32(f,!1)&&82==l.getUint8(f+4)&&61==l.getUint8(f+5)&&(h=!0,a=new Float32Array(3*p*3),o=l.getUint8(f+6)/255,s=l.getUint8(f+7)/255,c=l.getUint8(f+8)/255,u=l.getUint8(f+9)/255);for(var d=new n.B,v=new Float32Array(3*p*3),m=new Float32Array(3*p*3),g=0;g<p;g++){var y=84+50*g,E=l.getFloat32(y,!0),T=l.getFloat32(y+4,!0),x=l.getFloat32(y+8,!0);if(h){var A=l.getUint16(y+48,!0);0===(32768&A)?(t=(31&A)/31,r=(A>>5&31)/31,i=(A>>10&31)/31):(t=o,r=s,i=c)}for(var b=1;b<=3;b++){var w=y+12*b,R=3*g*3+3*(b-1);v[R]=l.getFloat32(w,!0),v[R+1]=l.getFloat32(w+4,!0),v[R+2]=l.getFloat32(w+8,!0),m[R]=E,m[R+1]=T,m[R+2]=x,h&&(a[R]=t,a[R+1]=r,a[R+2]=i)}}return d.setAttribute("position",new n.c(v,3)),d.setAttribute("normal",new n.c(m,3)),h&&(d.setAttribute("color",new n.c(a,3)),d.hasColors=!0,d.alpha=u),d}(i):function(e){for(var t,r=new n.B,i=/solid([\s\S]*?)endsolid/g,a=/facet([\s\S]*?)endfacet/g,o=0,s=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,c=new RegExp("vertex"+s+s+s,"g"),u=new RegExp("normal"+s+s+s,"g"),l=[],p=[],h=new n.V,f=0,d=0,v=0;null!==(t=i.exec(e));){d=v;for(var m=t[0];null!==(t=a.exec(m));){for(var g=0,y=0,E=t[0];null!==(t=u.exec(E));)h.x=parseFloat(t[1]),h.y=parseFloat(t[2]),h.z=parseFloat(t[3]),y++;for(;null!==(t=c.exec(E));)l.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),p.push(h.x,h.y,h.z),g++,v++;1!==y&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+o),3!==g&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+o),o++}var T=d,x=v-d;r.addGroup(T,x,f),f++}return r.setAttribute("position",new n.d(l,3)),r.setAttribute("normal",new n.d(p,3)),r}("string"!==typeof(r=e)?n.f.decodeText(new Uint8Array(r)):r)}});var o=function(){function e(e){n.L.call(this,e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new o(e)})),this.register((function(e){return new c(e)})),this.register((function(e){return new u(e)})),this.register((function(e){return new s(e)})),this.register((function(e){return new i(e)})),this.register((function(e){return new p(e)}))}function t(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(n.L.prototype),{constructor:e,load:function(e,t,r,i){var a,o=this;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:n.f.extractUrlBase(e),this.manager.itemStart(e);var s=function(t){i?i(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},c=new n.F(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,(function(r){try{o.parse(r,a,(function(r){t(r),o.manager.itemEnd(e)}),s)}catch(l){s(l)}}),r,s)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')},setKTX2Loader:function(e){return this.ktx2Loader=e,this},setMeshoptDecoder:function(e){return this.meshoptDecoder=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(e,t,i,o){var s,c={},u={};if("string"===typeof e)s=e;else if(n.f.decodeText(new Uint8Array(e,0,4))===h){try{c[r.KHR_BINARY_GLTF]=new v(e)}catch(A){return void(o&&o(A))}s=c[r.KHR_BINARY_GLTF].content}else s=n.f.decodeText(new Uint8Array(e));var l=JSON.parse(s);if(void 0===l.asset||l.asset.version[0]<2)o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var p=new W(l,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});p.fileLoader.setRequestHeader(this.requestHeader);for(var f=0;f<this.pluginCallbacks.length;f++){var d=this.pluginCallbacks[f](p);u[d.name]=d,c[d.name]=!0}if(l.extensionsUsed)for(f=0;f<l.extensionsUsed.length;++f){var y=l.extensionsUsed[f],x=l.extensionsRequired||[];switch(y){case r.KHR_MATERIALS_UNLIT:c[y]=new a;break;case r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:c[y]=new E;break;case r.KHR_DRACO_MESH_COMPRESSION:c[y]=new m(l,this.dracoLoader);break;case r.KHR_TEXTURE_TRANSFORM:c[y]=new g;break;case r.KHR_MESH_QUANTIZATION:c[y]=new T;break;default:x.indexOf(y)>=0&&void 0===u[y]&&console.warn('THREE.GLTFLoader: Unknown extension "'+y+'".')}}p.setExtensions(c),p.setPlugins(u),p.parse(i,o)}}});var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};function i(e){this.parser=e,this.name=r.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function a(){this.name=r.KHR_MATERIALS_UNLIT}function o(e){this.parser=e,this.name=r.KHR_MATERIALS_CLEARCOAT}function s(e){this.parser=e,this.name=r.KHR_MATERIALS_TRANSMISSION}function c(e){this.parser=e,this.name=r.KHR_TEXTURE_BASISU}function u(e){this.parser=e,this.name=r.EXT_TEXTURE_WEBP,this.isSupported=null}function p(e){this.name=r.EXT_MESHOPT_COMPRESSION,this.parser=e}i.prototype._markDefs=function(){for(var e=this.parser,t=this.parser.json.nodes||[],r=0,n=t.length;r<n;r++){var i=t[r];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}},i.prototype._loadLight=function(e){var t=this.parser,r="light:"+e,i=t.cache.get(r);if(i)return i;var a,o=t.json,s=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e],c=new n.C(16777215);void 0!==s.color&&c.fromArray(s.color);var u=void 0!==s.range?s.range:0;switch(s.type){case"directional":(a=new n._(c)).target.position.set(0,0,-1),a.add(a.target);break;case"point":(a=new n.Z(c)).distance=u;break;case"spot":(a=new n.Y(c)).distance=u,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,a.angle=s.spot.outerConeAngle,a.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return a.position.set(0,0,0),a.decay=2,void 0!==s.intensity&&(a.intensity=s.intensity),a.name=t.createUniqueName(s.name||"light_"+e),i=Promise.resolve(a),t.cache.add(r,i),i},i.prototype.createNodeAttachment=function(e){var t=this,r=this.parser,n=r.json.nodes[e],i=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(e){return r._getNodeRef(t.cache,i,e)}))},a.prototype.getMaterialType=function(){return n.g},a.prototype.extendParams=function(e,t,r){var i=[];e.color=new n.C(1,1,1),e.opacity=1;var a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){var o=a.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==a.baseColorTexture&&i.push(r.assignTexture(e,"map",a.baseColorTexture))}return Promise.all(i)},o.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.$:null},o.prototype.extendMaterialParams=function(e,t){var r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var a=[],o=i.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&a.push(r.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&a.push(r.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(a.push(r.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){var s=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new n.a(s,-s)}return Promise.all(a)},s.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.$:null},s.prototype.extendMaterialParams=function(e,t){var r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var i=[],a=n.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&i.push(r.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(i)},c.prototype.loadTexture=function(e){var t=this.parser,r=t.json,n=r.textures[e];if(!n.extensions||!n.extensions[this.name])return null;var i=n.extensions[this.name],a=r.images[i.source],o=t.options.ktx2Loader;if(!o){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a,o)},u.prototype.loadTexture=function(e){var t=this.name,r=this.parser,n=r.json,i=n.textures[e];if(!i.extensions||!i.extensions[t])return null;var a=i.extensions[t],o=n.images[a.source],s=r.textureLoader;if(o.uri){var c=r.options.manager.getHandler(o.uri);null!==c&&(s=c)}return this.detectSupport().then((function(i){if(i)return r.loadTextureImage(e,o,s);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)}))},u.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported},p.prototype.loadBufferView=function(e){var t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){var n=r.extensions[this.name],i=this.parser.getDependency("buffer",n.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,a.ready]).then((function(e){var t=n.byteOffset||0,r=n.byteLength||0,i=n.count,o=n.byteStride,s=new ArrayBuffer(i*o),c=new Uint8Array(e[0],t,r);return a.decodeGltfBuffer(new Uint8Array(s),i,o,c,n.mode,n.filter),s}))}return null};var h="glTF",f=1313821514,d=5130562;function v(e){this.name=r.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,12);if(this.header={magic:n.f.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==h)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var i=this.header.length-12,a=new DataView(e,12),o=0;o<i;){var s=a.getUint32(o,!0);o+=4;var c=a.getUint32(o,!0);if(o+=4,c===f){var u=new Uint8Array(e,12+o,s);this.content=n.f.decodeText(u)}else if(c===d){var l=12+o;this.body=e.slice(l,l+s)}o+=s}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function m(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=r.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function g(){this.name=r.KHR_TEXTURE_TRANSFORM}function y(e){n.h.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),r=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),a=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),s={specular:{value:(new n.C).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(e){for(var n in s)e.uniforms[n]=s[n];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",a).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(e){s.specular.value=e}},specularMap:{get:function(){return s.specularMap.value},set:function(e){s.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return s.glossiness.value},set:function(e){s.glossiness.value=e}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(e){s.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function E(){return{name:r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return y},extendParams:function(e,t,r){var i=t.extensions[this.name];e.color=new n.C(1,1,1),e.opacity=1;var a=[];if(Array.isArray(i.diffuseFactor)){var o=i.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(void 0!==i.diffuseTexture&&a.push(r.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new n.C(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new n.C(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var s=i.specularGlossinessTexture;a.push(r.assignTexture(e,"glossinessMap",s)),a.push(r.assignTexture(e,"specularMap",s))}return Promise.all(a)},createMaterial:function(e){var t=new y(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=n.i,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function T(){this.name=r.KHR_MESH_QUANTIZATION}function x(e,t,r,i){n.a0.call(this,e,t,r,i)}m.prototype.decodePrimitive=function(e,t){var r=this.json,n=this.dracoLoader,i=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},c={};for(var u in a){var l=C[u]||u.toLowerCase();o[l]=a[u]}for(u in e.attributes){l=C[u]||u.toLowerCase();if(void 0!==a[u]){var p=r.accessors[e.attributes[u]],h=k[p.componentType];c[l]=h,s[l]=!0===p.normalized}}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t){n.decodeDracoFile(e,(function(e){for(var r in e.attributes){var n=e.attributes[r],i=s[r];void 0!==i&&(n.normalized=i)}t(e)}),o,c)}))}))},g.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},y.prototype=Object.create(n.h.prototype),y.prototype.constructor=y,y.prototype.copy=function(e){return n.h.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},x.prototype=Object.create(n.a0.prototype),x.prototype.constructor=x,x.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n*3+n,a=0;a!==n;a++)t[a]=r[i+a];return t},x.prototype.beforeStart_=x.prototype.copySampleValue_,x.prototype.afterEnd_=x.prototype.copySampleValue_,x.prototype.interpolate_=function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,c=3*o,u=n-t,l=(r-t)/u,p=l*l,h=p*l,f=e*c,d=f-c,v=-2*h+3*p,m=h-p,g=1-v,y=m-p+l,E=0;E!==o;E++){var T=a[d+E+o],x=a[d+E+s]*u,A=a[f+E+o],b=a[f+E]*u;i[E]=g*T+y*x+v*A+m*b}return i};var A=0,b=1,w=2,R=3,N=4,_=5,S=6,k={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},I={9728:n.a1,9729:n.m,9984:n.a2,9985:n.a3,9986:n.a4,9987:n.n},L={33071:n.a5,33648:n.a6,10497:n.o},O={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},C={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},M={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},P={CUBICSPLINE:void 0,LINEAR:n.J,STEP:n.a7},F="OPAQUE",D="MASK",U="BLEND";function j(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function V(e,t,r){for(var n in r.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=r.extensions[n])}function B(e,t){void 0!==t.extras&&("object"===typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function H(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,n=t.weights.length;r<n;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(r=0,n=i.length;r<n;r++)e.morphTargetDictionary[i[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function G(e){var t=e.extensions&&e.extensions[r.KHR_DRACO_MESH_COMPRESSION];return t?"draco:"+t.bufferView+":"+t.indices+":"+z(t.attributes):e.indices+":"+z(e.attributes)+":"+e.mode}function z(e){for(var t="",r=Object.keys(e).sort(),n=0,i=r.length;n<i;n++)t+=r[n]+":"+e[r[n]]+";";return t}function W(e,r){this.json=e||{},this.extensions={},this.plugins={},this.options=r||{},this.cache=new t,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!==typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new n.I(this.options.manager):this.textureLoader=new n.j(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new n.F(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function K(e,t,r){var i=t.attributes,a=[];function o(t,n){return r.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(var s in i){var c=C[s]||s.toLowerCase();c in e.attributes||a.push(o(i[s],c))}if(void 0!==t.indices&&!e.index){var u=r.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));a.push(u)}return B(e,t),function(e,t,r){var i=t.attributes,a=new n.af;if(void 0!==i.POSITION){var o=(f=r.json.accessors[i.POSITION]).min,s=f.max;if(void 0!==o&&void 0!==s){a.set(new n.V(o[0],o[1],o[2]),new n.V(s[0],s[1],s[2]));var c=t.targets;if(void 0!==c){for(var u=new n.V,l=new n.V,p=0,h=c.length;p<h;p++){var f,d=c[p];if(void 0!==d.POSITION)o=(f=r.json.accessors[d.POSITION]).min,s=f.max,void 0!==o&&void 0!==s?(l.setX(Math.max(Math.abs(o[0]),Math.abs(s[0]))),l.setY(Math.max(Math.abs(o[1]),Math.abs(s[1]))),l.setZ(Math.max(Math.abs(o[2]),Math.abs(s[2]))),u.max(l)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}a.expandByVector(u)}e.boundingBox=a;var v=new n.ag;a.getCenter(v.center),v.radius=a.min.distanceTo(a.max)/2,e.boundingSphere=v}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,r),Promise.all(a).then((function(){return void 0!==t.targets?function(e,t,r){for(var n=!1,i=!1,a=0,o=t.length;a<o&&(void 0!==(u=t[a]).POSITION&&(n=!0),void 0!==u.NORMAL&&(i=!0),!n||!i);a++);if(!n&&!i)return Promise.resolve(e);var s=[],c=[];for(a=0,o=t.length;a<o;a++){var u=t[a];if(n){var l=void 0!==u.POSITION?r.getDependency("accessor",u.POSITION):e.attributes.position;s.push(l)}i&&(l=void 0!==u.NORMAL?r.getDependency("accessor",u.NORMAL):e.attributes.normal,c.push(l))}return Promise.all([Promise.all(s),Promise.all(c)]).then((function(t){var r=t[0],a=t[1];return n&&(e.morphAttributes.position=r),i&&(e.morphAttributes.normal=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,r):e}))}function X(e,t){var r=e.getIndex();if(null===r){var i=[],a=e.getAttribute("position");if(void 0===a)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var o=0;o<a.count;o++)i.push(o);e.setIndex(i),r=e.getIndex()}var s=r.count-2,c=[];if(t===n.aa)for(o=1;o<=s;o++)c.push(r.getX(0)),c.push(r.getX(o)),c.push(r.getX(o+1));else for(o=0;o<s;o++)o%2===0?(c.push(r.getX(o)),c.push(r.getX(o+1)),c.push(r.getX(o+2))):(c.push(r.getX(o+2)),c.push(r.getX(o+1)),c.push(r.getX(o)));c.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var u=e.clone();return u.setIndex(c),u}return W.prototype.setExtensions=function(e){this.extensions=e},W.prototype.setPlugins=function(e){this.plugins=e},W.prototype.parse=function(e,t){var r=this,n=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])})).then((function(t){var a={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:r,userData:{}};V(i,a,n),B(a,n),Promise.all(r._invokeAll((function(e){return e.afterRoot&&e.afterRoot(a)}))).then((function(){e(a)}))})).catch(t)},W.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],n=0,i=t.length;n<i;n++)for(var a=t[n].joints,o=0,s=a.length;o<s;o++)e[a[o]].isBone=!0;for(var c=0,u=e.length;c<u;c++){var l=e[c];void 0!==l.mesh&&(this._addNodeRef(this.meshCache,l.mesh),void 0!==l.skin&&(r[l.mesh].isSkinnedMesh=!0)),void 0!==l.camera&&this._addNodeRef(this.cameraCache,l.camera)}},W.prototype._addNodeRef=function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},W.prototype._getNodeRef=function(e,t,r){if(e.refs[t]<=1)return r;var n=r.clone();return n.name+="_instance_"+e.uses[t]++,n},W.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var r=0;r<t.length;r++){var n=e(t[r]);if(n)return n}},W.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var r=[],n=0;n<t.length;n++){var i=e(t[n]);i&&r.push(i)}return r},W.prototype.getDependency=function(e,t){var r=e+":"+t,n=this.cache.get(r);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this.loadAnimation(t);break;case"camera":n=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,n)}return n},W.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return r.getDependency(e,n)}))),this.cache.add(e,t)}return t},W.prototype.loadBuffer=function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[r.KHR_BINARY_GLTF].body);var i=this.options;return new Promise((function(e,r){n.load(j(t.uri,i.path),e,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},W.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var r=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+r)}))},W.prototype.loadAccessor=function(e){var t=this,r=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);var a=[];return void 0!==i.bufferView?a.push(this.getDependency("bufferView",i.bufferView)):a.push(null),void 0!==i.sparse&&(a.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(a).then((function(e){var a,o,s=e[0],c=O[i.type],u=k[i.componentType],l=u.BYTES_PER_ELEMENT,p=l*c,h=i.byteOffset||0,f=void 0!==i.bufferView?r.bufferViews[i.bufferView].byteStride:void 0,d=!0===i.normalized;if(f&&f!==p){var v=Math.floor(h/f),m="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+v+":"+i.count,g=t.cache.get(m);g||(a=new u(s,v*f,i.count*f/l),g=new n.k(a,f/l),t.cache.add(m,g)),o=new n.l(g,c,h%f/l,d)}else a=null===s?new u(i.count*c):new u(s,h,i.count*c),o=new n.c(a,c,d);if(void 0!==i.sparse){var y=O.SCALAR,E=k[i.sparse.indices.componentType],T=i.sparse.indices.byteOffset||0,x=i.sparse.values.byteOffset||0,A=new E(e[1],T,i.sparse.count*y),b=new u(e[2],x,i.sparse.count*c);null!==s&&(o=new n.c(o.array.slice(),o.itemSize,o.normalized));for(var w=0,R=A.length;w<R;w++){var N=A[w];if(o.setX(N,b[w*c]),c>=2&&o.setY(N,b[w*c+1]),c>=3&&o.setZ(N,b[w*c+2]),c>=4&&o.setW(N,b[w*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o}))},W.prototype.loadTexture=function(e){var t=this.json,r=this.options,n=t.textures[e],i=t.images[n.source],a=this.textureLoader;if(i.uri){var o=r.manager.getHandler(i.uri);null!==o&&(a=o)}return this.loadTextureImage(e,i,a)},W.prototype.loadTextureImage=function(e,t,r){var i=this,a=this.json,o=this.options,s=a.textures[e],c=self.URL||self.webkitURL,u=t.uri,l=!1,p=!0;if("image/jpeg"===t.mimeType&&(p=!1),void 0!==t.bufferView)u=i.getDependency("bufferView",t.bufferView).then((function(e){if("image/png"===t.mimeType){var r=new DataView(e,25,1).getUint8(0,!1);p=6===r||4===r||3===r}l=!0;var n=new Blob([e],{type:t.mimeType});return u=c.createObjectURL(n)}));else if(void 0===t.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");return Promise.resolve(u).then((function(e){return new Promise((function(t,i){var a=t;!0===r.isImageBitmapLoader&&(a=function(e){t(new n.a9(e))}),r.load(j(e,o.path),a,void 0,i)}))})).then((function(t){!0===l&&c.revokeObjectURL(u),t.flipY=!1,s.name&&(t.name=s.name),p||(t.format=n.R);var r=(a.samplers||{})[s.sampler]||{};return t.magFilter=I[r.magFilter]||n.m,t.minFilter=I[r.minFilter]||n.n,t.wrapS=L[r.wrapS]||n.o,t.wrapT=L[r.wrapT]||n.o,i.associations.set(t,{type:"textures",index:e}),t}))},W.prototype.assignTexture=function(e,t,n){var i=this;return this.getDependency("texture",n.index).then((function(a){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),i.extensions[r.KHR_TEXTURE_TRANSFORM]){var o=void 0!==n.extensions?n.extensions[r.KHR_TEXTURE_TRANSFORM]:void 0;if(o){var s=i.associations.get(a);a=i.extensions[r.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),i.associations.set(a,s)}}e[t]=a}))},W.prototype.assignFinalMaterial=function(e){var t=e.geometry,r=e.material,i=void 0!==t.attributes.tangent,a=void 0!==t.attributes.color,o=void 0===t.attributes.normal,s=!0===e.isSkinnedMesh,c=Object.keys(t.morphAttributes).length>0,u=c&&void 0!==t.morphAttributes.normal;if(e.isPoints){var l="PointsMaterial:"+r.uuid,p=this.cache.get(l);p||(p=new n.P,n.p.prototype.copy.call(p,r),p.color.copy(r.color),p.map=r.map,p.sizeAttenuation=!1,this.cache.add(l,p)),r=p}else if(e.isLine){l="LineBasicMaterial:"+r.uuid;var h=this.cache.get(l);h||(h=new n.q,n.p.prototype.copy.call(h,r),h.color.copy(r.color),this.cache.add(l,h)),r=h}if(i||a||o||s||c){l="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(l+="specular-glossiness:"),s&&(l+="skinning:"),i&&(l+="vertex-tangents:"),a&&(l+="vertex-colors:"),o&&(l+="flat-shading:"),c&&(l+="morph-targets:"),u&&(l+="morph-normals:");var f=this.cache.get(l);f||(f=r.clone(),s&&(f.skinning=!0),a&&(f.vertexColors=!0),o&&(f.flatShading=!0),c&&(f.morphTargets=!0),u&&(f.morphNormals=!0),i&&(f.vertexTangents=!0,f.normalScale&&(f.normalScale.y*=-1),f.clearcoatNormalScale&&(f.clearcoatNormalScale.y*=-1)),this.cache.add(l,f),this.associations.set(f,this.associations.get(r))),r=f}r.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=r},W.prototype.getMaterialType=function(){return n.h},W.prototype.loadMaterial=function(e){var t,i=this,a=this.json,o=this.extensions,s=a.materials[e],c={},u=s.extensions||{},l=[];if(u[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var p=o[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=p.getMaterialType(),l.push(p.extendParams(c,s,i))}else if(u[r.KHR_MATERIALS_UNLIT]){var h=o[r.KHR_MATERIALS_UNLIT];t=h.getMaterialType(),l.push(h.extendParams(c,s,i))}else{var f=s.pbrMetallicRoughness||{};if(c.color=new n.C(1,1,1),c.opacity=1,Array.isArray(f.baseColorFactor)){var d=f.baseColorFactor;c.color.fromArray(d),c.opacity=d[3]}void 0!==f.baseColorTexture&&l.push(i.assignTexture(c,"map",f.baseColorTexture)),c.metalness=void 0!==f.metallicFactor?f.metallicFactor:1,c.roughness=void 0!==f.roughnessFactor?f.roughnessFactor:1,void 0!==f.metallicRoughnessTexture&&(l.push(i.assignTexture(c,"metalnessMap",f.metallicRoughnessTexture)),l.push(i.assignTexture(c,"roughnessMap",f.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),l.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,c)}))))}!0===s.doubleSided&&(c.side=n.D);var v=s.alphaMode||F;return v===U?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,v===D&&(c.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&t!==n.g&&(l.push(i.assignTexture(c,"normalMap",s.normalTexture)),c.normalScale=new n.a(1,-1),void 0!==s.normalTexture.scale&&c.normalScale.set(s.normalTexture.scale,-s.normalTexture.scale)),void 0!==s.occlusionTexture&&t!==n.g&&(l.push(i.assignTexture(c,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(c.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&t!==n.g&&(c.emissive=(new n.C).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&t!==n.g&&l.push(i.assignTexture(c,"emissiveMap",s.emissiveTexture)),Promise.all(l).then((function(){var a;return a=t===y?o[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(c):new t(c),s.name&&(a.name=s.name),a.map&&(a.map.encoding=n.s),a.emissiveMap&&(a.emissiveMap.encoding=n.s),B(a,s),i.associations.set(a,{type:"materials",index:e}),s.extensions&&V(o,a,s),a}))},W.prototype.createUniqueName=function(e){for(var t=n.r.sanitizeNodeName(e||""),r=t,i=1;this.nodeNamesUsed[r];++i)r=t+"_"+i;return this.nodeNamesUsed[r]=!0,r},W.prototype.loadGeometries=function(e){var t=this,i=this.extensions,a=this.primitiveCache;function o(e){return i[r.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(r){return K(r,e,t)}))}for(var s=[],c=0,u=e.length;c<u;c++){var l,p=e[c],h=G(p),f=a[h];if(f)s.push(f.promise);else l=p.extensions&&p.extensions[r.KHR_DRACO_MESH_COMPRESSION]?o(p):K(new n.B,p,t),a[h]={primitive:p,promise:l},s.push(l)}return Promise.all(s)},W.prototype.loadMesh=function(e){for(var t,r=this,i=this.json,a=this.extensions,o=i.meshes[e],s=o.primitives,c=[],u=0,l=s.length;u<l;u++){var p=void 0===s[u].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new n.h({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:n.a8})),t.DefaultMaterial):this.getDependency("material",s[u].material);c.push(p)}return c.push(r.loadGeometries(s)),Promise.all(c).then((function(t){for(var i=t.slice(0,t.length-1),c=t[t.length-1],u=[],l=0,p=c.length;l<p;l++){var h,f=c[l],d=s[l],v=i[l];if(d.mode===N||d.mode===_||d.mode===S||void 0===d.mode)!0!==(h=!0===o.isSkinnedMesh?new n.t(f,v):new n.v(f,v)).isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),d.mode===_?h.geometry=X(h.geometry,n.ab):d.mode===S&&(h.geometry=X(h.geometry,n.aa));else if(d.mode===b)h=new n.w(f,v);else if(d.mode===R)h=new n.x(f,v);else if(d.mode===w)h=new n.y(f,v);else{if(d.mode!==A)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);h=new n.z(f,v)}Object.keys(h.geometry.morphAttributes).length>0&&H(h,o),h.name=r.createUniqueName(o.name||"mesh_"+e),B(h,o),d.extensions&&V(a,h,d),r.assignFinalMaterial(h),u.push(h)}if(1===u.length)return u[0];var m=new n.G;for(l=0,p=u.length;l<p;l++)m.add(u[l]);return m}))},W.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],i=r[r.type];if(i)return"perspective"===r.type?t=new n.A(n.H.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===r.type&&(t=new n.O(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),B(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},W.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return r.inverseBindMatrices=e,r}))},W.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],r=[],i=[],a=[],o=[],s=[],c=0,u=t.channels.length;c<u;c++){var l=t.channels[c],p=t.samplers[l.sampler],h=l.target,f=void 0!==h.node?h.node:h.id,d=void 0!==t.parameters?t.parameters[p.input]:p.input,v=void 0!==t.parameters?t.parameters[p.output]:p.output;r.push(this.getDependency("node",f)),i.push(this.getDependency("accessor",d)),a.push(this.getDependency("accessor",v)),o.push(p),s.push(h)}return Promise.all([Promise.all(r),Promise.all(i),Promise.all(a),Promise.all(o),Promise.all(s)]).then((function(r){for(var i=r[0],a=r[1],o=r[2],s=r[3],c=r[4],u=[],l=0,p=i.length;l<p;l++){var h=i[l],f=a[l],d=o[l],v=s[l],m=c[l];if(void 0!==h){var g;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,M[m.path]){case M.weights:g=n.ae;break;case M.rotation:g=n.ad;break;case M.position:case M.scale:default:g=n.ac}var y=h.name?h.name:h.uuid,E=void 0!==v.interpolation?P[v.interpolation]:n.J,T=[];M[m.path]===M.weights?h.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&T.push(e.name?e.name:e.uuid)})):T.push(y);var A=d.array;if(d.normalized){var b;if(A.constructor===Int8Array)b=1/127;else if(A.constructor===Uint8Array)b=1/255;else if(A.constructor==Int16Array)b=1/32767;else{if(A.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");b=1/65535}for(var w=new Float32Array(A.length),R=0,N=A.length;R<N;R++)w[R]=A[R]*b;A=w}for(R=0,N=T.length;R<N;R++){var _=new g(T[R]+"."+M[m.path],f.array,A,E);"CUBICSPLINE"===v.interpolation&&(_.createInterpolant=function(e){return new x(this.times,this.values,this.getValueSize()/3,e)},_.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),u.push(_)}}}var S=t.name?t.name:"animation_"+e;return new n.K(S,void 0,u)}))},W.prototype.loadNode=function(e){var t=this.json,r=this.extensions,i=this,a=t.nodes[e],o=a.name?i.createUniqueName(a.name):"";return function(){var t=[];return void 0!==a.mesh&&t.push(i.getDependency("mesh",a.mesh).then((function(e){var t=i._getNodeRef(i.meshCache,a.mesh,e);return void 0!==a.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,r=a.weights.length;t<r;t++)e.morphTargetInfluences[t]=a.weights[t]})),t}))),void 0!==a.camera&&t.push(i.getDependency("camera",a.camera).then((function(e){return i._getNodeRef(i.cameraCache,a.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){var s;if((s=!0===a.isBone?new n.N:t.length>1?new n.G:1===t.length?t[0]:new n.U)!==t[0])for(var c=0,u=t.length;c<u;c++)s.add(t[c]);if(a.name&&(s.userData.name=a.name,s.name=o),B(s,a),a.extensions&&V(r,s,a),void 0!==a.matrix){var l=new n.W;l.fromArray(a.matrix),s.applyMatrix4(l)}else void 0!==a.translation&&s.position.fromArray(a.translation),void 0!==a.rotation&&s.quaternion.fromArray(a.rotation),void 0!==a.scale&&s.scale.fromArray(a.scale);return i.associations.set(s,{type:"nodes",index:e}),s}))},W.prototype.loadScene=function(){function e(t,r,i,a){var o=i.nodes[t];return a.getDependency("node",t).then((function(e){return void 0===o.skin?e:a.getDependency("skin",o.skin).then((function(e){for(var r=[],n=0,i=(t=e).joints.length;n<i;n++)r.push(a.getDependency("node",t.joints[n]));return Promise.all(r)})).then((function(r){return e.traverse((function(e){if(e.isMesh){for(var i=[],a=[],o=0,s=r.length;o<s;o++){var c=r[o];if(c){i.push(c);var u=new n.W;void 0!==t.inverseBindMatrices&&u.fromArray(t.inverseBindMatrices.array,16*o),a.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}e.bind(new n.X(i,a),e.matrixWorld)}})),e}));var t})).then((function(t){r.add(t);var n=[];if(o.children)for(var s=o.children,c=0,u=s.length;c<u;c++){var l=s[c];n.push(e(l,t,i,a))}return Promise.all(n)}))}return function(t){var r=this.json,i=this.extensions,a=this.json.scenes[t],o=new n.G;a.name&&(o.name=this.createUniqueName(a.name)),B(o,a),a.extensions&&V(i,o,a);for(var s=a.nodes||[],c=[],u=0,l=s.length;u<l;u++)c.push(e(s[u],o,r,this));return Promise.all(c).then((function(){return o}))}}(),e}(),s=function(e){n.L.call(this,e)};s.prototype=Object.assign(Object.create(n.L.prototype),{constructor:s,load:function(e,t,r,i){var a=this,o=new n.ah,s=new n.F(this.manager);return s.setResponseType("arraybuffer"),s.setPath(this.path),s.setWithCredentials(this.withCredentials),s.load(e,(function(e){o.image=a.parse(e),o.needsUpdate=!0,void 0!==t&&t(o)}),r,i),o},parse:function(e){var t=0,r=1,n=2,i=3,a=9,o=10,s=11,c=48,u=4,l=0,p=1,h=2,f=3;e.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var d=new Uint8Array(e),v=0,m={id_length:d[v++],colormap_type:d[v++],image_type:d[v++],colormap_index:d[v++]|d[v++]<<8,colormap_length:d[v++]|d[v++]<<8,colormap_size:d[v++],origin:[d[v++]|d[v++]<<8,d[v++]|d[v++]<<8],width:d[v++]|d[v++]<<8,height:d[v++]|d[v++]<<8,pixel_size:d[v++],flags:d[v++]};!function(e){switch(e.image_type){case r:case a:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case n:case i:case o:case s:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case t:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(m),m.id_length+v>e.length&&console.error("THREE.TGALoader: No data."),v+=m.id_length;var g=!1,y=!1,E=!1;switch(m.image_type){case a:g=!0,y=!0;break;case r:y=!0;break;case o:g=!0;break;case n:break;case s:g=!0,E=!0;break;case i:E=!0}var T="undefined"!==typeof OffscreenCanvas?new OffscreenCanvas(m.width,m.height):document.createElement("canvas");T.width=m.width,T.height=m.height;var x=T.getContext("2d"),A=x.createImageData(m.width,m.height),b=function(e,t,r,n,i){var a,o,s,c;if(o=r.pixel_size>>3,s=r.width*r.height*o,t&&(c=i.subarray(n,n+=r.colormap_length*(r.colormap_size>>3))),e){var u,l,p;a=new Uint8Array(s);for(var h=0,f=new Uint8Array(o);h<s;)if(l=1+(127&(u=i[n++])),128&u){for(p=0;p<o;++p)f[p]=i[n++];for(p=0;p<l;++p)a.set(f,h+p*o);h+=o*l}else{for(l*=o,p=0;p<l;++p)a[h+p]=i[n++];h+=l}}else a=i.subarray(n,n+=t?r.width*r.height:s);return{pixel_data:a,palettes:c}}(g,y,m,v,d);return function(e,t,r,n,i){var a,o,s,d,v,g;switch((m.flags&c)>>u){default:case h:a=0,s=1,v=t,o=0,d=1,g=r;break;case l:a=0,s=1,v=t,o=r-1,d=-1,g=-1;break;case f:a=t-1,s=-1,v=-1,o=0,d=1,g=r;break;case p:a=t-1,s=-1,v=-1,o=r-1,d=-1,g=-1}if(E)switch(m.pixel_size){case 8:!function(e,t,r,n,i,a,o,s){var c,u,l,p=0,h=m.width;for(l=t;l!==n;l+=r)for(u=i;u!==o;u+=a,p++)c=s[p],e[4*(u+h*l)+0]=c,e[4*(u+h*l)+1]=c,e[4*(u+h*l)+2]=c,e[4*(u+h*l)+3]=255}(e,o,d,g,a,s,v,n);break;case 16:!function(e,t,r,n,i,a,o,s){var c,u,l=0,p=m.width;for(u=t;u!==n;u+=r)for(c=i;c!==o;c+=a,l+=2)e[4*(c+p*u)+0]=s[l+0],e[4*(c+p*u)+1]=s[l+0],e[4*(c+p*u)+2]=s[l+0],e[4*(c+p*u)+3]=s[l+1]}(e,o,d,g,a,s,v,n);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(m.pixel_size){case 8:!function(e,t,r,n,i,a,o,s,c){var u,l,p,h=c,f=0,d=m.width;for(p=t;p!==n;p+=r)for(l=i;l!==o;l+=a,f++)u=s[f],e[4*(l+d*p)+3]=255,e[4*(l+d*p)+2]=h[3*u+0],e[4*(l+d*p)+1]=h[3*u+1],e[4*(l+d*p)+0]=h[3*u+2]}(e,o,d,g,a,s,v,n,i);break;case 16:!function(e,t,r,n,i,a,o,s){var c,u,l,p=0,h=m.width;for(l=t;l!==n;l+=r)for(u=i;u!==o;u+=a,p+=2)c=s[p+0]+(s[p+1]<<8),e[4*(u+h*l)+0]=(31744&c)>>7,e[4*(u+h*l)+1]=(992&c)>>2,e[4*(u+h*l)+2]=(31&c)>>3,e[4*(u+h*l)+3]=32768&c?0:255}(e,o,d,g,a,s,v,n);break;case 24:!function(e,t,r,n,i,a,o,s){var c,u,l=0,p=m.width;for(u=t;u!==n;u+=r)for(c=i;c!==o;c+=a,l+=3)e[4*(c+p*u)+3]=255,e[4*(c+p*u)+2]=s[l+0],e[4*(c+p*u)+1]=s[l+1],e[4*(c+p*u)+0]=s[l+2]}(e,o,d,g,a,s,v,n);break;case 32:!function(e,t,r,n,i,a,o,s){var c,u,l=0,p=m.width;for(u=t;u!==n;u+=r)for(c=i;c!==o;c+=a,l+=4)e[4*(c+p*u)+2]=s[l+0],e[4*(c+p*u)+1]=s[l+1],e[4*(c+p*u)+0]=s[l+2],e[4*(c+p*u)+3]=s[l+3]}(e,o,d,g,a,s,v,n);break;default:console.error("THREE.TGALoader: Format not supported.")}}(A.data,m.width,m.height,b.pixel_data,b.palettes),x.putImageData(A,0,0),T}});var c=function(e){n.L.call(this,e)};c.prototype=Object.assign(Object.create(n.L.prototype),{constructor:c,load:function(e,t,r,i){var a=this,o=""===a.path?n.f.extractUrlBase(e):a.path,s=new n.F(a.manager);s.setPath(a.path),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(e,(function(r){try{t(a.parse(r,o))}catch(l){i?i(l):console.error(l),a.manager.itemError(e)}}),r,i)},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},parse:function(e,t){function r(e,t){for(var r=[],n=e.childNodes,i=0,a=n.length;i<a;i++){var o=n[i];o.nodeName===t&&r.push(o)}return r}function i(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=t[n];return r}function a(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=parseFloat(t[n]);return r}function o(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=parseInt(t[n]);return r}function c(e){return e.substring(1)}function u(e){return 0===Object.keys(e).length}function l(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function p(e){return void 0!==e?e.textContent:"Y_UP"}function h(e,t,n,i){var a=r(e,t)[0];if(void 0!==a)for(var o=r(a,n),s=0;s<o.length;s++)i(o[s])}function f(e,t){for(var r in e){e[r].build=t(e[r])}}function d(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function v(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var a=c(i.getAttribute("source")),o=i.getAttribute("semantic");t.inputs[o]=a}}return t}function m(e){var t={},r=e.getAttribute("target").split("/"),n=r.shift(),i=r.shift(),a=-1!==i.indexOf("("),o=-1!==i.indexOf(".");if(o)r=i.split("."),i=r.shift(),t.member=r.shift();else if(a){var s=i.split("(");i=s.shift();for(var u=0;u<s.length;u++)s[u]=parseInt(s[u].replace(/\)/,""));t.indices=s}return t.id=n,t.sid=i,t.arraySyntax=a,t.memberSyntax=o,t.sampler=c(e.getAttribute("source")),t}function g(e){var t=[],r=e.channels,n=e.samplers,i=e.sources;for(var a in r)if(r.hasOwnProperty(a)){var o=r[a],s=n[o.sampler],c=s.inputs.INPUT,u=s.inputs.OUTPUT;b(E(o,i[c],i[u]),t)}return t}function y(e){return d(Je.animations[e],g)}function E(e,t,r){var n,i,a,o,s,c,u=Je.nodes[e.id],l=De(u.id),p=u.transforms[e.sid],h=u.matrix.clone().transpose(),f={};switch(p){case"matrix":for(a=0,o=t.array.length;a<o;a++)if(n=t.array[a],i=a*r.stride,void 0===f[n]&&(f[n]={}),!0===e.arraySyntax){var d=r.array[i],v=e.indices[0]+4*e.indices[1];f[n][v]=d}else for(s=0,c=r.stride;s<c;s++)f[n][s]=r.array[i+s];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',p)}var m=function(e,t){var r=[];for(var n in e)r.push({time:parseFloat(n),value:e[n]});r.sort(a);for(var i=0;i<16;i++)w(r,i,t.elements[i]);return r;function a(e,t){return e.time-t.time}}(f,h);return{name:l.uuid,keyframes:m}}var T=new n.V,x=new n.V,A=new n.Q;function b(e,t){for(var r=e.keyframes,i=e.name,a=[],o=[],s=[],c=[],u=0,l=r.length;u<l;u++){var p=r[u],h=p.time,f=p.value;Ne.fromArray(f).transpose(),Ne.decompose(T,A,x),a.push(h),o.push(T.x,T.y,T.z),s.push(A.x,A.y,A.z,A.w),c.push(x.x,x.y,x.z)}return o.length>0&&t.push(new n.ac(i+".position",a,o)),s.length>0&&t.push(new n.ad(i+".quaternion",a,s)),c.length>0&&t.push(new n.ac(i+".scale",a,c)),t}function w(e,t,r){var n,i,a,o=!0;for(i=0,a=e.length;i<a;i++)void 0===(n=e[i]).value[t]?n.value[t]=null:o=!1;if(!0===o)for(i=0,a=e.length;i<a;i++)(n=e[i]).value[t]=r;else!function(e,t){for(var r,n,i=0,a=e.length;i<a;i++){var o=e[i];if(null===o.value[t]){if(r=R(e,i,t),n=N(e,i,t),null===r){o.value[t]=n.value[t];continue}if(null===n){o.value[t]=r.value[t];continue}_(o,r,n,t)}}}(e,t)}function R(e,t,r){for(;t>=0;){var n=e[t];if(null!==n.value[r])return n;t--}return null}function N(e,t,r){for(;t<e.length;){var n=e[t];if(null!==n.value[r])return n;t++}return null}function _(e,t,r,n){r.time-t.time!==0?e.value[n]=(e.time-t.time)*(r.value[n]-t.value[n])/(r.time-t.time)+t.value[n]:e.value[n]=t.value[n]}function S(e){for(var t=[],r=e.name,i=e.end-e.start||-1,a=e.animations,o=0,s=a.length;o<s;o++)for(var c=y(a[o]),u=0,l=c.length;u<l;u++)t.push(c[u]);return new n.K(r,i,t)}function k(e){return d(Je.clips[e],S)}function I(e){for(var t={sources:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=a(i.textContent);break;case"source":var o=i.getAttribute("id");t.sources[o]=oe(i);break;case"joints":t.joints=L(i);break;case"vertex_weights":t.vertexWeights=O(i)}}return t}function L(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var a=i.getAttribute("semantic"),o=c(i.getAttribute("source"));t.inputs[a]=o}}return t}function O(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var a=i.getAttribute("semantic"),s=c(i.getAttribute("source")),u=parseInt(i.getAttribute("offset"));t.inputs[a]={id:s,offset:u};break;case"vcount":t.vcount=o(i.textContent);break;case"v":t.v=o(i.textContent)}}return t}function C(e){var t={id:e.id},r=Je.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,r,i,a=4,o={joints:[],indices:{array:[],stride:a},weights:{array:[],stride:a}},s=e.sources,c=e.vertexWeights,u=c.vcount,l=c.v,p=c.inputs.JOINT.offset,h=c.inputs.WEIGHT.offset,f=e.sources[e.joints.inputs.JOINT],d=e.sources[e.joints.inputs.INV_BIND_MATRIX],v=s[c.inputs.WEIGHT.id].array,m=0;for(t=0,i=u.length;t<i;t++){var g=u[t],y=[];for(r=0;r<g;r++){var E=l[m+p],T=v[l[m+h]];y.push({index:E,weight:T}),m+=2}for(y.sort(w),r=0;r<a;r++){var x=y[r];void 0!==x?(o.indices.array.push(x.index),o.weights.array.push(x.weight)):(o.indices.array.push(0),o.weights.array.push(0))}}e.bindShapeMatrix?o.bindMatrix=(new n.W).fromArray(e.bindShapeMatrix).transpose():o.bindMatrix=(new n.W).identity();for(t=0,i=f.array.length;t<i;t++){var A=f.array[t],b=(new n.W).fromArray(d.array,t*d.stride).transpose();o.joints.push({name:A,boneInverse:b})}return o;function w(e,t){return t.weight-e.weight}}(e.skin),r.sources.skinIndices=t.skin.indices,r.sources.skinWeights=t.skin.weights),t}function M(e){return void 0!==e.build?e.build:e.init_from}function P(e){var t=Je.images[e];return void 0!==t?d(t,M):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function F(e){for(var t={surfaces:{},samplers:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"newparam":D(i,t);break;case"technique":t.technique=V(i);break;case"extra":t.extra=K(i)}}return t}function D(e,t){for(var r=e.getAttribute("sid"),n=0,i=e.childNodes.length;n<i;n++){var a=e.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"surface":t.surfaces[r]=U(a);break;case"sampler2D":t.samplers[r]=j(a)}}}function U(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"init_from":t.init_from=i.textContent}}return t}function j(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"source":t.source=i.textContent}}return t}function V(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=i.nodeName,t.parameters=B(i)}}return t}function B(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[i.nodeName]=H(i);break;case"transparent":t[i.nodeName]={opaque:i.getAttribute("opaque"),data:H(i)}}}return t}function H(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"color":t[i.nodeName]=a(i.textContent);break;case"float":t[i.nodeName]=parseFloat(i.textContent);break;case"texture":t[i.nodeName]={id:i.getAttribute("texture"),extra:G(i)}}}return t}function G(e){for(var t={technique:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"extra":z(i,t)}}return t}function z(e,t){for(var r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":W(i,t)}}}function W(e,t){for(var r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=1:"FALSE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=0:t.technique[i.nodeName]=parseInt(i.textContent)}}}function K(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":t.technique=X(i)}}return t}function X(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"double_sided":t[i.nodeName]=parseInt(i.textContent)}}return t}function q(e){return e}function Y(e){var t,r,i=(t=e.url,d(Je.effects[t],q)),a=i.profile.technique,o=i.profile.extra;switch(a.type){case"phong":case"blinn":r=new n.al;break;case"lambert":r=new n.ak;break;default:r=new n.g}function s(e){var t=i.profile.samplers[e.id],r=null;void 0!==t?r=P(i.profile.surfaces[t.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),r=P(e.id));if(null!==r){var a=function(e){var t,r=e.slice(2+(e.lastIndexOf(".")-1>>>0));switch(r=r.toLowerCase()){case"tga":t=Ke;break;default:t=qe}return t}(r);if(void 0!==a){var o=a.load(r),s=e.extra;if(void 0!==s&&void 0!==s.technique&&!1===u(s.technique)){var c=s.technique;o.wrapS=c.wrapU?n.o:n.a5,o.wrapT=c.wrapV?n.o:n.a5,o.offset.set(c.offsetU||0,c.offsetV||0),o.repeat.set(c.repeatU||1,c.repeatV||1)}else o.wrapS=n.o,o.wrapT=n.o;return o}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",r),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}r.name=e.name||"";var c=a.parameters;for(var l in c){var p=c[l];switch(l){case"diffuse":p.color&&r.color.fromArray(p.color),p.texture&&(r.map=s(p.texture));break;case"specular":p.color&&r.specular&&r.specular.fromArray(p.color),p.texture&&(r.specularMap=s(p.texture));break;case"bump":p.texture&&(r.normalMap=s(p.texture));break;case"ambient":p.texture&&(r.lightMap=s(p.texture));break;case"shininess":p.float&&r.shininess&&(r.shininess=p.float);break;case"emission":p.color&&r.emissive&&r.emissive.fromArray(p.color),p.texture&&(r.emissiveMap=s(p.texture))}}var h=c.transparent,f=c.transparency;if(void 0===f&&h&&(f={float:1}),void 0===h&&f&&(h={opaque:"A_ONE",data:{color:[1,1,1,1]}}),h&&f)if(h.data.texture)r.transparent=!0;else{var v=h.data.color;switch(h.opaque){case"A_ONE":r.opacity=v[3]*f.float;break;case"RGB_ZERO":r.opacity=1-v[0]*f.float;break;case"A_ZERO":r.opacity=1-v[3]*f.float;break;case"RGB_ONE":r.opacity=v[0]*f.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',h.opaque)}r.opacity<1&&(r.transparent=!0)}return void 0!==o&&void 0!==o.technique&&1===o.technique.double_sided&&(r.side=n.D),r}function Z(e){return d(Je.materials[e],Y)}function $(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"technique_common":return J(r)}}return{}}function J(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"perspective":case"orthographic":t.technique=n.nodeName,t.parameters=Q(n)}}return t}function Q(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[n.nodeName]=parseFloat(n.textContent)}}return t}function ee(e){var t;switch(e.optics.technique){case"perspective":t=new n.A(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var r=e.optics.parameters.ymag,i=e.optics.parameters.xmag,a=e.optics.parameters.aspect_ratio;i=void 0===i?r*a:i,r=void 0===r?i/a:r,i*=.5,r*=.5,t=new n.O(-i,i,r,-r,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new n.A}return t.name=e.name||"",t}function te(e){var t=Je.cameras[e];return void 0!==t?d(t,ee):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function re(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=i.nodeName,t.parameters=ne(i)}}return t}function ne(e){for(var t={},r=0,i=e.childNodes.length;r<i;r++){var o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"color":var s=a(o.textContent);t.color=(new n.C).fromArray(s);break;case"falloff_angle":t.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":var c=parseFloat(o.textContent);t.distance=c?Math.sqrt(1/c):0}}return t}function ie(e){var t;switch(e.technique){case"directional":t=new n._;break;case"point":t=new n.Z;break;case"spot":t=new n.Y;break;case"ambient":t=new n.am}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function ae(e){var t=Je.lights[e];return void 0!==t?d(t,ie):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function oe(e){for(var t={array:[],stride:3},n=0;n<e.childNodes.length;n++){var o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"float_array":t.array=a(o.textContent);break;case"Name_array":t.array=i(o.textContent);break;case"technique_common":var s=r(o,"accessor")[0];void 0!==s&&(t.stride=parseInt(s.getAttribute("stride")))}}return t}function se(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];1===n.nodeType&&(t[n.getAttribute("semantic")]=c(n.getAttribute("source")))}return t}function ce(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var a=c(i.getAttribute("source")),s=i.getAttribute("semantic"),u=parseInt(i.getAttribute("offset")),l=parseInt(i.getAttribute("set")),p=l>0?s+l:s;t.inputs[p]={id:a,offset:u},t.stride=Math.max(t.stride,u+1),"TEXCOORD"===s&&(t.hasUV=!0);break;case"vcount":t.vcount=o(i.textContent);break;case"p":t.p=o(i.textContent)}}return t}function ue(e){for(var t=0,r=0,n=e.length;r<n;r++){!0===e[r].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function le(e){var t={},r=e.sources,n=e.vertices,i=e.primitives;if(0===i.length)return{};var a=function(e){for(var t={},r=0;r<e.length;r++){var n=e[r];void 0===t[n.type]&&(t[n.type]=[]),t[n.type].push(n)}return t}(i);for(var o in a){var s=a[o];ue(s),t[o]=pe(s,r,n)}return t}function pe(e,t,r){for(var i={},a={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},c={array:[],stride:0},u={array:[],stride:0},l=[],p=4,h=[],f=4,d=new n.B,v=[],m=0,g=0;g<e.length;g++){var y=e[g],E=y.inputs,T=0;switch(y.type){case"lines":case"linestrips":T=2*y.count;break;case"triangles":T=3*y.count;break;case"polylist":for(var x=0;x<y.count;x++){var A=y.vcount[x];switch(A){case 3:T+=3;break;case 4:T+=6;break;default:T+=3*(A-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",y.type)}for(var b in d.addGroup(m,T,g),m+=T,y.material&&v.push(y.material),E){var w=E[b];switch(b){case"VERTEX":for(var R in r){var N=r[R];switch(R){case"POSITION":var _=a.array.length;if(he(y,t[N],w.offset,a.array),a.stride=t[N].stride,t.skinWeights&&t.skinIndices&&(he(y,t.skinIndices,w.offset,l),he(y,t.skinWeights,w.offset,h)),!1===y.hasUV&&!0===e.uvsNeedsFix){T=(a.array.length-_)/a.stride;for(var S=0;S<T;S++)s.array.push(0,0)}break;case"NORMAL":he(y,t[N],w.offset,o.array),o.stride=t[N].stride;break;case"COLOR":he(y,t[N],w.offset,u.array),u.stride=t[N].stride;break;case"TEXCOORD":he(y,t[N],w.offset,s.array),s.stride=t[N].stride;break;case"TEXCOORD1":he(y,t[N],w.offset,c.array),s.stride=t[N].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',R)}}break;case"NORMAL":he(y,t[w.id],w.offset,o.array),o.stride=t[w.id].stride;break;case"COLOR":he(y,t[w.id],w.offset,u.array),u.stride=t[w.id].stride;break;case"TEXCOORD":he(y,t[w.id],w.offset,s.array),s.stride=t[w.id].stride;break;case"TEXCOORD1":he(y,t[w.id],w.offset,c.array),c.stride=t[w.id].stride}}}return a.array.length>0&&d.setAttribute("position",new n.d(a.array,a.stride)),o.array.length>0&&d.setAttribute("normal",new n.d(o.array,o.stride)),u.array.length>0&&d.setAttribute("color",new n.d(u.array,u.stride)),s.array.length>0&&d.setAttribute("uv",new n.d(s.array,s.stride)),c.array.length>0&&d.setAttribute("uv2",new n.d(c.array,c.stride)),l.length>0&&d.setAttribute("skinIndex",new n.d(l,p)),h.length>0&&d.setAttribute("skinWeight",new n.d(h,f)),i.data=d,i.type=e[0].type,i.materialKeys=v,i}function he(e,t,r,n){var i=e.p,a=e.stride,o=e.vcount;function s(e){for(var t=i[e+r]*u,a=t+u;t<a;t++)n.push(c[t])}var c=t.array,u=t.stride;if(void 0!==e.vcount)for(var l=0,p=0,h=o.length;p<h;p++){var f=o[p];if(4===f){var d=l+1*a,v=l+2*a,m=l+3*a;s(l+0*a),s(d),s(m),s(d),s(v),s(m)}else if(3===f){d=l+1*a,v=l+2*a;s(l+0*a),s(d),s(v)}else if(f>4)for(var g=1,y=f-2;g<=y;g++){d=l+a*g,v=l+a*(g+1);s(l+0*a),s(d),s(v)}l+=a*f}else for(p=0,h=i.length;p<h;p+=a)s(p)}function fe(e){return d(Je.geometries[e],le)}function de(e){return void 0!==e.build?e.build:e}function ve(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"joint":t.joints[n.getAttribute("sid")]=me(n);break;case"link":t.links.push(ye(n))}}}function me(e){for(var t,r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"prismatic":case"revolute":t=ge(n)}}return t}function ge(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new n.V,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var r=0;r<e.childNodes.length;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"axis":var o=a(i.textContent);t.axis.fromArray(o);break;case"limits":var s=i.getElementsByTagName("max")[0],c=i.getElementsByTagName("min")[0];t.limits.max=parseFloat(s.textContent),t.limits.min=parseFloat(c.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function ye(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"attachment_full":t.attachments.push(Ee(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(Te(n))}}return t}function Ee(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"link":t.links.push(ye(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(Te(n))}}return t}function Te(e){var t={type:e.nodeName},r=a(e.textContent);switch(t.type){case"matrix":t.obj=new n.W,t.obj.fromArray(r).transpose();break;case"translate":t.obj=new n.V,t.obj.fromArray(r);break;case"rotate":t.obj=new n.V,t.obj.fromArray(r),t.angle=n.H.degToRad(r[3])}return t}function xe(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":Ae(n,t)}}}function Ae(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"inertia":t.inertia=a(n.textContent);break;case"mass":t.mass=a(n.textContent)[0]}}}function be(e){for(var t={target:e.getAttribute("target").split("/").pop()},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var i=n.getElementsByTagName("param")[0];t.axis=i.textContent;var a=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=a.substr(0,a.length-1)}}return t}function we(e){return void 0!==e.build?e.build:e}function Re(e){for(var t=[],r=Be.querySelector('[id="'+e.id+'"]'),i=0;i<r.childNodes.length;i++){var o=r.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"matrix":var s=a(o.textContent),c=(new n.W).fromArray(s).transpose();t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:c});break;case"translate":case"scale":s=a(o.textContent);var u=(new n.V).fromArray(s);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:u});break;case"rotate":s=a(o.textContent),u=(new n.V).fromArray(s);var l=n.H.degToRad(s[3]);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:u,angle:l})}}return t}var Ne=new n.W,_e=new n.V;function Se(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new n.W,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},r=0;r<e.childNodes.length;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"node":t.nodes.push(i.getAttribute("id")),Se(i);break;case"instance_camera":t.instanceCameras.push(c(i.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(ke(i));break;case"instance_light":t.instanceLights.push(c(i.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(ke(i));break;case"instance_node":t.instanceNodes.push(c(i.getAttribute("url")));break;case"matrix":var o=a(i.textContent);t.matrix.multiply(Ne.fromArray(o).transpose()),t.transforms[i.getAttribute("sid")]=i.nodeName;break;case"translate":o=a(i.textContent);_e.fromArray(o),t.matrix.multiply(Ne.makeTranslation(_e.x,_e.y,_e.z)),t.transforms[i.getAttribute("sid")]=i.nodeName;break;case"rotate":o=a(i.textContent);var s=n.H.degToRad(o[3]);t.matrix.multiply(Ne.makeRotationAxis(_e.fromArray(o),s)),t.transforms[i.getAttribute("sid")]=i.nodeName;break;case"scale":o=a(i.textContent);t.matrix.scale(_e.fromArray(o)),t.transforms[i.getAttribute("sid")]=i.nodeName;break;case"extra":break;default:console.log(i)}}return Fe(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):Je.nodes[t.id]=t,t}function ke(e){for(var t={id:c(e.getAttribute("url")),materials:{},skeletons:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"bind_material":for(var i=n.getElementsByTagName("instance_material"),a=0;a<i.length;a++){var o=i[a],s=o.getAttribute("symbol"),u=o.getAttribute("target");t.materials[s]=c(u)}break;case"skeleton":t.skeletons.push(c(n.textContent))}}return t}function Ie(e,t){var r,i,a,o=[],s=[];for(r=0;r<e.length;r++){var c=e[r];if(Fe(c))Le(De(c),t,o);else if(a=c,void 0!==Je.visualScenes[a])for(var u=Je.visualScenes[c].children,l=0;l<u.length;l++){var p=u[l];if("JOINT"===p.type)Le(De(p.id),t,o)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",c)}for(r=0;r<t.length;r++)for(l=0;l<o.length;l++)if((i=o[l]).bone.name===t[r].name){s[r]=i,i.processed=!0;break}for(r=0;r<o.length;r++)!1===(i=o[r]).processed&&(s.push(i),i.processed=!0);var h=[],f=[];for(r=0;r<s.length;r++)i=s[r],h.push(i.bone),f.push(i.boneInverse);return new n.X(h,f)}function Le(e,t,r){e.traverse((function(e){if(!0===e.isBone){for(var i,a=0;a<t.length;a++){var o=t[a];if(o.name===e.name){i=o.boneInverse;break}}void 0===i&&(i=new n.W),r.push({bone:e,boneInverse:i,processed:!1})}}))}function Oe(e){for(var t,r=[],i=e.matrix,a=e.nodes,o=e.type,s=e.instanceCameras,c=e.instanceControllers,u=e.instanceLights,l=e.instanceGeometries,p=e.instanceNodes,h=0,f=a.length;h<f;h++)r.push(De(a[h]));for(h=0,f=s.length;h<f;h++){var v=te(s[h]);null!==v&&r.push(v.clone())}for(h=0,f=c.length;h<f;h++)for(var m=c[h],g=(t=m.id,d(Je.controllers[t],C)),y=Pe(fe(g.id),m.materials),E=Ie(m.skeletons,g.skin.joints),T=0,x=y.length;T<x;T++){var A;(A=y[T]).isSkinnedMesh&&(A.bind(E,g.skin.bindMatrix),A.normalizeSkinWeights()),r.push(A)}for(h=0,f=u.length;h<f;h++){var b=ae(u[h]);null!==b&&r.push(b.clone())}for(h=0,f=l.length;h<f;h++)for(T=0,x=(y=Pe(fe((m=l[h]).id),m.materials)).length;T<x;T++)r.push(y[T]);for(h=0,f=p.length;h<f;h++)r.push(De(p[h]).clone());if(0===a.length&&1===r.length)A=r[0];else{A="JOINT"===o?new n.N:new n.G;for(h=0;h<r.length;h++)A.add(r[h])}return A.name="JOINT"===o?e.sid:e.name,A.matrix.copy(i),A.matrix.decompose(A.position,A.quaternion,A.scale),A}var Ce=new n.g({color:16711935});function Me(e,t){for(var r=[],n=0,i=e.length;n<i;n++){var a=t[e[n]];void 0===a?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[n]),r.push(Ce)):r.push(Z(a))}return r}function Pe(e,t){var r=[];for(var i in e){var a=e[i],o=Me(a.materialKeys,t);0===o.length&&("lines"===i||"linestrips"===i?o.push(new n.q):o.push(new n.al));var s=void 0!==a.data.attributes.skinIndex;if(s)for(var c=0,u=o.length;c<u;c++)o[c].skinning=!0;var l,p=1===o.length?o[0]:o;switch(i){case"lines":l=new n.w(a.data,p);break;case"linestrips":l=new n.x(a.data,p);break;case"triangles":case"polylist":l=s?new n.t(a.data,p):new n.v(a.data,p)}r.push(l)}return r}function Fe(e){return void 0!==Je.nodes[e]}function De(e){return d(Je.nodes[e],Oe)}function Ue(e){var t=new n.G;t.name=e.name;for(var r=e.children,i=0;i<r.length;i++){var a=r[i];t.add(De(a.id))}return t}function je(e){return d(Je.visualScenes[e],Ue)}if(0===e.length)return{scene:new n.ai};var Ve=(new DOMParser).parseFromString(e,"application/xml"),Be=r(Ve,"COLLADA")[0],He=Ve.getElementsByTagName("parsererror")[0];if(void 0!==He){var Ge,ze=r(He,"div")[0];return Ge=ze?ze.textContent:function(e){for(var t="",r=[e];r.length;){var n=r.shift();n.nodeType===Node.TEXT_NODE?t+=n.textContent:(t+="\n",r.push.apply(r,n.childNodes))}return t.trim()}(He),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",Ge),null}var We=Be.getAttribute("version");console.log("THREE.ColladaLoader: File version",We);var Ke,Xe=function(e){return{unit:l(r(e,"unit")[0]),upAxis:p(r(e,"up_axis")[0])}}(r(Be,"asset")[0]),qe=new n.j(this.manager);qe.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),s&&(Ke=new s(this.manager)).setPath(this.resourcePath||t);var Ye=[],Ze={},$e=0,Je={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};h(Be,"library_animations","animation",(function e(t){for(var r={sources:{},samplers:{},channels:{}},i=!1,a=0,o=t.childNodes.length;a<o;a++){var s,c=t.childNodes[a];if(1===c.nodeType)switch(c.nodeName){case"source":s=c.getAttribute("id"),r.sources[s]=oe(c);break;case"sampler":s=c.getAttribute("id"),r.samplers[s]=v(c);break;case"channel":s=c.getAttribute("target"),r.channels[s]=m(c);break;case"animation":e(c),i=!0;break;default:console.log(c)}}!1===i&&(Je.animations[t.getAttribute("id")||n.H.generateUUID()]=r)})),h(Be,"library_animation_clips","animation_clip",(function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_animation":t.animations.push(c(i.getAttribute("url")))}}Je.clips[e.getAttribute("id")]=t})),h(Be,"library_controllers","controller",(function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"skin":t.id=c(i.getAttribute("source")),t.skin=I(i);break;case"morph":t.id=c(i.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Je.controllers[e.getAttribute("id")]=t})),h(Be,"library_images","image",(function(e){var t={init_from:r(e,"init_from")[0].textContent};Je.images[e.getAttribute("id")]=t})),h(Be,"library_effects","effect",(function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"profile_COMMON":t.profile=F(i)}}Je.effects[e.getAttribute("id")]=t})),h(Be,"library_materials","material",(function(e){for(var t={name:e.getAttribute("name")},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_effect":t.url=c(i.getAttribute("url"))}}Je.materials[e.getAttribute("id")]=t})),h(Be,"library_cameras","camera",(function(e){for(var t={name:e.getAttribute("name")},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"optics":t.optics=$(i)}}Je.cameras[e.getAttribute("id")]=t})),h(Be,"library_lights","light",(function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique_common":t=re(i)}}Je.lights[e.getAttribute("id")]=t})),h(Be,"library_geometries","geometry",(function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},n=r(e,"mesh")[0];if(void 0!==n){for(var i=0;i<n.childNodes.length;i++){var a=n.childNodes[i];if(1===a.nodeType){var o=a.getAttribute("id");switch(a.nodeName){case"source":t.sources[o]=oe(a);break;case"vertices":t.vertices=se(a);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",a.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(ce(a));break;default:console.log(a)}}}Je.geometries[e.getAttribute("id")]=t}})),h(Be,"library_nodes","node",Se),h(Be,"library_visual_scenes","visual_scene",(function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),r=0;r<t.length;r++){var n=t[r];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+$e++)}}(e);for(var n=r(e,"node"),i=0;i<n.length;i++)t.children.push(Se(n[i]));Je.visualScenes[e.getAttribute("id")]=t})),h(Be,"library_kinematics_models","kinematics_model",(function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":ve(n,t)}}Je.kinematicsModels[e.getAttribute("id")]=t})),h(Be,"library_physics_models","physics_model",(function(e){for(var t={name:e.getAttribute("name")||"",rigidBodies:{}},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"rigid_body":t.rigidBodies[n.getAttribute("name")]={},xe(n,t.rigidBodies[n.getAttribute("name")])}}Je.physicsModels[e.getAttribute("id")]=t})),h(Be,"scene","instance_kinematics_scene",(function(e){for(var t={bindJointAxis:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"bind_joint_axis":t.bindJointAxis.push(be(n))}}Je.kinematicsScenes[c(e.getAttribute("url"))]=t})),f(Je.animations,g),f(Je.clips,S),f(Je.controllers,C),f(Je.images,M),f(Je.effects,q),f(Je.materials,Y),f(Je.cameras,ee),f(Je.lights,ie),f(Je.geometries,le),f(Je.visualScenes,Ue),function(){var e=Je.clips;if(!0===u(e)){if(!1===u(Je.animations)){var t=[];for(var r in Je.animations)for(var i=y(r),a=0,o=i.length;a<o;a++)t.push(i[a]);Ye.push(new n.K("default",-1,t))}}else for(var r in e)Ye.push(k(r))}(),function(){var e=Object.keys(Je.kinematicsModels)[0],t=Object.keys(Je.kinematicsScenes)[0],r=Object.keys(Je.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var i,a=(i=e,d(Je.kinematicsModels[i],de)),o=function(e){return d(Je.kinematicsScenes[e],we)}(t),s=je(r),c=o.bindJointAxis,u={},l=0,p=c.length;l<p;l++){var h=c[l],f=Be.querySelector('[sid="'+h.target+'"]');if(f){var v=f.parentElement;g(h.jointIndex,v)}}var m=new n.W;Ze={joints:a&&a.joints,getJointValue:function(e){var t=u[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var r=u[e];if(r){var i=r.joint;if(t>i.limits.max||t<i.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+i.limits.min+", max: "+i.limits.max+").");else if(i.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var a=r.object,o=i.axis,s=r.transforms;Ne.identity();for(var c=0;c<s.length;c++){var l=s[c];if(l.sid&&-1!==l.sid.indexOf(e))switch(i.type){case"revolute":Ne.multiply(m.makeRotationAxis(o,n.H.degToRad(t)));break;case"prismatic":Ne.multiply(m.makeTranslation(o.x*t,o.y*t,o.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+i.type)}else switch(l.type){case"matrix":Ne.multiply(l.obj);break;case"translate":Ne.multiply(m.makeTranslation(l.obj.x,l.obj.y,l.obj.z));break;case"scale":Ne.scale(l.obj);break;case"rotate":Ne.multiply(m.makeRotationAxis(l.obj,l.angle))}}a.matrix.copy(Ne),a.matrix.decompose(a.position,a.quaternion,a.scale),u[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}function g(e,t){var r=t.getAttribute("name"),n=a.joints[e];s.traverse((function(i){i.name===r&&(u[e]={object:i,transforms:Re(t),joint:n,position:n.zeroPosition})}))}}();var Qe=function(e){return je(c(r(e,"instance_visual_scene")[0].getAttribute("url")))}(r(Be,"scene")[0]);return Qe.animations=Ye,"Z_UP"===Xe.upAxis&&Qe.quaternion.setFromEuler(new n.aj(-Math.PI/2,0,0)),Qe.scale.multiplyScalar(Xe.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),Ye},kinematics:Ze,library:Je,scene:Qe}}});var u,l,p=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,r=/^usemtl /,i=/^usemap /,a=new n.V,o=new n.V,s=new n.V,c=new n.V,u=new n.V;function p(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var r=this.object&&"function"===typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var n={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"===typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(n),n},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"===typeof r.clone){var n=r.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){var r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){var n=this.vertices,i=this.object.geometry.vertices;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[r+0],n[r+1],n[r+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){var n=this.normals,i=this.object.geometry.normals;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[r+0],n[r+1],n[r+2])},addFaceNormal:function(e,t,r){var n=this.vertices,i=this.object.geometry.normals;a.fromArray(n,e),o.fromArray(n,t),s.fromArray(n,r),u.subVectors(s,o),c.subVectors(a,o),u.cross(c),u.normalize(),i.push(u.x,u.y,u.z),i.push(u.x,u.y,u.z),i.push(u.x,u.y,u.z)},addColor:function(e,t,r){var n=this.colors,i=this.object.geometry.colors;void 0!==n[e]&&i.push(n[e+0],n[e+1],n[e+2]),void 0!==n[t]&&i.push(n[t+0],n[t+1],n[t+2]),void 0!==n[r]&&i.push(n[r+0],n[r+1],n[r+2])},addUV:function(e,t,r){var n=this.uvs,i=this.object.geometry.uvs;i.push(n[e+0],n[e+1]),i.push(n[t+0],n[t+1]),i.push(n[r+0],n[r+1])},addDefaultUV:function(){var e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,n,i,a,o,s,c){var u=this.vertices.length,l=this.parseVertexIndex(e,u),p=this.parseVertexIndex(t,u),h=this.parseVertexIndex(r,u);if(this.addVertex(l,p,h),this.addColor(l,p,h),void 0!==o&&""!==o){var f=this.normals.length;l=this.parseNormalIndex(o,f),p=this.parseNormalIndex(s,f),h=this.parseNormalIndex(c,f),this.addNormal(l,p,h)}else this.addFaceNormal(l,p,h);if(void 0!==n&&""!==n){var d=this.uvs.length;l=this.parseUVIndex(n,d),p=this.parseUVIndex(i,d),h=this.parseUVIndex(a,d),this.addUV(l,p,h),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,r=0,n=e.length;r<n;r++){var i=this.parseVertexIndex(e[r],t);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var r=this.vertices.length,n=this.uvs.length,i=0,a=e.length;i<a;i++)this.addVertexLine(this.parseVertexIndex(e[i],r));var o=0;for(a=t.length;o<a;o++)this.addUVLine(this.parseUVIndex(t[o],n))}};return e.startObject("",!1),e}function h(e){n.L.call(this,e),this.materials=null}return h.prototype=Object.assign(Object.create(n.L.prototype),{constructor:h,load:function(e,t,r,i){var a=this,o=new n.F(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(r){try{t(a.parse(r))}catch(l){i?i(l):console.error(l),a.manager.itemError(e)}}),r,i)},setMaterials:function(e){return this.materials=e,this},parse:function(a){var o=new p;-1!==a.indexOf("\r\n")&&(a=a.replace(/\r\n/g,"\n")),-1!==a.indexOf("\\\n")&&(a=a.replace(/\\\n/g,""));for(var s=a.split("\n"),c="",u="",l=[],h="function"===typeof"".trimLeft,f=0,d=s.length;f<d;f++)if(c=s[f],0!==(c=h?c.trimLeft():c.trim()).length&&"#"!==(u=c.charAt(0)))if("v"===u){var v=c.split(/\s+/);switch(v[0]){case"v":o.vertices.push(parseFloat(v[1]),parseFloat(v[2]),parseFloat(v[3])),v.length>=7?o.colors.push(parseFloat(v[4]),parseFloat(v[5]),parseFloat(v[6])):o.colors.push(void 0,void 0,void 0);break;case"vn":o.normals.push(parseFloat(v[1]),parseFloat(v[2]),parseFloat(v[3]));break;case"vt":o.uvs.push(parseFloat(v[1]),parseFloat(v[2]))}}else if("f"===u){for(var m=c.substr(1).trim().split(/\s+/),g=[],y=0,E=m.length;y<E;y++){var T=m[y];if(T.length>0){var x=T.split("/");g.push(x)}}var A=g[0];for(y=1,E=g.length-1;y<E;y++){var b=g[y],w=g[y+1];o.addFace(A[0],b[0],w[0],A[1],b[1],w[1],A[2],b[2],w[2])}}else if("l"===u){var R=c.substring(1).trim().split(" "),N=[],_=[];if(-1===c.indexOf("/"))N=R;else for(var S=0,k=R.length;S<k;S++){var I=R[S].split("/");""!==I[0]&&N.push(I[0]),""!==I[1]&&_.push(I[1])}o.addLineGeometry(N,_)}else if("p"===u){var L=c.substr(1).trim().split(" ");o.addPointGeometry(L)}else if(null!==(l=e.exec(c))){var O=(" "+l[0].substr(1).trim()).substr(1);o.startObject(O)}else if(r.test(c))o.object.startMaterial(c.substring(7).trim(),o.materialLibraries);else if(t.test(c))o.materialLibraries.push(c.substring(7).trim());else if(i.test(c))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===u){if((l=c.split(" ")).length>1){var C=l[1].trim().toLowerCase();o.object.smooth="0"!==C&&"off"!==C}else o.object.smooth=!0;(K=o.object.currentMaterial())&&(K.smooth=o.object.smooth)}else{if("\0"===c)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+c+'"')}o.finalize();var M=new n.G;if(M.materialLibraries=[].concat(o.materialLibraries),!0===!(1===o.objects.length&&0===o.objects[0].geometry.vertices.length))for(f=0,d=o.objects.length;f<d;f++){var P=o.objects[f],F=P.geometry,D=P.materials,U="Line"===F.type,j="Points"===F.type,V=!1;if(0!==F.vertices.length){(Z=new n.B).setAttribute("position",new n.d(F.vertices,3)),F.normals.length>0&&Z.setAttribute("normal",new n.d(F.normals,3)),F.colors.length>0&&(V=!0,Z.setAttribute("color",new n.d(F.colors,3))),!0===F.hasUVIndices&&Z.setAttribute("uv",new n.d(F.uvs,2));for(var B,H=[],G=0,z=D.length;G<z;G++){var W=(Y=D[G]).name+"_"+Y.smooth+"_"+V,K=o.materials[W];if(null!==this.materials)if(K=this.materials.create(Y.name),!U||!K||K instanceof n.q){if(j&&K&&!(K instanceof n.P)){var X=new n.P({size:10,sizeAttenuation:!1});n.p.prototype.copy.call(X,K),X.color.copy(K.color),X.map=K.map,K=X}}else{var q=new n.q;n.p.prototype.copy.call(q,K),q.color.copy(K.color),K=q}void 0===K&&((K=U?new n.q:j?new n.P({size:1,sizeAttenuation:!1}):new n.al).name=Y.name,K.flatShading=!Y.smooth,K.vertexColors=V,o.materials[W]=K),H.push(K)}if(H.length>1){for(G=0,z=D.length;G<z;G++){var Y=D[G];Z.addGroup(Y.groupStart,Y.groupCount,G)}B=U?new n.w(Z,H):j?new n.z(Z,H):new n.v(Z,H)}else B=U?new n.w(Z,H[0]):j?new n.z(Z,H[0]):new n.v(Z,H[0]);B.name=P.name,M.add(B)}}else if(o.vertices.length>0){var Z;K=new n.P({size:1,sizeAttenuation:!1});(Z=new n.B).setAttribute("position",new n.d(o.vertices,3)),o.colors.length>0&&void 0!==o.colors[0]&&(Z.setAttribute("color",new n.d(o.colors,3)),K.vertexColors=!0);var $=new n.z(Z,K);M.add($)}return M}}),h}(),h=function(e){n.L.call(this,e)};h.prototype=Object.assign(Object.create(n.L.prototype),{constructor:h,load:function(e,t,r,i){var a=this,o=""===this.path?n.f.extractUrlBase(e):this.path,s=new n.F(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(r){try{t(a.parse(r,o))}catch(l){i?i(l):console.error(l),a.manager.itemError(e)}}),r,i)},setMaterialOptions:function(e){return this.materialOptions=e,this},parse:function(e,t){for(var r=e.split("\n"),n={},i=/\s+/,a={},o=0;o<r.length;o++){var s=r[o];if(0!==(s=s.trim()).length&&"#"!==s.charAt(0)){var c=s.indexOf(" "),u=c>=0?s.substring(0,c):s;u=u.toLowerCase();var l=c>=0?s.substring(c+1):"";if(l=l.trim(),"newmtl"===u)n={name:l},a[l]=n;else if("ka"===u||"kd"===u||"ks"===u||"ke"===u){var p=l.split(i,3);n[u]=[parseFloat(p[0]),parseFloat(p[1]),parseFloat(p[2])]}else n[u]=l}}var f=new h.MaterialCreator(this.resourcePath||t,this.materialOptions);return f.setCrossOrigin(this.crossOrigin),f.setManager(this.manager),f.setMaterials(a),f}}),(h.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:n.a8,this.wrap=this.options&&this.options.wrap?this.options.wrap:n.o}).prototype={constructor:h.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var r in e){var n=e[r],i={};for(var a in t[r]=i,n){var o=!0,s=n[a],c=a.toLowerCase();switch(c){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(o=!1)}o&&(i[c]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,r=this.materialsInfo[e],i={name:e,side:this.side};function a(e,r){if(!i[e]){var n,a,o=t.getTextureParams(r,i),s=t.loadTexture((n=t.baseUrl,"string"!==typeof(a=o.url)||""===a?"":/^https?:\/\//i.test(a)?a:n+a));s.repeat.copy(o.scale),s.offset.copy(o.offset),s.wrapS=t.wrap,s.wrapT=t.wrap,i[e]=s}}for(var o in r){var s,c=r[o];if(""!==c)switch(o.toLowerCase()){case"kd":i.color=(new n.C).fromArray(c);break;case"ks":i.specular=(new n.C).fromArray(c);break;case"ke":i.emissive=(new n.C).fromArray(c);break;case"map_kd":a("map",c);break;case"map_ks":a("specularMap",c);break;case"map_ke":a("emissiveMap",c);break;case"norm":a("normalMap",c);break;case"map_bump":case"bump":a("bumpMap",c);break;case"map_d":a("alphaMap",c),i.transparent=!0;break;case"ns":i.shininess=parseFloat(c);break;case"d":(s=parseFloat(c))<1&&(i.opacity=s,i.transparent=!0);break;case"tr":s=parseFloat(c),this.options&&this.options.invertTrProperty&&(s=1-s),s>0&&(i.opacity=1-s,i.transparent=!0)}}return this.materials[e]=new n.al(i),this.materials[e]},getTextureParams:function(e,t){var r,i={scale:new n.a(1,1),offset:new n.a(0,0)},a=e.split(/\s+/);return(r=a.indexOf("-bm"))>=0&&(t.bumpScale=parseFloat(a[r+1]),a.splice(r,2)),(r=a.indexOf("-s"))>=0&&(i.scale.set(parseFloat(a[r+1]),parseFloat(a[r+2])),a.splice(r,4)),(r=a.indexOf("-o"))>=0&&(i.offset.set(parseFloat(a[r+1]),parseFloat(a[r+2])),a.splice(r,4)),i.url=a.join(" ").trim(),i},loadTexture:function(e,t,r,i,a){var o,s=void 0!==this.manager?this.manager:n.an,c=s.getHandler(e);return null===c&&(c=new n.j(s)),c.setCrossOrigin&&c.setCrossOrigin(this.crossOrigin),o=c.load(e,r,i,a),void 0!==t&&(o.mapping=t),o}},u="undefined"!=typeof self?self:void 0,l=function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=18)}([function(e,t,r){function n(e){return e&&0===e.length}function i(e){return null==e?[]:Object.keys(e)}function a(e){for(var t=[],r=Object.keys(e),n=0;n<r.length;n++)t.push(e[r[n]]);return t}function o(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)t.call(null,e[r],r);else{if(!m(e))throw Error("non exhaustive match");var n=i(e);for(r=0;r<n.length;r++){var a=n[r],o=e[a];t.call(null,o,a)}}}function s(e){return void 0===e}function c(e,t){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n++){var i=e[n];t.call(null,i)&&r.push(i)}return r}function u(e,t){return c(e,(function(e){return!t(e)}))}function l(e,t){return!!m(e)&&e.hasOwnProperty(t)}function p(e,t){return void 0!==d(e,(function(e){return e===t}))}function h(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t}function f(e){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}function d(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(t.call(null,n))return n}}function v(e,t,r){for(var n=Array.isArray(e),o=n?e:a(e),s=n?[]:i(e),c=r,u=0;u<o.length;u++)c=t.call(null,c,o[u],n?u:s[u]);return c}function m(e){return e instanceof Object}function g(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0;n<t.length;n++){var a=t[n];if(!s(a))for(var o=i(a),c=0;c<o.length;c++){var u=o[c];l(e,u)||(e[u]=a[u])}}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.isEmpty=n,t.keys=i,t.values=a,t.mapValues=function(e,t){for(var r=[],n=i(e),a=0;a<n.length;a++){var o=n[a];r.push(t.call(null,e[o],o))}return r},t.map=function(e,t){for(var r=[],n=0;n<e.length;n++)r.push(t.call(null,e[n],n));return r},t.flatten=function e(t){for(var r=[],n=0;n<t.length;n++){var i=t[n];Array.isArray(i)?r=r.concat(e(i)):r.push(i)}return r},t.first=function(e){return n(e)?void 0:e[0]},t.last=function(e){var t=e&&e.length;return t?e[t-1]:void 0},t.forEach=o,t.isString=function(e){return"string"==typeof e},t.isUndefined=s,t.isFunction=function(e){return e instanceof Function},t.drop=function(e,t){return void 0===t&&(t=1),e.slice(t,e.length)},t.dropRight=function(e,t){return void 0===t&&(t=1),e.slice(0,e.length-t)},t.filter=c,t.reject=u,t.pick=function(e,t){for(var r=Object.keys(e),n={},i=0;i<r.length;i++){var a=r[i],o=e[a];t(o)&&(n[a]=o)}return n},t.has=l,t.contains=p,t.cloneArr=h,t.cloneObj=f,t.find=d,t.findAll=function(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n];t.call(null,i)&&r.push(i)}return r},t.reduce=v,t.compact=function(e){return u(e,(function(e){return null==e}))},t.uniq=function(e,t){void 0===t&&(t=function(e){return e});var r=[];return v(e,(function(e,n){var i=t(n);return p(r,i)?e:(r.push(i),e.concat(n))}),[])},t.partial=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=[null].concat(t);return Function.bind.apply(e,n)},t.isArray=function(e){return Array.isArray(e)},t.isRegExp=function(e){return e instanceof RegExp},t.isObject=m,t.every=function(e,t){for(var r=0;r<e.length;r++)if(!t(e[r],r))return!1;return!0},t.difference=function(e,t){return u(e,(function(e){return p(t,e)}))},t.some=function(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return!0;return!1},t.indexOf=function(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return r;return-1},t.sortBy=function(e,t){var r=h(e);return r.sort((function(e,r){return t(e)-t(r)})),r},t.zipObject=function(e,t){if(e.length!==t.length)throw Error("can't zipObject with different number of keys and values!");for(var r={},n=0;n<e.length;n++)r[e[n]]=t[n];return r},t.assign=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0;n<t.length;n++)for(var a=t[n],o=i(a),s=0;s<o.length;s++){var c=o[s];e[c]=a[c]}return e},t.assignNoOverwrite=g,t.defaults=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return g.apply(null,[{}].concat(e))},t.groupBy=function(e,t){var r={};return o(e,(function(e){var n=t(e),i=r[n];i?i.push(e):r[n]=[e]})),r},t.merge=function(e,t){for(var r=f(e),n=i(t),a=0;a<n.length;a++){var o=n[a],s=t[o];r[o]=s}return r},t.NOOP=function(){},t.IDENTITY=function(e){return e},t.packArray=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];t.push(void 0!==n?n:void 0)}return t},t.PRINT_ERROR=function(e){console&&console.error&&console.error("Error: "+e)},t.PRINT_WARNING=function(e){console&&console.warn&&console.warn("Warning: "+e)},t.isES2015MapSupported=function(){return"function"==typeof Map},t.applyMixins=function(e,t){t.forEach((function(t){var r=t.prototype;Object.getOwnPropertyNames(r).forEach((function(n){if("constructor"!==n){var i=Object.getOwnPropertyDescriptor(r,n);i&&(i.get||i.set)?Object.defineProperty(e.prototype,n,i):e.prototype[n]=t.prototype[n]}}))}))},t.toFastProperties=function(e){function t(){}t.prototype=e;var r=new t;function n(){return typeof r.bar}return n(),n(),e}},function(e,t,r){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(2),s=function(){function e(e){this.definition=e}return e.prototype.accept=function(e){e.visit(this),a.forEach(this.definition,(function(t){t.accept(e)}))},e}();t.AbstractProduction=s;var c=function(e){function t(t){var r=e.call(this,[])||this;return r.idx=1,a.assign(r,a.pick(t,(function(e){return void 0!==e}))),r}return i(t,e),Object.defineProperty(t.prototype,"definition",{get:function(){return void 0!==this.referencedRule?this.referencedRule.definition:[]},set:function(e){},enumerable:!0,configurable:!0}),t.prototype.accept=function(e){e.visit(this)},t}(s);t.NonTerminal=c;var u=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.orgText="",a.assign(r,a.pick(t,(function(e){return void 0!==e}))),r}return i(t,e),t}(s);t.Rule=u;var l=function(e){function t(t){var r=e.call(this,t.definition)||this;return a.assign(r,a.pick(t,(function(e){return void 0!==e}))),r}return i(t,e),t}(s);t.Flat=l;var p=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,(function(e){return void 0!==e}))),r}return i(t,e),t}(s);t.Option=p;var h=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,(function(e){return void 0!==e}))),r}return i(t,e),t}(s);t.RepetitionMandatory=h;var f=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,(function(e){return void 0!==e}))),r}return i(t,e),t}(s);t.RepetitionMandatoryWithSeparator=f;var d=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,(function(e){return void 0!==e}))),r}return i(t,e),t}(s);t.Repetition=d;var v=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,(function(e){return void 0!==e}))),r}return i(t,e),t}(s);t.RepetitionWithSeparator=v;var m=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,(function(e){return void 0!==e}))),r}return i(t,e),t}(s);t.Alternation=m;var g=function(){function e(e){this.idx=1,a.assign(this,a.pick(e,(function(e){return void 0!==e})))}return e.prototype.accept=function(e){e.visit(this)},e}();function y(e){function t(e){return a.map(e,y)}if(e instanceof c)return{type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};if(e instanceof l)return{type:"Flat",definition:t(e.definition)};if(e instanceof p)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof h)return{type:"RepetitionMandatory",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof f)return{type:"RepetitionMandatoryWithSeparator",name:e.name,idx:e.idx,separator:y(new g({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof v)return{type:"RepetitionWithSeparator",name:e.name,idx:e.idx,separator:y(new g({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof d)return{type:"Repetition",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof m)return{type:"Alternation",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof g){var r={type:"Terminal",name:o.tokenName(e.terminalType),label:o.tokenLabel(e.terminalType),idx:e.idx},n=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(r.pattern=a.isRegExp(n)?n.source:n),r}if(e instanceof u)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}t.Terminal=g,t.serializeGrammar=function(e){return a.map(e,y)},t.serializeProduction=y},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(4),a=r(15),o=r(7);function s(e){return n.isString(e.LABEL)&&""!==e.LABEL}function c(e){return n.isObject(e)&&e.hasOwnProperty("tokenName")&&n.isString(e.tokenName)?e.tokenName:i.functionName(e)}t.tokenLabel=function(e){return s(e)?e.LABEL:c(e)},t.hasTokenLabel=s,t.tokenName=c;var u="categories",l="label",p="group",h="push_mode",f="pop_mode",d="longer_alt",v="line_breaks",m="start_chars_hint";function g(e){return function(e){var t=e.name,r=e.pattern,a={};if(i.defineNameProp(a,t)||(a.tokenName=t),n.isUndefined(r)||(a.PATTERN=r),n.has(e,"parent"))throw"The parent property is no longer supported.\nSee: https://github.com/SAP/chevrotain/issues/564#issuecomment-349062346 for details.";return n.has(e,u)&&(a.CATEGORIES=e[u]),o.augmentTokenTypes([a]),n.has(e,l)&&(a.LABEL=e[l]),n.has(e,p)&&(a.GROUP=e[p]),n.has(e,f)&&(a.POP_MODE=e[f]),n.has(e,h)&&(a.PUSH_MODE=e[h]),n.has(e,d)&&(a.LONGER_ALT=e[d]),n.has(e,v)&&(a.LINE_BREAKS=e[v]),n.has(e,m)&&(a.START_CHARS_HINT=e[m]),a}(e)}t.createToken=g,t.EOF=g({name:"EOF",pattern:a.Lexer.NA}),o.augmentTokenTypes([t.EOF]),t.createTokenInstance=function(e,t,r,n,i,a,o,s){return{image:t,startOffset:r,endOffset:n,startLine:i,endLine:a,startColumn:o,endColumn:s,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}},t.tokenMatcher=function(e,t){return o.tokenStructuredMatcher(e,t)}},function(e,t,r){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(4),o=r(0),s=r(26),c=r(2),u=r(23),l=r(16),p=r(10),h=r(24),f=r(25),d=r(31),v=r(32),m=r(34),g=r(35),y=r(36),E=r(37),T=r(38);t.END_OF_FILE=c.createTokenInstance(c.EOF,"",NaN,NaN,NaN,NaN,NaN,NaN),Object.freeze(t.END_OF_FILE),t.DEFAULT_PARSER_CONFIG=Object.freeze({recoveryEnabled:!1,maxLookahead:4,ignoredIssues:{},dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:p.defaultParserErrorProvider,serializedGrammar:null}),t.DEFAULT_RULE_CONFIG=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0}),function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.INVALID_NESTED_RULE_NAME=10]="INVALID_NESTED_RULE_NAME",e[e.DUPLICATE_NESTED_NAME=11]="DUPLICATE_NESTED_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=12]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=13]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=14]="TOO_MANY_ALTS"}(t.ParserDefinitionErrorType||(t.ParserDefinitionErrorType={})),t.EMPTY_ALT=function(e){return void 0===e&&(e=void 0),function(){return e}};var x=function(){function e(e,r){void 0===r&&(r=t.DEFAULT_PARSER_CONFIG),this.ignoredIssues=t.DEFAULT_PARSER_CONFIG.ignoredIssues,this.definitionErrors=[],this.selfAnalysisDone=!1,this.initErrorHandler(r),this.initLexerAdapter(),this.initLooksAhead(r),this.initRecognizerEngine(e,r),this.initRecoverable(r),this.initTreeBuilder(r),this.initContentAssist(),this.ignoredIssues=o.has(r,"ignoredIssues")?r.ignoredIssues:t.DEFAULT_PARSER_CONFIG.ignoredIssues,o.toFastProperties(this)}return e.performSelfAnalysis=function(e){e.performSelfAnalysis()},e.prototype.performSelfAnalysis=function(){var t,r=this;this.selfAnalysisDone=!0;var n=a.classNameFromInstance(this),i=this.gastProductionsCache;if(this.serializedGrammar){var c=u.deserializeGrammar(this.serializedGrammar,this.tokensMap);o.forEach(c,(function(e){r.gastProductionsCache.put(e.name,e)}))}var f=h.resolveGrammar({rules:i.values()});if(this.definitionErrors.push.apply(this.definitionErrors,f),o.isEmpty(f)){var d=h.validateGrammar({rules:i.values(),maxLookahead:this.maxLookahead,tokenTypes:o.values(this.tokensMap),ignoredIssues:this.ignoredIssues,errMsgProvider:p.defaultGrammarValidatorErrorProvider,grammarName:n});this.definitionErrors.push.apply(this.definitionErrors,d)}if(o.isEmpty(this.definitionErrors)){var v=s.computeAllProdsFollows(i.values());this.resyncFollows=v}var m=l.analyzeCst(i.values(),this.fullRuleNameToShort);if(this.allRuleNames=m.allRuleNames,!e.DEFER_DEFINITION_ERRORS_HANDLING&&!o.isEmpty(this.definitionErrors))throw t=o.map(this.definitionErrors,(function(e){return e.message})),new Error("Parser Definition Errors detected:\n "+t.join("\n-------------------------------\n"))},e.DEFER_DEFINITION_ERRORS_HANDLING=!1,e}();t.Parser=x,o.applyMixins(x,[f.Recoverable,d.LooksAhead,v.TreeBuilder,m.LexerAdapter,y.RecognizerEngine,g.RecognizerApi,E.ErrorHandler,T.ContentAssist]);var A=function(e){function r(r,n){void 0===n&&(n=t.DEFAULT_PARSER_CONFIG);var i=o.cloneObj(n);return i.outputCst=!0,e.call(this,r,i)||this}return i(r,e),r}(x);t.CstParser=A;var b=function(e){function r(r,n){void 0===n&&(n=t.DEFAULT_PARSER_CONFIG);var i=o.cloneObj(n);return i.outputCst=!1,e.call(this,r,i)||this}return i(r,e),r}(x);t.EmbeddedActionsParser=b},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);t.classNameFromInstance=function(e){return o(e.constructor)};var i=/^\s*function\s*(\S*)\s*\(/,a="name";function o(e){return e.name||e.toString().match(i)[1]}t.functionName=o,t.defineNameProp=function(e,t){var r=Object.getOwnPropertyDescriptor(e,a);return!(!n.isUndefined(r)&&!r.configurable||(Object.defineProperty(e,a,{enumerable:!1,configurable:!0,writable:!1,value:t}),0))};var s=function(){function e(){this._state={}}return e.prototype.keys=function(){return n.keys(this._state)},e.prototype.values=function(){return n.values(this._state)},e.prototype.put=function(e,t){this._state[e]=t},e.prototype.putAll=function(e){this._state=n.assign(this._state,e._state)},e.prototype.get=function(e){return this._state[e]},e.prototype.containsKey=function(e){return n.has(this._state,e)},e.prototype.clear=function(){this._state={}},e}();t.HashTable=s},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=function(){function e(){}return e.prototype.visit=function(e){if(e instanceof n.NonTerminal)return this.visitNonTerminal(e);if(e instanceof n.Flat)return this.visitFlat(e);if(e instanceof n.Option)return this.visitOption(e);if(e instanceof n.RepetitionMandatory)return this.visitRepetitionMandatory(e);if(e instanceof n.RepetitionMandatoryWithSeparator)return this.visitRepetitionMandatoryWithSeparator(e);if(e instanceof n.RepetitionWithSeparator)return this.visitRepetitionWithSeparator(e);if(e instanceof n.Repetition)return this.visitRepetition(e);if(e instanceof n.Alternation)return this.visitAlternation(e);if(e instanceof n.Terminal)return this.visitTerminal(e);if(e instanceof n.Rule)return this.visitRule(e);throw Error("non exhaustive match")},e.prototype.visitNonTerminal=function(e){},e.prototype.visitFlat=function(e){},e.prototype.visitOption=function(e){},e.prototype.visitRepetition=function(e){},e.prototype.visitRepetitionMandatory=function(e){},e.prototype.visitRepetitionMandatoryWithSeparator=function(e){},e.prototype.visitRepetitionWithSeparator=function(e){},e.prototype.visitAlternation=function(e){},e.prototype.visitTerminal=function(e){},e.prototype.visitRule=function(e){},e}();t.GAstVisitor=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i="MismatchedTokenException",a="NoViableAltException",o="EarlyExitException",s="NotAllInputParsedException",c=[i,a,o,s];function u(e,t,r){this.name=i,this.message=e,this.token=t,this.previousToken=r,this.resyncedTokens=[]}function l(e,t,r){this.name=a,this.message=e,this.token=t,this.previousToken=r,this.resyncedTokens=[]}function p(e,t){this.name=s,this.message=e,this.token=t,this.resyncedTokens=[]}function h(e,t,r){this.name=o,this.message=e,this.token=t,this.previousToken=r,this.resyncedTokens=[]}Object.freeze(c),t.isRecognitionException=function(e){return n.contains(c,e.name)},t.MismatchedTokenException=u,u.prototype=Error.prototype,t.NoViableAltException=l,l.prototype=Error.prototype,t.NotAllInputParsedException=p,p.prototype=Error.prototype,t.EarlyExitException=h,h.prototype=Error.prototype},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(4),a=r(2);function o(e){for(var t=n.cloneArr(e),r=e,i=!0;i;){r=n.compact(n.flatten(n.map(r,(function(e){return e.CATEGORIES}))));var a=n.difference(r,t);t=t.concat(a),n.isEmpty(a)?i=!1:r=a}return t}function s(e){n.forEach(e,(function(e){p(e)||(t.tokenIdxToClass.put(t.tokenShortNameIdx,e),e.tokenTypeIdx=t.tokenShortNameIdx++),h(e)&&!n.isArray(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),h(e)||(e.CATEGORIES=[]),f(e)||(e.categoryMatches=[]),d(e)||(e.categoryMatchesMap={}),v(e)||(e.tokenName=a.tokenName(e))}))}function c(e){n.forEach(e,(function(e){e.categoryMatches=[],n.forEach(e.categoryMatchesMap,(function(r,n){e.categoryMatches.push(t.tokenIdxToClass.get(n).tokenTypeIdx)}))}))}function u(e){n.forEach(e,(function(e){l([],e)}))}function l(e,t){n.forEach(e,(function(e){t.categoryMatchesMap[e.tokenTypeIdx]=!0})),n.forEach(t.CATEGORIES,(function(r){var i=e.concat(t);n.contains(i,r)||l(i,r)}))}function p(e){return n.has(e,"tokenTypeIdx")}function h(e){return n.has(e,"CATEGORIES")}function f(e){return n.has(e,"categoryMatches")}function d(e){return n.has(e,"categoryMatchesMap")}function v(e){return n.has(e,"tokenName")}t.tokenStructuredMatcher=function(e,t){var r=e.tokenTypeIdx;return r===t.tokenTypeIdx||!0===t.isParent&&!0===t.categoryMatchesMap[r]},t.tokenStructuredMatcherNoCategories=function(e,t){return e.tokenTypeIdx===t.tokenTypeIdx},t.tokenShortNameIdx=1,t.tokenIdxToClass=new i.HashTable,t.augmentTokenTypes=function(e){var t=o(e);s(t),u(t),c(t),n.forEach(t,(function(e){e.isParent=e.categoryMatches.length>0}))},t.expandCategories=o,t.assignTokenDefaultProps=s,t.assignCategoriesTokensProp=c,t.assignCategoriesMapProp=u,t.singleAssignCategoriesToksMap=l,t.hasShortKeyProperty=p,t.hasCategoriesProperty=h,t.hasExtendingTokensTypesProperty=f,t.hasExtendingTokensTypesMapProperty=d,t.hasTokenNameProperty=v,t.isTokenType=function(e){return n.has(e,"tokenTypeIdx")}},function(e,t,r){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(1),s=r(5),c=r(2);t.isSequenceProd=function(e){return e instanceof o.Flat||e instanceof o.Option||e instanceof o.Repetition||e instanceof o.RepetitionMandatory||e instanceof o.RepetitionMandatoryWithSeparator||e instanceof o.RepetitionWithSeparator||e instanceof o.Terminal||e instanceof o.Rule},t.isOptionalProd=function e(t,r){return void 0===r&&(r=[]),!!(t instanceof o.Option||t instanceof o.Repetition||t instanceof o.RepetitionWithSeparator)||(t instanceof o.Alternation?a.some(t.definition,(function(t){return e(t,r)})):!(t instanceof o.NonTerminal&&a.contains(r,t))&&t instanceof o.AbstractProduction&&(t instanceof o.NonTerminal&&r.push(t),a.every(t.definition,(function(t){return e(t,r)}))))},t.isBranchingProd=function(e){return e instanceof o.Alternation},t.getProductionDslName=function(e){if(e instanceof o.NonTerminal)return"SUBRULE";if(e instanceof o.Option)return"OPTION";if(e instanceof o.Alternation)return"OR";if(e instanceof o.RepetitionMandatory)return"AT_LEAST_ONE";if(e instanceof o.RepetitionMandatoryWithSeparator)return"AT_LEAST_ONE_SEP";if(e instanceof o.RepetitionWithSeparator)return"MANY_SEP";if(e instanceof o.Repetition)return"MANY";if(e instanceof o.Terminal)return"CONSUME";throw Error("non exhaustive match")};var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.separator="-",t.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},t}return i(t,e),t.prototype.visitTerminal=function(e){var t=c.tokenName(e.terminalType)+this.separator+"Terminal";a.has(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},t.prototype.visitNonTerminal=function(e){var t=e.nonTerminalName+this.separator+"Terminal";a.has(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},t.prototype.visitOption=function(e){this.dslMethods.option.push(e)},t.prototype.visitRepetitionWithSeparator=function(e){this.dslMethods.repetitionWithSeparator.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.dslMethods.repetitionMandatory.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)},t.prototype.visitRepetition=function(e){this.dslMethods.repetition.push(e)},t.prototype.visitAlternation=function(e){this.dslMethods.alternation.push(e)},t}(s.GAstVisitor);t.DslMethodsCollectorVisitor=u},function(e,t,r){function n(e,t,r){return r|t|e}Object.defineProperty(t,"__esModule",{value:!0}),t.BITS_FOR_METHOD_IDX=4,t.BITS_FOR_OCCURRENCE_IDX=4,t.BITS_FOR_RULE_IDX=24,t.BITS_FOR_ALT_IDX=8,t.OR_IDX=1<<t.BITS_FOR_METHOD_IDX,t.OPTION_IDX=2<<t.BITS_FOR_METHOD_IDX,t.MANY_IDX=3<<t.BITS_FOR_METHOD_IDX,t.AT_LEAST_ONE_IDX=4<<t.BITS_FOR_METHOD_IDX,t.MANY_SEP_IDX=5<<t.BITS_FOR_METHOD_IDX,t.AT_LEAST_ONE_SEP_IDX=6<<t.BITS_FOR_METHOD_IDX,t.getKeyForAutomaticLookahead=n;var i=32-t.BITS_FOR_ALT_IDX;t.getKeyForAltIndex=function(e,t,r,a){var o=a+1<<i;return n(e,t,r)|o}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(0),a=r(0),o=r(1),s=r(8),c=r(11),u=r(17),l=r(3);t.defaultParserErrorProvider={buildMismatchTokenMessage:function(e){var t=e.expected,r=e.actual;return e.previous,e.ruleName,"Expecting "+(n.hasTokenLabel(t)?"--\x3e "+n.tokenLabel(t)+" <--":"token of type --\x3e "+n.tokenName(t)+" <--")+" but found --\x3e '"+r.image+"' <--"},buildNotAllInputParsedMessage:function(e){var t=e.firstRedundant;return e.ruleName,"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage:function(e){var t=e.expectedPathsPerAlt,r=e.actual,i=(e.previous,e.customUserDescription),o=(e.ruleName,"\nbut found: '"+a.first(r).image+"'");if(i)return"Expecting: "+i+o;var s=a.reduce(t,(function(e,t){return e.concat(t)}),[]),c=a.map(s,(function(e){return"["+a.map(e,(function(e){return n.tokenLabel(e)})).join(", ")+"]"}));return"Expecting: one of these possible Token sequences:\n"+a.map(c,(function(e,t){return"  "+(t+1)+". "+e})).join("\n")+o},buildEarlyExitMessage:function(e){var t=e.expectedIterationPaths,r=e.actual,i=e.customUserDescription,o=(e.ruleName,"\nbut found: '"+a.first(r).image+"'");return i?"Expecting: "+i+o:"Expecting: expecting at least one iteration which starts with one of these possible Token sequences::\n  <"+a.map(t,(function(e){return"["+a.map(e,(function(e){return n.tokenLabel(e)})).join(",")+"]"})).join(" ,")+">"+o}},Object.freeze(t.defaultParserErrorProvider),t.defaultGrammarResolverErrorProvider={buildRuleNotFoundError:function(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+"<-\ninside top level rule: ->"+e.name+"<-"}},t.defaultGrammarValidatorErrorProvider={buildDuplicateFoundError:function(e,t){var r,i=e.name,c=a.first(t),u=c.idx,l=s.getProductionDslName(c),p=(r=c)instanceof o.Terminal?n.tokenName(r.terminalType):r instanceof o.NonTerminal?r.nonTerminalName:"",h="->"+l+"<- with numerical suffix: ->"+u+"<-\n                  "+(p?"and argument: ->"+p+"<-":"")+"\n                  appears more than once ("+t.length+" times) in the top level rule: ->"+i+"<-.\n                  "+(0===u?"Also note that numerical suffix 0 means "+l+" without any suffix.":"")+"\n                  To fix this make sure each usage of "+l+" "+(p?"with the argument: ->"+p+"<-":"")+"\n                  in the rule ->"+i+"<- has a different occurrence index (0-5), as that combination acts as a unique\n                  position key in the grammar, which is needed by the parsing engine.\n                  \n                  For further details see: https://sap.github.io/chevrotain/docs/FAQ.html#NUMERICAL_SUFFIXES \n                  ";return(h=h.replace(/[ \t]+/g," ")).replace(/\s\s+/g,"\n")},buildInvalidNestedRuleNameError:function(e,t){return"Invalid nested rule name: ->"+t.name+"<- inside rule: ->"+e.name+"<-\nit must match the pattern: ->"+c.validNestedRuleName.toString()+"<-.\nNote that this means a nested rule name must start with the '$'(dollar) sign."},buildDuplicateNestedRuleNameError:function(e,t){return"Duplicate nested rule name: ->"+a.first(t).name+"<- inside rule: ->"+e.name+"<-\nA nested name must be unique in the scope of a top level grammar rule."},buildNamespaceConflictError:function(e){return"Namespace conflict found in grammar.\nThe grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <"+e.name+">.\nTo resolve this make sure each Terminal and Non-Terminal names are unique\nThis is easy to accomplish by using the convention that Terminal names start with an uppercase letter\nand Non-Terminal names start with a lower case letter."},buildAlternationPrefixAmbiguityError:function(e){var t=a.map(e.prefixPath,(function(e){return n.tokenLabel(e)})).join(", "),r=0===e.alternation.idx?"":e.alternation.idx;return"Ambiguous alternatives: <"+e.ambiguityIndices.join(" ,")+"> due to common lookahead prefix\nin <OR"+r+"> inside <"+e.topLevelRule.name+"> Rule,\n<"+t+"> may appears as a prefix path in all these alternatives.\nhttps://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX\nFor Further details."},buildAlternationAmbiguityError:function(e){var t=a.map(e.prefixPath,(function(e){return n.tokenLabel(e)})).join(", "),r=0===e.alternation.idx?"":e.alternation.idx,i="Ambiguous alternatives: <"+e.ambiguityIndices.join(" ,")+"> in <OR"+r+"> inside <"+e.topLevelRule.name+"> Rule,\n<"+t+"> may appears as a prefix path in all these alternatives.\n",o=u.VERSION.replace(/\./g,"_");return i+"To Resolve this, try one of of the following: \n1. Refactor your grammar to be LL(K) for the current value of k (by default k="+l.DEFAULT_PARSER_CONFIG.maxLookahead+"})\n2. Increase the value of K for your grammar by providing a larger 'maxLookahead' value in the parser's config\n3. This issue can be ignored (if you know what you are doing...), see https://sap.github.io/chevrotain/documentation/"+o+"/interfaces/iparserconfig.html#ignoredissues for more details\n"},buildEmptyRepetitionError:function(e){var t=s.getProductionDslName(e.repetition);return 0!==e.repetition.idx&&(t+=e.repetition.idx),"The repetition <"+t+"> within Rule <"+e.topLevelRule.name+"> can never consume any tokens.\nThis could lead to an infinite loop."},buildTokenNameError:function(e){return"Invalid Grammar Token name: ->"+n.tokenName(e.tokenType)+"<- it must match the pattern: ->"+e.expectedPattern.toString()+"<-"},buildEmptyAlternationError:function(e){return"Ambiguous empty alternative: <"+(e.emptyChoiceIdx+1)+"> in <OR"+e.alternation.idx+"> inside <"+e.topLevelRule.name+"> Rule.\nOnly the last alternative may be an empty alternative."},buildTooManyAlternativesError:function(e){return"An Alternation cannot have more than 256 alternatives:\n<OR"+e.alternation.idx+"> inside <"+e.topLevelRule.name+"> Rule.\n has "+(e.alternation.definition.length+1)+" alternatives."},buildLeftRecursionError:function(e){var t=e.topLevelRule.name;return"Left Recursion found in grammar.\nrule: <"+t+"> can be invoked from itself (directly or indirectly)\nwithout consuming any Tokens. The grammar path that causes this is: \n "+t+" --\x3e "+i.map(e.leftRecursionPath,(function(e){return e.name})).concat([t]).join(" --\x3e ")+"\n To fix this refactor your grammar to remove the left recursion.\nsee: https://en.wikipedia.org/wiki/LL_parser#Left_Factoring."},buildInvalidRuleNameError:function(e){return"Invalid grammar rule name: ->"+e.topLevelRule.name+"<- it must match the pattern: ->"+e.expectedPattern.toString()+"<-"},buildDuplicateRuleNameError:function(e){return"Duplicate definition, rule: ->"+(e.topLevelRule instanceof o.Rule?e.topLevelRule.name:e.topLevelRule)+"<- is already defined in the grammar: ->"+e.grammarName+"<-"}}},function(e,t,r){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(0),s=r(3),c=r(8),u=r(2),l=r(12),p=r(16),h=r(13),f=r(1),d=r(5);function v(e){return c.getProductionDslName(e)+"_#_"+e.idx+"_#_"+m(e)}function m(e){return e instanceof f.Terminal?u.tokenName(e.terminalType):e instanceof f.NonTerminal?e.nonTerminalName:""}t.validateGrammar=function(e,t,r,n,i,l){var h=a.map(e,(function(e){return function(e,t){var r=new g;e.accept(r);var n=r.allProductions,i=a.groupBy(n,v),o=a.pick(i,(function(e){return e.length>1}));return a.map(a.values(o),(function(r){var n=a.first(r),i=t.buildDuplicateFoundError(e,r),o=c.getProductionDslName(n),u={message:i,type:s.ParserDefinitionErrorType.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:o,occurrence:n.idx},l=m(n);return l&&(u.parameter=l),u}))}(e,i)})),f=a.map(e,(function(e){return A(e,e,i)})),d=[],b=[],w=[];o.every(f,o.isEmpty)&&(d=o.map(e,(function(e){return R(e,i)})),b=o.map(e,(function(e){return N(e,t,n,i)})),w=k(e,t,i));var _=function(e,t,r){var n=[],i=o.map(t,(function(e){return u.tokenName(e)}));return o.forEach(e,(function(e){var t=e.name;if(o.contains(i,t)){var a=r.buildNamespaceConflictError(e);n.push({message:a,type:s.ParserDefinitionErrorType.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:t})}})),n}(e,r,i),I=a.map(r,(function(e){return T(e,i)})),L=function(e,t){var r=[];return o.forEach(e,(function(e){var n=new p.NamedDSLMethodsCollectorVisitor("");e.accept(n);var i=o.map(n.result,(function(e){return e.orgProd}));r.push(o.map(i,(function(r){return E(e,r,t)})))})),o.flatten(r)}(e,i),O=function(e,t){var r=[];return o.forEach(e,(function(e){var n=new p.NamedDSLMethodsCollectorVisitor("");e.accept(n);var i=o.groupBy(n.result,(function(e){return e.name})),a=o.pick(i,(function(e){return e.length>1}));o.forEach(o.values(a),(function(n){var i=o.map(n,(function(e){return e.orgProd})),a=t.buildDuplicateNestedRuleNameError(e,i);r.push({message:a,type:s.ParserDefinitionErrorType.DUPLICATE_NESTED_NAME,ruleName:e.name})}))})),r}(e,i),C=o.map(e,(function(e){return S(e,i)})),M=o.map(e,(function(e){return y(e,i)})),P=o.map(e,(function(t){return x(t,e,l,i)}));return a.flatten(h.concat(I,L,O,w,f,d,b,_,C,M,P))},t.identifyProductionForDuplicates=v;var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allProductions=[],t}return i(t,e),t.prototype.visitNonTerminal=function(e){this.allProductions.push(e)},t.prototype.visitOption=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetition=function(e){this.allProductions.push(e)},t.prototype.visitAlternation=function(e){this.allProductions.push(e)},t.prototype.visitTerminal=function(e){this.allProductions.push(e)},t}(d.GAstVisitor);function y(e,r){var n=[],i=e.name;return i.match(t.validTermsPattern)||n.push({message:r.buildInvalidRuleNameError({topLevelRule:e,expectedPattern:t.validTermsPattern}),type:s.ParserDefinitionErrorType.INVALID_RULE_NAME,ruleName:i}),n}function E(e,r,n){var i,a=[];return r.name.match(t.validNestedRuleName)||(i=n.buildInvalidNestedRuleNameError(e,r),a.push({message:i,type:s.ParserDefinitionErrorType.INVALID_NESTED_RULE_NAME,ruleName:e.name})),a}function T(e,r){var n=[];return u.tokenName(e).match(t.validTermsPattern)||n.push({message:r.buildTokenNameError({tokenType:e,expectedPattern:t.validTermsPattern}),type:s.ParserDefinitionErrorType.INVALID_TOKEN_NAME}),n}function x(e,t,r,n){var i=[];if(o.reduce(t,(function(t,r){return r.name===e.name?t+1:t}),0)>1){var a=n.buildDuplicateRuleNameError({topLevelRule:e,grammarName:r});i.push({message:a,type:s.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function A(e,t,r,n){void 0===n&&(n=[]);var i=[],o=b(t.definition);if(a.isEmpty(o))return[];var c=e.name;a.contains(o,e)&&i.push({message:r.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:n}),type:s.ParserDefinitionErrorType.LEFT_RECURSION,ruleName:c});var u=a.difference(o,n.concat([e])),l=a.map(u,(function(t){var i=a.cloneArr(n);return i.push(t),A(e,t,r,i)}));return i.concat(a.flatten(l))}function b(e){var t=[];if(a.isEmpty(e))return t;var r=a.first(e);if(r instanceof f.NonTerminal)t.push(r.referencedRule);else if(r instanceof f.Flat||r instanceof f.Option||r instanceof f.RepetitionMandatory||r instanceof f.RepetitionMandatoryWithSeparator||r instanceof f.RepetitionWithSeparator||r instanceof f.Repetition)t=t.concat(b(r.definition));else if(r instanceof f.Alternation)t=a.flatten(a.map(r.definition,(function(e){return b(e.definition)})));else if(!(r instanceof f.Terminal))throw Error("non exhaustive match");var n=c.isOptionalProd(r),i=e.length>1;if(n&&i){var o=a.drop(e);return t.concat(b(o))}return t}t.OccurrenceValidationCollector=g,t.validTermsPattern=/^[a-zA-Z_]\w*$/,t.validNestedRuleName=new RegExp(t.validTermsPattern.source.replace("^","^\\$")),t.validateRuleName=y,t.validateNestedRuleName=E,t.validateTokenName=T,t.validateRuleDoesNotAlreadyExist=x,t.validateRuleIsOverridden=function(e,t,r){var n,i=[];return a.contains(t,e)||(n="Invalid rule override, rule: ->"+e+"<- cannot be overridden in the grammar: ->"+r+"<-as it is not defined in any of the super grammars ",i.push({message:n,type:s.ParserDefinitionErrorType.INVALID_RULE_OVERRIDE,ruleName:e})),i},t.validateNoLeftRecursion=A,t.getFirstNoneTerminal=b;var w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.alternations=[],t}return i(t,e),t.prototype.visitAlternation=function(e){this.alternations.push(e)},t}(d.GAstVisitor);function R(e,t){var r=new w;e.accept(r);var n=r.alternations;return a.reduce(n,(function(r,n){var i=a.dropRight(n.definition),o=a.map(i,(function(r,i){var o=h.nextPossibleTokensAfter([r],[],null,1);return a.isEmpty(o)?{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:n,emptyChoiceIdx:i}),type:s.ParserDefinitionErrorType.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:n.idx,alternative:i+1}:null}));return r.concat(a.compact(o))}),[])}function N(e,t,r,n){var i=new w;e.accept(i);var u=i.alternations,p=r[e.name];return p&&(u=o.reject(u,(function(e){return p[c.getProductionDslName(e)+(0===e.idx?"":e.idx)]}))),a.reduce(u,(function(r,i){var c=i.idx,u=l.getLookaheadPathsForOr(c,e,t),p=function(e,t,r,n){var i=[],c=o.reduce(e,(function(t,r,n){return o.forEach(r,(function(r){var a=[n];o.forEach(e,(function(e,t){n!==t&&l.containsPath(e,r)&&a.push(t)})),a.length>1&&!l.containsPath(i,r)&&(i.push(r),t.push({alts:a,path:r}))})),t}),[]);return a.map(c,(function(e){var i=o.map(e.alts,(function(e){return e+1}));return{message:n.buildAlternationAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:i,prefixPath:e.path}),type:s.ParserDefinitionErrorType.AMBIGUOUS_ALTS,ruleName:r.name,occurrence:t.idx,alternatives:[e.alts]}}))}(u,i,e,n),h=I(u,i,e,n);return r.concat(p,h)}),[])}t.validateEmptyOrAlternative=R,t.validateAmbiguousAlternationAlternatives=N;var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allProductions=[],t}return i(t,e),t.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetition=function(e){this.allProductions.push(e)},t}(d.GAstVisitor);function S(e,t){var r=new w;e.accept(r);var n=r.alternations;return a.reduce(n,(function(r,n){return n.definition.length>255&&r.push({message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:n}),type:s.ParserDefinitionErrorType.TOO_MANY_ALTS,ruleName:e.name,occurrence:n.idx}),r}),[])}function k(e,t,r){var n=[];return o.forEach(e,(function(e){var i=new _;e.accept(i);var a=i.allProductions;o.forEach(a,(function(i){var a=l.getProdType(i),c=i.idx,u=l.getLookaheadPathsForOptionalProd(c,e,a,t)[0];if(o.isEmpty(o.flatten(u))){var p=r.buildEmptyRepetitionError({topLevelRule:e,repetition:i});n.push({message:p,type:s.ParserDefinitionErrorType.NO_NON_EMPTY_LOOKAHEAD,ruleName:e.name})}}))})),n}function I(e,t,r,n){var i=[],a=o.reduce(e,(function(e,t,r){var n=o.map(t,(function(e){return{idx:r,path:e}}));return e.concat(n)}),[]);return o.forEach(a,(function(e){var c=e.idx,u=e.path,p=o.findAll(a,(function(e){return e.idx<c&&l.isStrictPrefixOfPath(e.path,u)})),h=o.map(p,(function(e){var i=[e.idx+1,c+1],a=0===t.idx?"":t.idx;return{message:n.buildAlternationPrefixAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:i,prefixPath:e.path}),type:s.ParserDefinitionErrorType.AMBIGUOUS_PREFIX_ALTS,ruleName:r.name,occurrence:a,alternatives:i}}));i=i.concat(h)})),i}t.RepetionCollector=_,t.validateTooManyAlts=S,t.validateSomeNonEmptyLookaheadPath=k,t.checkPrefixAlternativesAmbiguities=I},function(e,t,r){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a,o=r(0),s=r(13),c=r(14),u=r(7),l=r(1),p=r(5);!function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"}(a=t.PROD_TYPE||(t.PROD_TYPE={})),t.getProdType=function(e){if(e instanceof l.Option)return a.OPTION;if(e instanceof l.Repetition)return a.REPETITION;if(e instanceof l.RepetitionMandatory)return a.REPETITION_MANDATORY;if(e instanceof l.RepetitionMandatoryWithSeparator)return a.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof l.RepetitionWithSeparator)return a.REPETITION_WITH_SEPARATOR;if(e instanceof l.Alternation)return a.ALTERNATION;throw Error("non exhaustive match")},t.buildLookaheadFuncForOr=function(e,t,r,n,i,a){var o=v(e,t,r);return a(o,n,y(o)?u.tokenStructuredMatcherNoCategories:u.tokenStructuredMatcher,i)},t.buildLookaheadFuncForOptionalProd=function(e,t,r,n,i,a){var o=m(e,t,i,r),s=y(o)?u.tokenStructuredMatcherNoCategories:u.tokenStructuredMatcher;return a(o[0],s,n)},t.buildAlternativesLookAheadFunc=function(e,t,r,n){var i=e.length,a=o.every(e,(function(e){return o.every(e,(function(e){return 1===e.length}))}));if(t)return function(t){for(var n=o.map(t,(function(e){return e.GATE})),a=0;a<i;a++){var s=e[a],c=s.length,u=n[a];if(void 0===u||!1!==u.call(this))e:for(var l=0;l<c;l++){for(var p=s[l],h=p.length,f=0;f<h;f++){var d=this.LA(f+1);if(!1===r(d,p[f]))continue e}return a}}};if(a&&!n){var s=o.map(e,(function(e){return o.flatten(e)})),c=o.reduce(s,(function(e,t,r){return o.forEach(t,(function(t){o.has(e,t.tokenTypeIdx)||(e[t.tokenTypeIdx]=r),o.forEach(t.categoryMatches,(function(t){o.has(e,t)||(e[t]=r)}))})),e}),[]);return function(){var e=this.LA(1);return c[e.tokenTypeIdx]}}return function(){for(var t=0;t<i;t++){var n=e[t],a=n.length;e:for(var o=0;o<a;o++){for(var s=n[o],c=s.length,u=0;u<c;u++){var l=this.LA(u+1);if(!1===r(l,s[u]))continue e}return t}}}},t.buildSingleAlternativeLookaheadFunction=function(e,t,r){var n=o.every(e,(function(e){return 1===e.length})),i=e.length;if(n&&!r){var a=o.flatten(e);if(1===a.length&&o.isEmpty(a[0].categoryMatches)){var s=a[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===s}}var c=o.reduce(a,(function(e,t,r){return e[t.tokenTypeIdx]=!0,o.forEach(t.categoryMatches,(function(t){e[t]=!0})),e}),[]);return function(){var e=this.LA(1);return!0===c[e.tokenTypeIdx]}}return function(){e:for(var r=0;r<i;r++){for(var n=e[r],a=n.length,o=0;o<a;o++){var s=this.LA(o+1);if(!1===t(s,n[o]))continue e}return!0}return!1}};var h=function(e){function t(t,r,n){var i=e.call(this)||this;return i.topProd=t,i.targetOccurrence=r,i.targetProdType=n,i}return i(t,e),t.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},t.prototype.checkIsTarget=function(e,t,r,n){return e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.restDef=r.concat(n),!0)},t.prototype.walkOption=function(t,r,n){this.checkIsTarget(t,a.OPTION,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkAtLeastOne=function(t,r,n){this.checkIsTarget(t,a.REPETITION_MANDATORY,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkAtLeastOneSep=function(t,r,n){this.checkIsTarget(t,a.REPETITION_MANDATORY_WITH_SEPARATOR,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkMany=function(t,r,n){this.checkIsTarget(t,a.REPETITION,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkManySep=function(t,r,n){this.checkIsTarget(t,a.REPETITION_WITH_SEPARATOR,r,n)||e.prototype.walkOption.call(this,t,r,n)},t}(c.RestWalker),f=function(e){function t(t,r){var n=e.call(this)||this;return n.targetOccurrence=t,n.targetProdType=r,n.result=[],n}return i(t,e),t.prototype.checkIsTarget=function(e,t){e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.result=e.definition)},t.prototype.visitOption=function(e){this.checkIsTarget(e,a.OPTION)},t.prototype.visitRepetition=function(e){this.checkIsTarget(e,a.REPETITION)},t.prototype.visitRepetitionMandatory=function(e){this.checkIsTarget(e,a.REPETITION_MANDATORY)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.checkIsTarget(e,a.REPETITION_MANDATORY_WITH_SEPARATOR)},t.prototype.visitRepetitionWithSeparator=function(e){this.checkIsTarget(e,a.REPETITION_WITH_SEPARATOR)},t.prototype.visitAlternation=function(e){this.checkIsTarget(e,a.ALTERNATION)},t}(p.GAstVisitor);function d(e,t){function r(e,t){return o.reduce(e,(function(e,r,n){if(n!==t){var i=o.map(r,(function(e){return e.partialPath}));return e.concat(i)}return e}),[])}function n(e,t){return void 0===o.find(e,(function(e){return o.every(t,(function(t,r){return(n=t)===(i=e[r])||n&&i&&(n.categoryMatchesMap[i.tokenTypeIdx]||i.categoryMatchesMap[n.tokenTypeIdx]);var n,i}))}))}function i(e){for(var t=[],r=0;r<e;r++)t.push([]);return t}for(var a=o.map(e,(function(e){return s.possiblePathsFrom([e],1)})),c=i(a.length),u=a,l=1;l<=t;l++){var p=u;u=i(p.length);for(var h=0;h<p.length;h++)for(var f=p[h],d=r(p,h),v=0;v<f.length;v++){var m=f[v].partialPath,y=f[v].suffixDef;if(n(d,m)||o.isEmpty(y)||m.length===t){var E=c[h];g(E,m)||E.push(m)}else{var T=s.possiblePathsFrom(y,l+1,m);u[h]=u[h].concat(T)}}}return c}function v(e,t,r){var n=new f(e,a.ALTERNATION);return t.accept(n),d(n.result,r)}function m(e,t,r,n){var i=new f(e,r);t.accept(i);var a=i.result,o=new h(t,e,r).startWalking();return d([new l.Flat({definition:a}),new l.Flat({definition:o})],n)}function g(e,t){return void 0!==o.find(e,(function(e){return t.length===e.length&&o.every(t,(function(t,r){return t===e[r]||e[r].categoryMatchesMap[t.tokenTypeIdx]}))}))}function y(e){return o.every(e,(function(e){return o.every(e,(function(e){return o.every(e,(function(e){return o.isEmpty(e.categoryMatches)}))}))}))}t.lookAheadSequenceFromAlternatives=d,t.getLookaheadPathsForOr=v,t.getLookaheadPathsForOptionalProd=m,t.containsPath=g,t.isStrictPrefixOfPath=function(e,t){return e.length<t.length&&o.every(e,(function(e,r){var n=t[r];return e===n||n.categoryMatchesMap[e.tokenTypeIdx]}))},t.areTokenCategoriesNotUsed=y},function(e,t,r){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(14),o=r(0),s=r(2),c=r(21),u=r(1),l=function(e){function t(t,r){var n=e.call(this)||this;return n.topProd=t,n.path=r,n.possibleTokTypes=[],n.nextProductionName="",n.nextProductionOccurrence=0,n.found=!1,n.isAtEndOfPath=!1,n}return i(t,e),t.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=o.cloneArr(this.path.ruleStack).reverse(),this.occurrenceStack=o.cloneArr(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},t.prototype.walk=function(t,r){void 0===r&&(r=[]),this.found||e.prototype.walk.call(this,t,r)},t.prototype.walkProdRef=function(e,t,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){var n=t.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,n)}},t.prototype.updateExpectedNext=function(){o.isEmpty(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},t}(a.RestWalker);t.AbstractNextPossibleTokensWalker=l;var p=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.path=r,n.nextTerminalName="",n.nextTerminalOccurrence=0,n.nextTerminalName=s.tokenName(n.path.lastTok),n.nextTerminalOccurrence=n.path.lastTokOccurrence,n}return i(t,e),t.prototype.walkTerminal=function(e,t,r){if(this.isAtEndOfPath&&s.tokenName(e.terminalType)===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){var n=t.concat(r),i=new u.Flat({definition:n});this.possibleTokTypes=c.first(i),this.found=!0}},t}(l);t.NextAfterTokenWalker=p;var h=function(e){function t(t,r){var n=e.call(this)||this;return n.topRule=t,n.occurrence=r,n.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},n}return i(t,e),t.prototype.startWalking=function(){return this.walk(this.topRule),this.result},t}(a.RestWalker);t.AbstractNextTerminalAfterProductionWalker=h;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkMany=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof u.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkMany.call(this,t,r,n)},t}(h);t.NextTerminalAfterManyWalker=f;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkManySep=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof u.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkManySep.call(this,t,r,n)},t}(h);t.NextTerminalAfterManySepWalker=d;var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkAtLeastOne=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof u.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkAtLeastOne.call(this,t,r,n)},t}(h);t.NextTerminalAfterAtLeastOneWalker=v;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkAtLeastOneSep=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof u.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkAtLeastOneSep.call(this,t,r,n)},t}(h);function g(e,t,r,n){var i=o.cloneArr(r);i.push(e.name);var a=o.cloneArr(n);return a.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:a}}t.NextTerminalAfterAtLeastOneSepWalker=m,t.possiblePathsFrom=function e(t,r,n){void 0===n&&(n=[]),n=o.cloneArr(n);var i=[],a=0;function s(s){var c=e(s.concat(o.drop(t,a+1)),r,n);return i.concat(c)}for(;n.length<r&&a<t.length;){var c=t[a];if(c instanceof u.Flat)return s(c.definition);if(c instanceof u.NonTerminal)return s(c.definition);if(c instanceof u.Option)i=s(c.definition);else{if(c instanceof u.RepetitionMandatory)return s(l=c.definition.concat([new u.Repetition({definition:c.definition})]));if(c instanceof u.RepetitionMandatoryWithSeparator)return s(l=[new u.Flat({definition:c.definition}),new u.Repetition({definition:[new u.Terminal({terminalType:c.separator})].concat(c.definition)})]);if(c instanceof u.RepetitionWithSeparator){var l=c.definition.concat([new u.Repetition({definition:[new u.Terminal({terminalType:c.separator})].concat(c.definition)})]);i=s(l)}else if(c instanceof u.Repetition)l=c.definition.concat([new u.Repetition({definition:c.definition})]),i=s(l);else{if(c instanceof u.Alternation)return o.forEach(c.definition,(function(e){i=s(e.definition)})),i;if(!(c instanceof u.Terminal))throw Error("non exhaustive match");n.push(c.terminalType)}}a++}return i.push({partialPath:n,suffixDef:o.drop(t,a)}),i},t.nextPossibleTokensAfter=function(e,t,r,n){var i=["EXIT_NONE_TERMINAL"],a=!1,s=t.length,c=s-n-1,l=[],p=[];for(p.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!o.isEmpty(p);){var h=p.pop();if("EXIT_ALTERNATIVE"!==h){var f=h.def,d=h.idx,v=h.ruleStack,m=h.occurrenceStack;if(!o.isEmpty(f)){var y=f[0];if("EXIT_NONE_TERMINAL"===y){var E={idx:d,def:o.drop(f),ruleStack:o.dropRight(v),occurrenceStack:o.dropRight(m)};p.push(E)}else if(y instanceof u.Terminal)if(d<s-1){var T=d+1;r(t[T],y.terminalType)&&(E={idx:T,def:o.drop(f),ruleStack:v,occurrenceStack:m},p.push(E))}else{if(d!==s-1)throw Error("non exhaustive match");l.push({nextTokenType:y.terminalType,nextTokenOccurrence:y.idx,ruleStack:v,occurrenceStack:m}),a=!0}else if(y instanceof u.NonTerminal){var x=o.cloneArr(v);x.push(y.nonTerminalName);var A=o.cloneArr(m);A.push(y.idx),E={idx:d,def:y.definition.concat(i,o.drop(f)),ruleStack:x,occurrenceStack:A},p.push(E)}else if(y instanceof u.Option){var b={idx:d,def:o.drop(f),ruleStack:v,occurrenceStack:m};p.push(b),p.push("EXIT_ALTERNATIVE");var w={idx:d,def:y.definition.concat(o.drop(f)),ruleStack:v,occurrenceStack:m};p.push(w)}else if(y instanceof u.RepetitionMandatory){var R=new u.Repetition({definition:y.definition,idx:y.idx});E={idx:d,def:y.definition.concat([R],o.drop(f)),ruleStack:v,occurrenceStack:m},p.push(E)}else if(y instanceof u.RepetitionMandatoryWithSeparator){var N=new u.Terminal({terminalType:y.separator});R=new u.Repetition({definition:[N].concat(y.definition),idx:y.idx}),E={idx:d,def:y.definition.concat([R],o.drop(f)),ruleStack:v,occurrenceStack:m},p.push(E)}else if(y instanceof u.RepetitionWithSeparator){b={idx:d,def:o.drop(f),ruleStack:v,occurrenceStack:m},p.push(b),p.push("EXIT_ALTERNATIVE"),N=new u.Terminal({terminalType:y.separator});var _=new u.Repetition({definition:[N].concat(y.definition),idx:y.idx});w={idx:d,def:y.definition.concat([_],o.drop(f)),ruleStack:v,occurrenceStack:m},p.push(w)}else if(y instanceof u.Repetition)b={idx:d,def:o.drop(f),ruleStack:v,occurrenceStack:m},p.push(b),p.push("EXIT_ALTERNATIVE"),_=new u.Repetition({definition:y.definition,idx:y.idx}),w={idx:d,def:y.definition.concat([_],o.drop(f)),ruleStack:v,occurrenceStack:m},p.push(w);else if(y instanceof u.Alternation)for(var S=y.definition.length-1;S>=0;S--){var k={idx:d,def:y.definition[S].definition.concat(o.drop(f)),ruleStack:v,occurrenceStack:m};p.push(k),p.push("EXIT_ALTERNATIVE")}else if(y instanceof u.Flat)p.push({idx:d,def:y.definition.concat(o.drop(f)),ruleStack:v,occurrenceStack:m});else{if(!(y instanceof u.Rule))throw Error("non exhaustive match");p.push(g(y,d,v,m))}}}else a&&o.last(p).idx<=c&&p.pop()}return l}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(1),a=function(){function e(){}return e.prototype.walk=function(e,t){var r=this;void 0===t&&(t=[]),n.forEach(e.definition,(function(a,o){var s=n.drop(e.definition,o+1);if(a instanceof i.NonTerminal)r.walkProdRef(a,s,t);else if(a instanceof i.Terminal)r.walkTerminal(a,s,t);else if(a instanceof i.Flat)r.walkFlat(a,s,t);else if(a instanceof i.Option)r.walkOption(a,s,t);else if(a instanceof i.RepetitionMandatory)r.walkAtLeastOne(a,s,t);else if(a instanceof i.RepetitionMandatoryWithSeparator)r.walkAtLeastOneSep(a,s,t);else if(a instanceof i.RepetitionWithSeparator)r.walkManySep(a,s,t);else if(a instanceof i.Repetition)r.walkMany(a,s,t);else{if(!(a instanceof i.Alternation))throw Error("non exhaustive match");r.walkOr(a,s,t)}}))},e.prototype.walkTerminal=function(e,t,r){},e.prototype.walkProdRef=function(e,t,r){},e.prototype.walkFlat=function(e,t,r){var n=t.concat(r);this.walk(e,n)},e.prototype.walkOption=function(e,t,r){var n=t.concat(r);this.walk(e,n)},e.prototype.walkAtLeastOne=function(e,t,r){var n=[new i.Option({definition:e.definition})].concat(t,r);this.walk(e,n)},e.prototype.walkAtLeastOneSep=function(e,t,r){var n=o(e,t,r);this.walk(e,n)},e.prototype.walkMany=function(e,t,r){var n=[new i.Option({definition:e.definition})].concat(t,r);this.walk(e,n)},e.prototype.walkManySep=function(e,t,r){var n=o(e,t,r);this.walk(e,n)},e.prototype.walkOr=function(e,t,r){var a=this,o=t.concat(r);n.forEach(e.definition,(function(e){var t=new i.Flat({definition:[e]});a.walk(t,o)}))},e}();function o(e,t,r){return[new i.Option({definition:[new i.Terminal({terminalType:e.separator})].concat(e.definition)})].concat(t,r)}t.RestWalker=a},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(27),i=r(0),a=r(7),o=r(20);!function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK"}(t.LexerDefinitionErrorType||(t.LexerDefinitionErrorType={}));var s={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:["\n","\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:o.defaultLexerErrorProvider};Object.freeze(s);var c=function(){function e(e,t){var r=this;if(void 0===t&&(t=s),this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.config=void 0,this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},"boolean"==typeof t)throw Error("The second argument to the Lexer constructor is now an ILexerConfig Object.\na boolean 2nd argument is no longer supported");if(this.config=i.merge(s,t),this.config.lineTerminatorsPattern===s.lineTerminatorsPattern)this.config.lineTerminatorsPattern=n.LineTerminatorOptimizedTester;else if(this.config.lineTerminatorCharacters===s.lineTerminatorCharacters)throw Error("Error: Missing <lineTerminatorCharacters> property on the Lexer config.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS");if(t.safeMode&&t.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking);var o,c=!0;i.isArray(e)?((o={modes:{}}).modes[n.DEFAULT_MODE]=i.cloneArr(e),o[n.DEFAULT_MODE]=n.DEFAULT_MODE):(c=!1,o=i.cloneObj(e)),this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(n.performRuntimeChecks(o,this.trackStartLines,this.config.lineTerminatorCharacters)),this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(n.performWarningRuntimeChecks(o,this.trackStartLines,this.config.lineTerminatorCharacters)),o.modes=o.modes?o.modes:{},i.forEach(o.modes,(function(e,t){o.modes[t]=i.reject(e,(function(e){return i.isUndefined(e)}))}));var u=i.keys(o.modes);if(i.forEach(o.modes,(function(e,o){if(r.modes.push(o),r.lexerDefinitionErrors=r.lexerDefinitionErrors.concat(n.validatePatterns(e,u)),i.isEmpty(r.lexerDefinitionErrors)){a.augmentTokenTypes(e);var s=n.analyzeTokenTypes(e,{lineTerminatorCharacters:r.config.lineTerminatorCharacters,positionTracking:t.positionTracking,ensureOptimizations:t.ensureOptimizations,safeMode:t.safeMode});r.patternIdxToConfig[o]=s.patternIdxToConfig,r.charCodeToPatternIdxToConfig[o]=s.charCodeToPatternIdxToConfig,r.emptyGroups=i.merge(r.emptyGroups,s.emptyGroups),r.hasCustom=s.hasCustom||r.hasCustom,r.canModeBeOptimized[o]=s.canBeOptimized}})),this.defaultMode=o.defaultMode,!i.isEmpty(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){var l=i.map(this.lexerDefinitionErrors,(function(e){return e.message})).join("-----------------------\n");throw new Error("Errors detected in definition of Lexer:\n"+l)}if(i.forEach(this.lexerDefinitionWarning,(function(e){i.PRINT_WARNING(e.message)})),n.SUPPORT_STICKY?(this.chopInput=i.IDENTITY,this.match=this.matchWithTest):(this.updateLastIndex=i.NOOP,this.match=this.matchWithExec),c&&(this.handleModes=i.NOOP),!1===this.trackStartLines&&(this.computeNewColumn=i.IDENTITY),!1===this.trackEndLines&&(this.updateTokenEndLineColumnLocation=i.NOOP),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else{if(!/onlyOffset/i.test(this.config.positionTracking))throw Error('Invalid <positionTracking> config option: "'+this.config.positionTracking+'"');this.createTokenInstance=this.createOffsetOnlyToken}this.hasCustom?this.addToken=this.addTokenUsingPush:this.addToken=this.addTokenUsingMemberAccess;var p=i.reduce(this.canModeBeOptimized,(function(e,t,r){return!1===t&&e.push(r),e}),[]);if(t.ensureOptimizations&&!i.isEmpty(p))throw Error("Lexer Modes: < "+p.join(", ")+' > cannot be optimized.\n\t Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.\n\t Or inspect the console log for details on how to resolve these issues.')}return e.prototype.tokenize=function(e,t){if(void 0===t&&(t=this.defaultMode),!i.isEmpty(this.lexerDefinitionErrors)){var r=i.map(this.lexerDefinitionErrors,(function(e){return e.message})).join("-----------------------\n");throw new Error("Unable to Tokenize because Errors detected in definition of Lexer:\n"+r)}return this.tokenizeInternal(e,t)},e.prototype.tokenizeInternal=function(e,t){var r,a,o,s,c,u,l,p,h,f,d,v,m=this,g=e,y=g.length,E=0,T=0,x=this.hasCustom?0:Math.floor(e.length/10),A=new Array(x),b=[],w=this.trackStartLines?1:void 0,R=this.trackStartLines?1:void 0,N=n.cloneEmptyGroups(this.emptyGroups),_=this.trackStartLines,S=this.config.lineTerminatorsPattern,k=0,I=[],L=[],O=[],C=[];Object.freeze(C);var M,P=void 0,F=function(e){if(1===O.length&&void 0===e.tokenType.PUSH_MODE){var t=m.config.errorMessageProvider.buildUnableToPopLexerModeMessage(e);b.push({offset:e.startOffset,line:void 0!==e.startLine?e.startLine:void 0,column:void 0!==e.startColumn?e.startColumn:void 0,length:e.image.length,message:t})}else{O.pop();var r=i.last(O);I=m.patternIdxToConfig[r],L=m.charCodeToPatternIdxToConfig[r],k=I.length;var n=m.canModeBeOptimized[r]&&!1===m.config.safeMode;P=L&&n?function(e){var t=L[e];return void 0===t?C:t}:function(){return I}}};function D(e){O.push(e),L=this.charCodeToPatternIdxToConfig[e],I=this.patternIdxToConfig[e],k=I.length,k=I.length;var t=this.canModeBeOptimized[e]&&!1===this.config.safeMode;P=L&&t?function(e){var t=L[e];return void 0===t?C:t}:function(){return I}}for(D.call(this,t);E<y;){c=null;var U=g.charCodeAt(E),j=P(U),V=j.length;for(r=0;r<V;r++){var B=(M=j[r]).pattern;if(!1!==($=M.short)?U===$&&(c=B):!0===M.isCustom?c=null!==(v=B.exec(g,E,A,N))?v[0]:v:(this.updateLastIndex(B,E),c=this.match(B,e,E)),null!==c){if(void 0!==(s=M.longerAlt)){var H=I[s],G=H.pattern;!0===H.isCustom?o=null!==(v=G.exec(g,E,A,N))?v[0]:v:(this.updateLastIndex(G,E),o=this.match(G,e,E)),o&&o.length>c.length&&(c=o,M=H)}break}}if(null!==c){if(u=c.length,void 0!==(l=M.group)&&(p=M.tokenTypeIdx,h=this.createTokenInstance(c,E,p,M.tokenType,w,R,u),!1===l?T=this.addToken(A,T,h):N[l].push(h)),e=this.chopInput(e,u),E+=u,R=this.computeNewColumn(R,u),!0===_&&!0===M.canLineTerminator){var z=0,W=void 0,K=void 0;S.lastIndex=0;do{!0===(W=S.test(c))&&(K=S.lastIndex-1,z++)}while(W);0!==z&&(w+=z,R=u-K,this.updateTokenEndLineColumnLocation(h,l,K,z,w,R,u))}this.handleModes(M,F,D,h)}else{for(var X=E,q=w,Y=R,Z=!1;!Z&&E<y;)for(g.charCodeAt(E),e=this.chopInput(e,1),E++,a=0;a<k;a++){var $,J=I[a];if(B=J.pattern,!1!==($=J.short)?g.charCodeAt(E)===$&&(Z=!0):!0===J.isCustom?Z=null!==B.exec(g,E,A,N):(this.updateLastIndex(B,E),Z=null!==B.exec(e)),!0===Z)break}f=E-X,d=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(g,X,f,q,Y),b.push({offset:X,line:q,column:Y,length:f,message:d})}}return this.hasCustom||(A.length=T),{tokens:A,groups:N,errors:b}},e.prototype.handleModes=function(e,t,r,n){if(!0===e.pop){var i=e.push;t(n),void 0!==i&&r.call(this,i)}else void 0!==e.push&&r.call(this,e.push)},e.prototype.chopInput=function(e,t){return e.substring(t)},e.prototype.updateLastIndex=function(e,t){e.lastIndex=t},e.prototype.updateTokenEndLineColumnLocation=function(e,t,r,n,i,a,o){var s,c;void 0!==t&&(c=(s=r===o-1)?-1:0,1===n&&!0===s||(e.endLine=i+c,e.endColumn=a-1-c))},e.prototype.computeNewColumn=function(e,t){return e+t},e.prototype.createTokenInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return null},e.prototype.createOffsetOnlyToken=function(e,t,r,n){return{image:e,startOffset:t,tokenTypeIdx:r,tokenType:n}},e.prototype.createStartOnlyToken=function(e,t,r,n,i,a){return{image:e,startOffset:t,startLine:i,startColumn:a,tokenTypeIdx:r,tokenType:n}},e.prototype.createFullToken=function(e,t,r,n,i,a,o){return{image:e,startOffset:t,endOffset:t+o-1,startLine:i,endLine:i,startColumn:a,endColumn:a+o-1,tokenTypeIdx:r,tokenType:n}},e.prototype.addToken=function(e,t,r){return 666},e.prototype.addTokenUsingPush=function(e,t,r){return e.push(r),t},e.prototype.addTokenUsingMemberAccess=function(e,t,r){return e[t]=r,++t},e.prototype.match=function(e,t,r){return null},e.prototype.matchWithTest=function(e,t,r){return!0===e.test(t)?t.substring(r,e.lastIndex):null},e.prototype.matchWithExec=function(e,t){var r=e.exec(t);return null!==r?r[0]:r},e.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",e.NA=/NOT_APPLICABLE/,e}();t.Lexer=c},function(e,t,r){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(4),s=r(9),c=r(1),u=r(5);t.addTerminalToCst=function(e,t,r){void 0===e.children[r]?e.children[r]=[t]:e.children[r].push(t)},t.addNoneTerminalToCst=function(e,t,r){void 0===e.children[t]?e.children[t]=[r]:e.children[t].push(r)};var l=function(e){function t(t){var r=e.call(this)||this;return r.result=[],r.ruleIdx=t,r}return i(t,e),t.prototype.collectNamedDSLMethod=function(e,t,r){if(!a.isUndefined(e.name)){var n=void 0;if(e instanceof c.Option||e instanceof c.Repetition||e instanceof c.RepetitionMandatory||e instanceof c.Alternation)n=new t({definition:e.definition,idx:e.idx});else{if(!(e instanceof c.RepetitionMandatoryWithSeparator||e instanceof c.RepetitionWithSeparator))throw Error("non exhaustive match");n=new t({definition:e.definition,idx:e.idx,separator:e.separator})}var i=[n],o=s.getKeyForAutomaticLookahead(this.ruleIdx,r,e.idx);this.result.push({def:i,key:o,name:e.name,orgProd:e})}},t.prototype.visitOption=function(e){this.collectNamedDSLMethod(e,c.Option,s.OPTION_IDX)},t.prototype.visitRepetition=function(e){this.collectNamedDSLMethod(e,c.Repetition,s.MANY_IDX)},t.prototype.visitRepetitionMandatory=function(e){this.collectNamedDSLMethod(e,c.RepetitionMandatory,s.AT_LEAST_ONE_IDX)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.collectNamedDSLMethod(e,c.RepetitionMandatoryWithSeparator,s.AT_LEAST_ONE_SEP_IDX)},t.prototype.visitRepetitionWithSeparator=function(e){this.collectNamedDSLMethod(e,c.RepetitionWithSeparator,s.MANY_SEP_IDX)},t.prototype.visitAlternation=function(e){var t=this;this.collectNamedDSLMethod(e,c.Alternation,s.OR_IDX);var r=e.definition.length>1;a.forEach(e.definition,(function(n,i){if(!a.isUndefined(n.name)){var o=n.definition;o=r?[new c.Option({definition:n.definition})]:n.definition;var u=s.getKeyForAltIndex(t.ruleIdx,s.OR_IDX,e.idx,i);t.result.push({def:o,key:u,name:n.name,orgProd:n})}}))},t}(u.GAstVisitor);t.NamedDSLMethodsCollectorVisitor=l,t.analyzeCst=function(e,t){var r={dictDef:new o.HashTable,allRuleNames:[]};return a.forEach(e,(function(e){var n=t.get(e.name);r.allRuleNames.push(e.name);var i=new l(n);e.accept(i),a.forEach(i.result,(function(t){t.def,t.key;var n=t.name;r.allRuleNames.push(e.name+n)}))})),r}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION="4.6.0"},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=r(15),a=r(2),o=r(6),s=r(17),c=r(10),u=r(39),l=r(5),p=r(1),h=r(24),f=r(40),d=r(20),v={};v.VERSION=s.VERSION,v.Parser=n.Parser,v.CstParser=n.CstParser,v.EmbeddedActionsParser=n.EmbeddedActionsParser,v.ParserDefinitionErrorType=n.ParserDefinitionErrorType,v.Lexer=i.Lexer,v.LexerDefinitionErrorType=i.LexerDefinitionErrorType,v.EOF=a.EOF,v.tokenName=a.tokenName,v.tokenLabel=a.tokenLabel,v.tokenMatcher=a.tokenMatcher,v.createToken=a.createToken,v.createTokenInstance=a.createTokenInstance,v.EMPTY_ALT=n.EMPTY_ALT,v.defaultParserErrorProvider=c.defaultParserErrorProvider,v.isRecognitionException=o.isRecognitionException,v.EarlyExitException=o.EarlyExitException,v.MismatchedTokenException=o.MismatchedTokenException,v.NotAllInputParsedException=o.NotAllInputParsedException,v.NoViableAltException=o.NoViableAltException,v.defaultLexerErrorProvider=d.defaultLexerErrorProvider,v.Flat=p.Flat,v.Repetition=p.Repetition,v.RepetitionWithSeparator=p.RepetitionWithSeparator,v.RepetitionMandatory=p.RepetitionMandatory,v.RepetitionMandatoryWithSeparator=p.RepetitionMandatoryWithSeparator,v.Option=p.Option,v.Alternation=p.Alternation,v.NonTerminal=p.NonTerminal,v.Terminal=p.Terminal,v.Rule=p.Rule,v.GAstVisitor=l.GAstVisitor,v.serializeGrammar=p.serializeGrammar,v.serializeProduction=p.serializeProduction,v.resolveGrammar=h.resolveGrammar,v.defaultGrammarResolverErrorProvider=c.defaultGrammarResolverErrorProvider,v.validateGrammar=h.validateGrammar,v.defaultGrammarValidatorErrorProvider=c.defaultGrammarValidatorErrorProvider,v.assignOccurrenceIndices=h.assignOccurrenceIndices,v.clearCache=function(){console.warn("The clearCache function was 'soft' removed from the Chevrotain API.\n\t It performs no action other than printing this message.\n\t Please avoid using it as it will be completely removed in the future")},v.createSyntaxDiagramsCode=u.createSyntaxDiagramsCode,v.generateParserFactory=f.generateParserFactory,v.generateParserModule=f.generateParserModule,e.exports=v},function(e,t,r){var n,i;void 0===(i="function"==typeof(n=function(){function e(){}e.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},e.prototype.restoreState=function(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx},e.prototype.pattern=function(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");var t=this.disjunction();this.consumeChar("/");for(var r={type:"Flags",global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case"g":s(r,"global");break;case"i":s(r,"ignoreCase");break;case"m":s(r,"multiLine");break;case"u":s(r,"unicode");break;case"y":s(r,"sticky")}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:t}},e.prototype.disjunction=function(){var e=[];for(e.push(this.alternative());"|"===this.peekChar();)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e}},e.prototype.alternative=function(){for(var e=[];this.isTerm();)e.push(this.term());return{type:"Alternative",value:e}},e.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},e.prototype.assertion=function(){switch(this.popChar()){case"^":return{type:"StartAnchor"};case"$":return{type:"EndAnchor"};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary"};case"B":return{type:"NonWordBoundary"}}throw Error("Invalid Assertion Escape");case"(":var e;switch(this.consumeChar("?"),this.popChar()){case"=":e="Lookahead";break;case"!":e="NegativeLookahead"}c(e);var t=this.disjunction();return this.consumeChar(")"),{type:e,value:t}}!function(){throw Error("Internal Error - Should never get here!")}()},e.prototype.quantifier=function(e){var t;switch(this.popChar()){case"*":t={atLeast:0,atMost:1/0};break;case"+":t={atLeast:1,atMost:1/0};break;case"?":t={atLeast:0,atMost:1};break;case"{":var r=this.integerIncludingZero();switch(this.popChar()){case"}":t={atLeast:r,atMost:r};break;case",":t=this.isDigit()?{atLeast:r,atMost:this.integerIncludingZero()}:{atLeast:r,atMost:1/0},this.consumeChar("}")}if(!0===e&&void 0===t)return;c(t)}if(!0!==e||void 0!==t)return c(t),"?"===this.peekChar(0)?(this.consumeChar("?"),t.greedy=!1):t.greedy=!0,t.type="Quantifier",t},e.prototype.atom=function(){var e;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group()}return void 0===e&&this.isPatternCharacter()&&(e=this.patternCharacter()),c(e),this.isQuantifier()&&(e.quantifier=this.quantifier()),e},e.prototype.dotAll=function(){return this.consumeChar("."),{type:"Set",complement:!0,value:[a("\n"),a("\r"),a("\u2028"),a("\u2029")]}},e.prototype.atomEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.decimalEscapeAtom=function(){return{type:"GroupBackReference",value:this.positiveInteger()}},e.prototype.characterClassEscape=function(){var e,t=!1;switch(this.popChar()){case"d":e=u;break;case"D":e=u,t=!0;break;case"s":e=p;break;case"S":e=p,t=!0;break;case"w":e=l;break;case"W":e=l,t=!0}return c(e),{type:"Set",value:e,complement:t}},e.prototype.controlEscapeAtom=function(){var e;switch(this.popChar()){case"f":e=a("\f");break;case"n":e=a("\n");break;case"r":e=a("\r");break;case"t":e=a("\t");break;case"v":e=a("\v")}return c(e),{type:"Character",value:e}},e.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var e=this.popChar();if(!1===/[a-zA-Z]/.test(e))throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}},e.prototype.nulCharacterAtom=function(){return this.consumeChar("0"),{type:"Character",value:a("\0")}},e.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar("x"),this.parseHexDigits(2)},e.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar("u"),this.parseHexDigits(4)},e.prototype.identityEscapeAtom=function(){return{type:"Character",value:a(this.popChar())}},e.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case"\n":case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:return{type:"Character",value:a(this.popChar())}}},e.prototype.characterClass=function(){var e=[],t=!1;for(this.consumeChar("["),"^"===this.peekChar(0)&&(this.consumeChar("^"),t=!0);this.isClassAtom();){var r=this.classAtom();if("Character"===r.type&&this.isRangeDash()){this.consumeChar("-");var n=this.classAtom();if("Character"===n.type){if(n.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:n.value})}else o(r.value,e),e.push(a("-")),o(n.value,e)}else o(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:t,value:e}},e.prototype.classAtom=function(){switch(this.peekChar()){case"]":case"\n":case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},e.prototype.classEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:a("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.group=function(){var e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++}var t=this.disjunction();this.consumeChar(")");var r={type:"Group",capturing:e,value:t};return e&&(r.idx=this.groupIdx),r},e.prototype.positiveInteger=function(){var e=this.popChar();if(!1===i.test(e))throw Error("Expecting a positive integer");for(;n.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.integerIncludingZero=function(){var e=this.popChar();if(!1===n.test(e))throw Error("Expecting an integer");for(;n.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.patternCharacter=function(){var e=this.popChar();switch(e){case"\n":case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:a(e)}}},e.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}},e.prototype.isRangeDash=function(){return"-"===this.peekChar()&&this.isClassAtom(1)},e.prototype.isDigit=function(){return n.test(this.peekChar(0))},e.prototype.isClassAtom=function(e){switch(void 0===e&&(e=0),this.peekChar(e)){case"]":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},e.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}},e.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return"?"===this.peekChar(1)&&("="===this.peekChar(2)||"!"===this.peekChar(2));default:return!1}},e.prototype.isQuantifier=function(){var e=this.saveState();try{return void 0!==this.quantifier(!0)}catch(e){return!1}finally{this.restoreState(e)}},e.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.parseHexDigits=function(e){for(var t="",n=0;n<e;n++){var i=this.popChar();if(!1===r.test(i))throw Error("Expecting a HexDecimal digits");t+=i}return{type:"Character",value:parseInt(t,16)}},e.prototype.peekChar=function(e){return void 0===e&&(e=0),this.input[this.idx+e]},e.prototype.popChar=function(){var e=this.peekChar(0);return this.consumeChar(),e},e.prototype.consumeChar=function(e){if(void 0!==e&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++};var t,r=/[0-9a-fA-F]/,n=/[0-9]/,i=/[1-9]/;function a(e){return e.charCodeAt(0)}function o(e,t){void 0!==e.length?e.forEach((function(e){t.push(e)})):t.push(e)}function s(e,t){if(!0===e[t])throw"duplicate flag "+t;e[t]=!0}function c(e){if(void 0===e)throw Error("Internal Error - Should never get here!")}var u=[];for(t=a("0");t<=a("9");t++)u.push(t);var l=[a("_")].concat(u);for(t=a("a");t<=a("z");t++)l.push(t);for(t=a("A");t<=a("Z");t++)l.push(t);var p=[a(" "),a("\f"),a("\n"),a("\r"),a("\t"),a("\v"),a("\t"),a("\xa0"),a("\u1680"),a("\u2000"),a("\u2001"),a("\u2002"),a("\u2003"),a("\u2004"),a("\u2005"),a("\u2006"),a("\u2007"),a("\u2008"),a("\u2009"),a("\u200a"),a("\u2028"),a("\u2029"),a("\u202f"),a("\u205f"),a("\u3000"),a("\ufeff")];function h(){}return h.prototype.visitChildren=function(e){for(var t in e){var r=e[t];e.hasOwnProperty(t)&&(void 0!==r.type?this.visit(r):Array.isArray(r)&&r.forEach((function(e){this.visit(e)}),this))}},h.prototype.visit=function(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e)}this.visitChildren(e)},h.prototype.visitPattern=function(e){},h.prototype.visitFlags=function(e){},h.prototype.visitDisjunction=function(e){},h.prototype.visitAlternative=function(e){},h.prototype.visitStartAnchor=function(e){},h.prototype.visitEndAnchor=function(e){},h.prototype.visitWordBoundary=function(e){},h.prototype.visitNonWordBoundary=function(e){},h.prototype.visitLookahead=function(e){},h.prototype.visitNegativeLookahead=function(e){},h.prototype.visitCharacter=function(e){},h.prototype.visitSet=function(e){},h.prototype.visitGroup=function(e){},h.prototype.visitGroupBackReference=function(e){},h.prototype.visitQuantifier=function(e){},{RegExpParser:e,BaseRegExpVisitor:h,VERSION:"0.4.0"}})?n.apply(t,[]):n)||(e.exports=i)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultLexerErrorProvider={buildUnableToPopLexerModeMessage:function(e){return"Unable to pop Lexer Mode after encountering Token ->"+e.image+"<- The Mode Stack is empty"},buildUnexpectedCharactersMessage:function(e,t,r,n,i){return"unexpected character: ->"+e.charAt(t)+"<- at offset: "+t+", skipped "+r+" characters."}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(1),a=r(8);function o(e){if(e instanceof i.NonTerminal)return o(e.referencedRule);if(e instanceof i.Terminal)return u(e);if(a.isSequenceProd(e))return s(e);if(a.isBranchingProd(e))return c(e);throw Error("non exhaustive match")}function s(e){for(var t,r=[],i=e.definition,s=0,c=i.length>s,u=!0;c&&u;)t=i[s],u=a.isOptionalProd(t),r=r.concat(o(t)),s+=1,c=i.length>s;return n.uniq(r)}function c(e){var t=n.map(e.definition,(function(e){return o(e)}));return n.uniq(n.flatten(t))}function u(e){return[e.terminalType]}t.first=o,t.firstForSequence=s,t.firstForBranching=c,t.firstForTerminal=u},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.IN="_~IN~_"},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(29),a=r(0),o=r(1);!function(e){e[e.OPTION=0]="OPTION",e[e.OR=1]="OR",e[e.MANY=2]="MANY",e[e.MANY_SEP=3]="MANY_SEP",e[e.AT_LEAST_ONE=4]="AT_LEAST_ONE",e[e.AT_LEAST_ONE_SEP=5]="AT_LEAST_ONE_SEP",e[e.REF=6]="REF",e[e.TERMINAL=7]="TERMINAL",e[e.FLAT=8]="FLAT"}(n=t.ProdType||(t.ProdType={}));var s=/(?:\s*{\s*NAME\s*:\s*["'`]([\w$]*)["'`])?/,c=new RegExp(s.source.replace("{","").replace(")?","\\s*,)?")),u=/\.\s*CONSUME(\d+)?\s*\(\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,l=new RegExp(u.source,"g"),p=/\.\s*SUBRULE(\d+)?\s*\(\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,h=new RegExp(p.source,"g"),f=/\.\s*OPTION(\d+)?\s*\(/,d=new RegExp(f.source+s.source),v=new RegExp(f.source,"g"),m=/\.\s*MANY(\d+)?\s*\(/,g=new RegExp(m.source+s.source),y=new RegExp(m.source,"g"),E=/\s*SEP\s*:\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,T=new RegExp(/\.\s*MANY_SEP(\d+)?\s*\(\s*{/.source+c.source+E.source),x=new RegExp(T.source,"g"),A=new RegExp(/\.\s*AT_LEAST_ONE_SEP(\d+)?\s*\(\s*{/.source+c.source+E.source),b=new RegExp(A.source,"g"),w=/\.\s*AT_LEAST_ONE(\d+)?\s*\(/,R=new RegExp(w.source+s.source),N=new RegExp(w.source,"g"),_=/\.\s*OR(\d+)?\s*\(/,S=new RegExp(_.source+s.source),k=new RegExp(_.source,"g"),I=new RegExp(c.source+/\s*(ALT)\s*:/.source),L=new RegExp(I.source,"g");function O(e,r,i){switch(e.type){case n.AT_LEAST_ONE:return function(e,t,r){return C(R,new o.RepetitionMandatory({definition:[]}),e,t,r)}(e,r,i);case n.AT_LEAST_ONE_SEP:return function(e,t,r){return M(e,t,o.RepetitionMandatoryWithSeparator,A,r)}(e,r,i);case n.MANY_SEP:return function(e,t,r){return M(e,t,o.RepetitionWithSeparator,T,r)}(e,r,i);case n.MANY:return function(e,t,r){return C(g,new o.Repetition({definition:[]}),e,t,r)}(e,r,i);case n.OPTION:return function(e,t,r){return C(d,new o.Option({definition:[]}),e,t,r)}(e,r,i);case n.OR:return function(e,t,r){return C(S,new o.Alternation({definition:[]}),e,t,r)}(e,r,i);case n.FLAT:return function(e,t,r){var n=new o.Flat({definition:[]}),i=I.exec(e.text)[1];return a.isUndefined(i)||(n.name=i),P(n,e.range,t,r)}(e,r,i);case n.REF:return function(e){var t=p.exec(e.text),r=void 0===t[1]?0:parseInt(t[1],10),n=t[2];return new o.NonTerminal({nonTerminalName:n,idx:r})}(e);case n.TERMINAL:return function(e,r){var n=u.exec(e.text),i=void 0===n[1]?0:parseInt(n[1],10),a=n[2],s=t.terminalNameToConstructor[a];if(!s)throw Error("Terminal Token name: <"+a+"> not found in rule: <"+r+">  \n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#TERMINAL_NAME_NOT_FOUND\n\tFor Further details.");return new o.Terminal({terminalType:s,idx:i})}(e,i);default:throw Error("non exhaustive match")}}function C(e,t,r,n,i){var o=e.exec(r.text),s=void 0===o[1];t.idx=s?0:parseInt(o[1],10);var c=o[2];return a.isUndefined(c)||(t.name=c),P(t,r.range,n,i)}function M(e,r,n,i,o){var s=i.exec(e.text),c=void 0===s[1]?0:parseInt(s[1],10),u=s[3],l=t.terminalNameToConstructor[u];if(!l)throw Error("Separator Terminal Token name: "+u+" not found");var p=new n({definition:[],separator:l,idx:c}),h=s[2];return a.isUndefined(h)||(p.name=h),P(p,e.range,r,o)}function P(e,t,r,n){var i=F(t,r),o=a.sortBy(i,(function(e){return e.range.start})),s=[];return a.forEach(o,(function(e){s.push(O(e,r,n))})),e.definition=s,e}function F(e,t){return a.filter(t,(function(r){var n=e.strictlyContainsRange(r.range),i=a.every(t,(function(t){var n=t.range.strictlyContainsRange(r.range),i=t.range.isStrictlyContainedInRange(e);return!(n&&i)}));return n&&i}))}t.terminalNameToConstructor={},t.buildTopProduction=function(e,r,n){t.terminalNameToConstructor=n;var a=z(G(B("  "+e)));return function(e,t,r,n){return P(new o.Rule({name:e,definition:[],orgText:n}),t,r,e)}(r,new i.Range(0,e.length+2),a,e)},t.buildProdGast=O,t.getDirectlyContainedRanges=F;var D=/\/\/.*/g,U=/\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\//g,j=/(NAME\s*:\s*)?"([^\\"]|\\([bfnrtv"\\\/]|u[0-9a-fA-F]{4}))*"/g,V=/(NAME\s*:\s*)?'([^\\']|\\([bfnrtv'\\\/]|u[0-9a-fA-F]{4}))*'/g;function B(e){return e.replace(D,"").replace(U,"")}function H(e,t){return void 0!==t?e:""}function G(e){return e.replace(j,H).replace(V,H)}function z(e){var t=W(e),r=K(e),n=X(e),i=q(e),a=Y(e),o=Z(e),s=$(e),c=J(e);return[].concat(t,r,n,i,a,o,s,c)}function W(e){return re(e,n.TERMINAL,l)}function K(e){return re(e,n.REF,h)}function X(e){return ne(e,n.AT_LEAST_ONE,N)}function q(e){return ne(e,n.AT_LEAST_ONE_SEP,b)}function Y(e){return ne(e,n.MANY,y)}function Z(e){return ne(e,n.MANY_SEP,x)}function $(e){return ne(e,n.OPTION,v)}function J(e){var t=ne(e,n.OR,k),r=te(t);return t.concat(r)}t.removeComments=B,t.removeStringLiterals=G,t.createRanges=z,t.createTerminalRanges=W,t.createRefsRanges=K,t.createAtLeastOneRanges=X,t.createAtLeastOneSepRanges=q,t.createManyRanges=Y,t.createManySepRanges=Z,t.createOptionRanges=$,t.createOrRanges=J;var Q=a.partial(ae,"{","}"),ee=a.partial(ae,"(",")");function te(e){var t=[];return a.forEach(e,(function(e){var r=ie(e.text,n.FLAT,L,Q),i=e.range.start;a.forEach(r,(function(e){e.range.start+=i,e.range.end+=i})),t=t.concat(r)})),a.uniq(t,(function(e){return e.type+"~"+e.range.start+"~"+e.range.end+"~"+e.text}))}function re(e,t,r){for(var n,a=[];n=r.exec(e);){var o=n.index,s=r.lastIndex,c=new i.Range(o,s),u=n[0];a.push({range:c,text:u,type:t})}return a}function ne(e,t,r){return ie(e,t,r,ee)}function ie(e,t,r,n){for(var a,o=[];a=r.exec(e);){var s=a.index,c=n(s+a[0].length,e),u=new i.Range(s,c),l=e.substr(s,c-s+1);o.push({range:u,text:l,type:t})}return o}function ae(e,t,r,n){for(var i=[1],o=-1;!a.isEmpty(i)&&o+r<n.length;){o++;var s=n.charAt(r+o);s===e?i.push(1):s===t&&i.pop()}if(a.isEmpty(i))return o+r;throw new Error("INVALID INPUT TEXT, UNTERMINATED PARENTHESIS")}function oe(e,t){return a.map(e,(function(e){return se(e,t)}))}function se(e,t){switch(e.type){case"NonTerminal":return new o.NonTerminal({nonTerminalName:e.name,idx:e.idx});case"Flat":return new o.Flat({name:e.name,definition:oe(e.definition,t)});case"Option":return new o.Option({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"RepetitionMandatory":return new o.RepetitionMandatory({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"RepetitionMandatoryWithSeparator":return new o.RepetitionMandatoryWithSeparator({name:e.name,idx:e.idx,separator:t[e.separator.name],definition:oe(e.definition,t)});case"RepetitionWithSeparator":return new o.RepetitionWithSeparator({name:e.name,idx:e.idx,separator:t[e.separator.name],definition:oe(e.definition,t)});case"Repetition":return new o.Repetition({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"Alternation":return new o.Alternation({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"Terminal":return new o.Terminal({terminalType:t[e.name],idx:e.idx});case"Rule":return new o.Rule({name:e.name,orgText:e.orgText,definition:oe(e.definition,t)})}}t.createOrPartRanges=te,t.findClosingOffset=ae,t.deserializeGrammar=oe,t.deserializeProduction=se},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(4),a=r(30),o=r(11),s=r(10),c=r(8);t.resolveGrammar=function(e){e=n.defaults(e,{errMsgProvider:s.defaultGrammarResolverErrorProvider});var t=new i.HashTable;return n.forEach(e.rules,(function(e){t.put(e.name,e)})),a.resolveGrammar(t,e.errMsgProvider)},t.validateGrammar=function(e){return e=n.defaults(e,{errMsgProvider:s.defaultGrammarValidatorErrorProvider,ignoredIssues:{}}),o.validateGrammar(e.rules,e.maxLookahead,e.tokenTypes,e.ignoredIssues,e.errMsgProvider,e.grammarName)},t.assignOccurrenceIndices=function(e){n.forEach(e.rules,(function(e){var t=new c.DslMethodsCollectorVisitor;e.accept(t),n.forEach(t.dslMethods,(function(e){n.forEach(e,(function(e,t){e.idx=t+1}))}))}))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(0),a=r(6),o=r(22),s=r(4),c=r(3);function u(e){this.name=t.IN_RULE_RECOVERY_EXCEPTION,this.message=e}t.EOF_FOLLOW_KEY={},t.IN_RULE_RECOVERY_EXCEPTION="InRuleRecoveryException",t.InRuleRecoveryException=u,u.prototype=Error.prototype;var l=function(){function e(){}return e.prototype.initRecoverable=function(e){this.firstAfterRepMap=new s.HashTable,this.resyncFollows=new s.HashTable,this.recoveryEnabled=i.has(e,"recoveryEnabled")?e.recoveryEnabled:c.DEFAULT_PARSER_CONFIG.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=p)},e.prototype.getTokenToInsert=function(e){var t=n.createTokenInstance(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return t.isInsertedInRecovery=!0,t},e.prototype.canTokenTypeBeInsertedInRecovery=function(e){return!0},e.prototype.tryInRepetitionRecovery=function(e,t,r,n){for(var o=this,s=this.findReSyncTokenType(),c=this.exportLexerState(),u=[],l=!1,p=this.LA(1),h=this.LA(1),f=function(){var e=o.LA(0),t=o.errorMessageProvider.buildMismatchTokenMessage({expected:n,actual:p,previous:e,ruleName:o.getCurrRuleFullName()}),r=new a.MismatchedTokenException(t,p,o.LA(0));r.resyncedTokens=i.dropRight(u),o.SAVE_ERROR(r)};!l;){if(this.tokenMatcher(h,n))return void f();if(r.call(this))return f(),void e.apply(this,t);this.tokenMatcher(h,s)?l=!0:(h=this.SKIP_TOKEN(),this.addToResyncTokens(h,u))}this.importLexerState(c)},e.prototype.shouldInRepetitionRecoveryBeTried=function(e,t){return void 0!==e&&void 0!==t&&!this.tokenMatcher(this.LA(1),e)&&!this.isBackTracking()&&!this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t))},e.prototype.getFollowsForInRuleRecovery=function(e,t){var r=this.getCurrentGrammarPath(e,t);return this.getNextPossibleTokenTypes(r)},e.prototype.tryInRuleRecovery=function(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){var r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new u("sad sad panda")},e.prototype.canPerformInRuleRecovery=function(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)},e.prototype.canRecoverWithSingleTokenInsertion=function(e,t){var r=this;if(!this.canTokenTypeBeInsertedInRecovery(e))return!1;if(i.isEmpty(t))return!1;var n=this.LA(1);return void 0!==i.find(t,(function(e){return r.tokenMatcher(n,e)}))},e.prototype.canRecoverWithSingleTokenDeletion=function(e){return this.tokenMatcher(this.LA(2),e)},e.prototype.isInCurrentRuleReSyncSet=function(e){var t=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(t);return i.contains(r,e)},e.prototype.findReSyncTokenType=function(){for(var e=this.flattenFollowSet(),t=this.LA(1),r=2;;){var n=t.tokenType;if(i.contains(e,n))return n;t=this.LA(r),r++}},e.prototype.getCurrFollowKey=function(){if(1===this.RULE_STACK.length)return t.EOF_FOLLOW_KEY;var e=this.getLastExplicitRuleShortName(),r=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:r,inRule:this.shortRuleNameToFullName(n)}},e.prototype.buildFullFollowKeyStack=function(){var e=this,r=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return i.isEmpty(this.LAST_EXPLICIT_RULE_STACK)||(r=i.map(this.LAST_EXPLICIT_RULE_STACK,(function(t){return e.RULE_STACK[t]})),n=i.map(this.LAST_EXPLICIT_RULE_STACK,(function(t){return e.RULE_OCCURRENCE_STACK[t]}))),i.map(r,(function(i,a){return 0===a?t.EOF_FOLLOW_KEY:{ruleName:e.shortRuleNameToFullName(i),idxInCallingRule:n[a],inRule:e.shortRuleNameToFullName(r[a-1])}}))},e.prototype.flattenFollowSet=function(){var e=this,t=i.map(this.buildFullFollowKeyStack(),(function(t){return e.getFollowSetFromFollowKey(t)}));return i.flatten(t)},e.prototype.getFollowSetFromFollowKey=function(e){if(e===t.EOF_FOLLOW_KEY)return[n.EOF];var r=e.ruleName+e.idxInCallingRule+o.IN+e.inRule;return this.resyncFollows.get(r)},e.prototype.addToResyncTokens=function(e,t){return this.tokenMatcher(e,n.EOF)||t.push(e),t},e.prototype.reSyncTo=function(e){for(var t=[],r=this.LA(1);!1===this.tokenMatcher(r,e);)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,t);return i.dropRight(t)},e.prototype.attemptInRepetitionRecovery=function(e,t,r,n,i,a){},e.prototype.getCurrentGrammarPath=function(e,t){return{ruleStack:this.getHumanReadableRuleStack(),occurrenceStack:i.cloneArr(this.RULE_OCCURRENCE_STACK),lastTok:e,lastTokOccurrence:t}},e.prototype.getHumanReadableRuleStack=function(){var e=this;return i.isEmpty(this.LAST_EXPLICIT_RULE_STACK)?i.map(this.RULE_STACK,(function(t){return e.shortRuleNameToFullName(t)})):i.map(this.LAST_EXPLICIT_RULE_STACK,(function(t){return e.shortRuleNameToFullName(e.RULE_STACK[t])}))},e}();function p(e,t,r,i,a,o){var s=this.getKeyForAutomaticLookahead(i,a),c=this.firstAfterRepMap.get(s);if(void 0===c){var u=this.getCurrRuleFullName();c=new o(this.getGAstProductions().get(u),a).startWalking(),this.firstAfterRepMap.put(s,c)}var l=c.token,p=c.occurrence,h=c.isEndOfRule;1===this.RULE_STACK.length&&h&&void 0===l&&(l=n.EOF,p=1),this.shouldInRepetitionRecoveryBeTried(l,p)&&this.tryInRepetitionRecovery(e,t,r,l)}t.Recoverable=l,t.attemptInRepetitionRecovery=p},function(e,t,r){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(14),o=r(4),s=r(21),c=r(0),u=r(22),l=r(2),p=r(1),h=function(e){function t(t){var r=e.call(this)||this;return r.topProd=t,r.follows=new o.HashTable,r}return i(t,e),t.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},t.prototype.walkTerminal=function(e,t,r){},t.prototype.walkProdRef=function(e,t,r){var n=f(e.referencedRule,e.idx)+this.topProd.name,i=t.concat(r),a=new p.Flat({definition:i}),o=s.first(a);this.follows.put(n,o)},t}(a.RestWalker);function f(e,t){return e.name+t+u.IN}t.ResyncFollowsWalker=h,t.computeAllProdsFollows=function(e){var t=new o.HashTable;return c.forEach(e,(function(e){var r=new h(e).startWalking();t.putAll(r)})),t},t.buildBetweenProdsFollowPrefix=f,t.buildInProdFollowPrefix=function(e){return l.tokenName(e.terminalType)+e.idx+u.IN}},function(e,t,r){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(19),o=r(2),s=r(15),c=r(0),u=r(28),l=new a.RegExpParser,p="PATTERN";function h(e){var t=c.filter(e,(function(e){return!c.has(e,p)}));return{errors:c.map(t,(function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- missing static 'PATTERN' property",type:s.LexerDefinitionErrorType.MISSING_PATTERN,tokenTypes:[e]}})),valid:c.difference(e,t)}}function f(e){var t=c.filter(e,(function(e){var t=e[p];return!(c.isRegExp(t)||c.isFunction(t)||c.has(t,"exec")||c.isString(t))}));return{errors:c.map(t,(function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:s.LexerDefinitionErrorType.INVALID_PATTERN,tokenTypes:[e]}})),valid:c.difference(e,t)}}t.DEFAULT_MODE="defaultMode",t.MODES="modes",t.SUPPORT_STICKY="boolean"==typeof new RegExp("(?:)").sticky,t.disableSticky=function(){t.SUPPORT_STICKY=!1},t.enableSticky=function(){t.SUPPORT_STICKY=!0},t.analyzeTokenTypes=function(e,r){r=c.defaults(r,{useSticky:t.SUPPORT_STICKY,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r","\n"]});var n=c.reject(e,(function(e){return e[p]===s.Lexer.NA})),i=!1,a=c.map(n,(function(e){var t=e[p];if(c.isRegExp(t)){var n=t.source;return 1===n.length&&"^"!==n&&"$"!==n&&"."!==n?n:2!==n.length||"\\"!==n[0]||c.contains(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],n[1])?r.useSticky?R(t):w(t):n[1]}if(c.isFunction(t))return i=!0,{exec:t};if(c.has(t,"exec"))return i=!0,t;if("string"==typeof t){if(1===t.length)return t;var a=t.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),o=new RegExp(a);return r.useSticky?R(o):w(o)}throw Error("non exhaustive match")})),l=c.map(n,(function(e){return e.tokenTypeIdx})),h=c.map(n,(function(e){var t=e.GROUP;if(t!==s.Lexer.SKIPPED){if(c.isString(t))return t;if(c.isUndefined(t))return!1;throw Error("non exhaustive match")}})),f=c.map(n,(function(e){var t=e.LONGER_ALT;if(t)return c.indexOf(n,t)})),d=c.map(n,(function(e){return e.PUSH_MODE})),v=c.map(n,(function(e){return c.has(e,"POP_MODE")})),m=I(r.lineTerminatorCharacters),g=c.map(n,(function(e){return!1}));"onlyOffset"!==r.positionTracking&&(g=c.map(n,(function(e){return c.has(e,"LINE_BREAKS")?e.LINE_BREAKS:!1===S(e,m)?u.canMatchCharCode(m,e.PATTERN):void 0})));var y=c.map(n,N),E=c.map(a,_),T=c.reduce(n,(function(e,t){var r=t.GROUP;return c.isString(r)&&r!==s.Lexer.SKIPPED&&(e[r]=[]),e}),{}),x=c.map(a,(function(e,t){return{pattern:a[t],longerAlt:f[t],canLineTerminator:g[t],isCustom:y[t],short:E[t],group:h[t],push:d[t],pop:v[t],tokenTypeIdx:l[t],tokenType:n[t]}}));function A(e,t,r){void 0===e[t]&&(e[t]=[]),e[t].push(r)}var b=!0,k=[];return r.safeMode||(k=c.reduce(n,(function(e,t,n){if("string"==typeof t.PATTERN){var i=t.PATTERN.charCodeAt(0);A(e,i,x[n])}else if(c.isArray(t.START_CHARS_HINT))c.forEach(t.START_CHARS_HINT,(function(t){var r="string"==typeof t?t.charCodeAt(0):t;A(e,r,x[n])}));else if(c.isRegExp(t.PATTERN))if(t.PATTERN.unicode)b=!1,r.ensureOptimizations&&c.PRINT_ERROR(u.failedOptimizationPrefixMsg+"\tUnable to analyze < "+t.PATTERN.toString()+" > pattern.\n\tThe regexp unicode flag is not currently supported by the regexp-to-ast library.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE");else{var a=u.getStartCodes(t.PATTERN,r.ensureOptimizations);c.isEmpty(a)&&(b=!1),c.forEach(a,(function(t){A(e,t,x[n])}))}else r.ensureOptimizations&&c.PRINT_ERROR(u.failedOptimizationPrefixMsg+"\tTokenType: <"+o.tokenName(t)+"> is using a custom token pattern without providing <start_chars_hint> parameter.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE"),b=!1;return e}),[])),b&&k.length<65536&&(k=c.packArray(k)),{emptyGroups:T,patternIdxToConfig:x,charCodeToPatternIdxToConfig:k,hasCustom:i,canBeOptimized:b}},t.validatePatterns=function(e,t){var r=[],n=h(e);r=r.concat(n.errors);var i=f(n.valid),a=i.valid;return(r=(r=(r=(r=r.concat(i.errors)).concat(function(e){var t=[],r=c.filter(e,(function(e){return c.isRegExp(e[p])}));return(t=(t=(t=(t=t.concat(v(r))).concat(y(r))).concat(E(r))).concat(T(r))).concat(m(r))}(a))).concat(x(a))).concat(A(a,t))).concat(b(a))},t.findMissingPatterns=h,t.findInvalidPatterns=f;var d=/[^\\][\$]/;function v(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.found=!1,t}return i(t,e),t.prototype.visitEndAnchor=function(e){this.found=!0},t}(a.BaseRegExpVisitor),r=c.filter(e,(function(e){var r=e[p];try{var n=l.pattern(r.toString()),i=new t;return i.visit(n),i.found}catch(e){return d.test(r.source)}}));return c.map(r,(function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+o.tokenName(e)+"<- static 'PATTERN' cannot contain end of input anchor '$'\n\tSee sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:s.LexerDefinitionErrorType.EOI_ANCHOR_FOUND,tokenTypes:[e]}}))}function m(e){var t=c.filter(e,(function(e){return e[p].test("")}));return c.map(t,(function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PATTERN' must not match an empty string",type:s.LexerDefinitionErrorType.EMPTY_MATCH_PATTERN,tokenTypes:[e]}}))}t.findEndOfInputAnchor=v,t.findEmptyMatchRegExps=m;var g=/[^\\[][\^]|^\^/;function y(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.found=!1,t}return i(t,e),t.prototype.visitStartAnchor=function(e){this.found=!0},t}(a.BaseRegExpVisitor),r=c.filter(e,(function(e){var r=e[p];try{var n=l.pattern(r.toString()),i=new t;return i.visit(n),i.found}catch(e){return g.test(r.source)}}));return c.map(r,(function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+o.tokenName(e)+"<- static 'PATTERN' cannot contain start of input anchor '^'\n\tSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:s.LexerDefinitionErrorType.SOI_ANCHOR_FOUND,tokenTypes:[e]}}))}function E(e){var t=c.filter(e,(function(e){var t=e[p];return t instanceof RegExp&&(t.multiline||t.global)}));return c.map(t,(function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:s.LexerDefinitionErrorType.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[e]}}))}function T(e){var t=[],r=c.map(e,(function(r){return c.reduce(e,(function(e,n){return r.PATTERN.source!==n.PATTERN.source||c.contains(t,n)||n.PATTERN===s.Lexer.NA||(t.push(n),e.push(n)),e}),[])}));r=c.compact(r);var n=c.filter(r,(function(e){return e.length>1}));return c.map(n,(function(e){var t=c.map(e,(function(e){return o.tokenName(e)}));return{message:"The same RegExp pattern ->"+c.first(e).PATTERN+"<-has been used in all of the following Token Types: "+t.join(", ")+" <-",type:s.LexerDefinitionErrorType.DUPLICATE_PATTERNS_FOUND,tokenTypes:e}}))}function x(e){var t=c.filter(e,(function(e){if(!c.has(e,"GROUP"))return!1;var t=e.GROUP;return t!==s.Lexer.SKIPPED&&t!==s.Lexer.NA&&!c.isString(t)}));return c.map(t,(function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:s.LexerDefinitionErrorType.INVALID_GROUP_TYPE_FOUND,tokenTypes:[e]}}))}function A(e,t){var r=c.filter(e,(function(e){return void 0!==e.PUSH_MODE&&!c.contains(t,e.PUSH_MODE)}));return c.map(r,(function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->"+e.PUSH_MODE+"<-which does not exist",type:s.LexerDefinitionErrorType.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[e]}}))}function b(e){var t=[],r=c.reduce(e,(function(e,t,r){var n,i=t.PATTERN;return i===s.Lexer.NA||(c.isString(i)?e.push({str:i,idx:r,tokenType:t}):c.isRegExp(i)&&(n=i,void 0===c.find([".","\\","[","]","|","^","$","(",")","?","*","+","{"],(function(e){return-1!==n.source.indexOf(e)})))&&e.push({str:i.source,idx:r,tokenType:t})),e}),[]);return c.forEach(e,(function(e,n){c.forEach(r,(function(r){var i=r.str,a=r.idx,u=r.tokenType;if(n<a&&function(e,t){if(c.isRegExp(t)){var r=t.exec(e);return null!==r&&0===r.index}if(c.isFunction(t))return t(e,0,[],{});if(c.has(t,"exec"))return t.exec(e,0,[],{});if("string"==typeof t)return t===e;throw Error("non exhaustive match")}(i,e.PATTERN)){var l="Token: ->"+o.tokenName(u)+"<- can never be matched.\nBecause it appears AFTER the Token Type ->"+o.tokenName(e)+"<-in the lexer's definition.\nSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNREACHABLE";t.push({message:l,type:s.LexerDefinitionErrorType.UNREACHABLE_PATTERN,tokenTypes:[e,u]})}}))})),t}function w(e){var t=e.ignoreCase?"i":"";return new RegExp("^(?:"+e.source+")",t)}function R(e){var t=e.ignoreCase?"iy":"y";return new RegExp(""+e.source,t)}function N(e){var t=e.PATTERN;if(c.isRegExp(t))return!1;if(c.isFunction(t))return!0;if(c.has(t,"exec"))return!0;if(c.isString(t))return!1;throw Error("non exhaustive match")}function _(e){return!(!c.isString(e)||1!==e.length)&&e.charCodeAt(0)}function S(e,t){if(c.has(e,"LINE_BREAKS"))return!1;if(c.isRegExp(e.PATTERN)){try{u.canMatchCharCode(t,e.PATTERN)}catch(e){return{issue:s.LexerDefinitionErrorType.IDENTIFY_TERMINATOR,errMsg:e.message}}return!1}if(c.isString(e.PATTERN))return!1;if(N(e))return{issue:s.LexerDefinitionErrorType.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}function k(e,t){if(t.issue===s.LexerDefinitionErrorType.IDENTIFY_TERMINATOR)return"Warning: unable to identify line terminator usage in pattern.\n\tThe problem is in the <"+e.name+"> Token Type\n\t Root cause: "+t.errMsg+".\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(t.issue===s.LexerDefinitionErrorType.CUSTOM_LINE_BREAK)return"Warning: A Custom Token Pattern should specify the <line_breaks> option.\n\tThe problem is in the <"+e.name+"> Token Type\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}function I(e){return c.map(e,(function(e){return c.isString(e)&&e.length>0?e.charCodeAt(0):e}))}t.findStartOfInputAnchor=y,t.findUnsupportedFlags=E,t.findDuplicatePatterns=T,t.findInvalidGroupType=x,t.findModesThatDoNotExist=A,t.findUnreachablePatterns=b,t.addStartOfInput=w,t.addStickyFlag=R,t.performRuntimeChecks=function(e,r,n){var i=[];return c.has(e,t.DEFAULT_MODE)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+t.DEFAULT_MODE+"> property in its definition\n",type:s.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),c.has(e,t.MODES)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+t.MODES+"> property in its definition\n",type:s.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),c.has(e,t.MODES)&&c.has(e,t.DEFAULT_MODE)&&!c.has(e.modes,e.defaultMode)&&i.push({message:"A MultiMode Lexer cannot be initialized with a "+t.DEFAULT_MODE+": <"+e.defaultMode+">which does not exist\n",type:s.LexerDefinitionErrorType.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),c.has(e,t.MODES)&&c.forEach(e.modes,(function(e,t){c.forEach(e,(function(e,r){c.isUndefined(e)&&i.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:<"+t+"> at index: <"+r+">\n",type:s.LexerDefinitionErrorType.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED})}))})),i},t.performWarningRuntimeChecks=function(e,t,r){var n=[],i=!1,a=c.compact(c.flatten(c.mapValues(e.modes,(function(e){return e})))),o=c.reject(a,(function(e){return e[p]===s.Lexer.NA})),l=I(r);return t&&c.forEach(o,(function(e){var t=S(e,l);if(!1!==t){var r={message:k(e,t),type:t.issue,tokenType:e};n.push(r)}else c.has(e,"LINE_BREAKS")?!0===e.LINE_BREAKS&&(i=!0):u.canMatchCharCode(l,e.PATTERN)&&(i=!0)})),t&&!i&&n.push({message:"Warning: No LINE_BREAKS Found.\n\tThis Lexer has been defined to track line and column information,\n\tBut none of the Token Types can be identified as matching a line terminator.\n\tSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#LINE_BREAKS \n\tfor details.",type:s.LexerDefinitionErrorType.NO_LINE_BREAKS_FLAGS}),n},t.cloneEmptyGroups=function(e){var t={},r=c.keys(e);return c.forEach(r,(function(r){var n=e[r];if(!c.isArray(n))throw Error("non exhaustive match");t[r]=[]})),t},t.isCustomPattern=N,t.isShortPattern=_,t.LineTerminatorOptimizedTester={test:function(e){for(var t=e.length,r=this.lastIndex;r<t;r++){var n=e.charCodeAt(r);if(10===n)return this.lastIndex=r+1,!0;if(13===n)return 10===e.charCodeAt(r+1)?this.lastIndex=r+2:this.lastIndex=r+1,!0}return!1},lastIndex:0},t.buildLineBreakIssueMessage=k},function(e,t,r){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(19),o=r(0),s=new a.RegExpParser,c="Complement Sets are not supported for first char optimization";function u(e){switch(e.type){case"Disjunction":return o.flatten(o.map(e.value,u));case"Alternative":for(var t=[],r=e.value,n=0;n<r.length;n++){var i=r[n];if(!o.contains(["GroupBackReference","Lookahead","NegativeLookahead","StartAnchor","EndAnchor","WordBoundary","NonWordBoundary"],i.type)){var a=i;switch(a.type){case"Character":t.push(a.value);break;case"Set":if(!0===a.complement)throw Error(c);o.forEach(a.value,(function(e){if("number"==typeof e)t.push(e);else for(var r=e,n=r.from;n<=r.to;n++)t.push(n)}));break;case"Group":var s=u(a.value);o.forEach(s,(function(e){return t.push(e)}));break;default:throw Error("Non Exhaustive Match")}var l=void 0!==a.quantifier&&0===a.quantifier.atLeast;if("Group"===a.type&&!1===h(a)||"Group"!==a.type&&!1===l)break}}return t;default:throw Error("non exhaustive match!")}}function l(e){var t=[];return o.forEach(e,(function(e){t.push(e);var r=String.fromCharCode(e);r.toUpperCase()!==r?t.push(r.toUpperCase().charCodeAt(0)):r.toLowerCase()!==r&&t.push(r.toLowerCase().charCodeAt(0))})),t}function p(e,t){return o.find(e.value,(function(e){if("number"==typeof e)return o.contains(t,e);var r=e;return void 0!==o.find(t,(function(e){return r.from<=e&&e<=r.to}))}))}function h(e){return!(!e.quantifier||0!==e.quantifier.atLeast)||!!e.value&&(o.isArray(e.value)?o.every(e.value,h):h(e.value))}t.failedOptimizationPrefixMsg='Unable to use "first char" lexer optimizations:\n',t.getStartCodes=function(e,r){void 0===r&&(r=!1);try{var n=s.pattern(e.toString()),i=u(n.value);return n.flags.ignoreCase&&(i=l(i)),i}catch(n){if(n.message===c)r&&o.PRINT_WARNING(t.failedOptimizationPrefixMsg+"\tUnable to optimize: < "+e.toString()+" >\n\tComplement Sets cannot be automatically optimized.\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.");else{var p="";r&&(p="\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details."),o.PRINT_ERROR(t.failedOptimizationPrefixMsg+"\n\tFailed parsing: < "+e.toString()+" >\n\tUsing the regexp-to-ast library version: "+a.VERSION+"\n\tPlease open an issue at: https://github.com/bd82/regexp-to-ast/issues"+p)}}return[]},t.firstChar=u,t.applyIgnoreCase=l;var f=function(e){function t(t){var r=e.call(this)||this;return r.targetCharCodes=t,r.found=!1,r}return i(t,e),t.prototype.visitChildren=function(t){switch(t.type){case"Lookahead":return void this.visitLookahead(t);case"NegativeLookahead":return void this.visitNegativeLookahead(t)}e.prototype.visitChildren.call(this,t)},t.prototype.visitCharacter=function(e){o.contains(this.targetCharCodes,e.value)&&(this.found=!0)},t.prototype.visitSet=function(e){e.complement?void 0===p(e,this.targetCharCodes)&&(this.found=!0):void 0!==p(e,this.targetCharCodes)&&(this.found=!0)},t}(a.BaseRegExpVisitor);t.canMatchCharCode=function(e,t){if(t instanceof RegExp){var r=s.pattern(t.toString()),n=new f(e);return n.visit(r),n.found}return void 0!==o.find(t,(function(t){return o.contains(e,t.charCodeAt(0))}))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){if(this.start=e,this.end=t,!i(e,t))throw new Error("INVALID RANGE")}return e.prototype.contains=function(e){return this.start<=e&&this.end>=e},e.prototype.containsRange=function(e){return this.start<=e.start&&this.end>=e.end},e.prototype.isContainedInRange=function(e){return e.containsRange(this)},e.prototype.strictlyContainsRange=function(e){return this.start<e.start&&this.end>e.end},e.prototype.isStrictlyContainedInRange=function(e){return e.strictlyContainsRange(this)},e}();function i(e,t){return!(e<0||t<e)}t.Range=n,t.isValidRange=i},function(e,t,r){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(3),o=r(0),s=r(5);t.resolveGrammar=function(e,t){var r=new c(e,t);return r.resolveRefs(),r.errors};var c=function(e){function t(t,r){var n=e.call(this)||this;return n.nameToTopRule=t,n.errMsgProvider=r,n.errors=[],n}return i(t,e),t.prototype.resolveRefs=function(){var e=this;o.forEach(this.nameToTopRule.values(),(function(t){e.currTopLevel=t,t.accept(e)}))},t.prototype.visitNonTerminal=function(e){var t=this.nameToTopRule.get(e.nonTerminalName);if(t)e.referencedRule=t;else{var r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:a.ParserDefinitionErrorType.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}},t}(s.GAstVisitor);t.GastRefResolverVisitor=c},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(12),i=r(0),a=r(3),o=r(9),s=function(){function e(){}return e.prototype.initLooksAhead=function(e){this.dynamicTokensEnabled=i.has(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:a.DEFAULT_PARSER_CONFIG.dynamicTokensEnabled,this.maxLookahead=i.has(e,"maxLookahead")?e.maxLookahead:a.DEFAULT_PARSER_CONFIG.maxLookahead,this.lookAheadFuncsCache=i.isES2015MapSupported()?new Map:[],i.isES2015MapSupported()?(this.getLaFuncFromCache=this.getLaFuncFromMap,this.setLaFuncCache=this.setLaFuncCacheUsingMap):(this.getLaFuncFromCache=this.getLaFuncFromObj,this.setLaFuncCache=this.setLaFuncUsingObj)},e.prototype.lookAheadBuilderForOptional=function(e,t,r){return n.buildSingleAlternativeLookaheadFunction(e,t,r)},e.prototype.lookAheadBuilderForAlternatives=function(e,t,r,i){return n.buildAlternativesLookAheadFunc(e,t,r,i)},e.prototype.getKeyForAutomaticLookahead=function(e,t){var r=this.getLastExplicitRuleShortName();return o.getKeyForAutomaticLookahead(r,e,t)},e.prototype.getLookaheadFuncForOr=function(e,t){var r=this.getKeyForAutomaticLookahead(o.OR_IDX,e),a=this.getLaFuncFromCache(r);if(void 0===a){var s=this.getCurrRuleFullName(),c=this.getGAstProductions().get(s),u=i.some(t,(function(e){return i.isFunction(e.GATE)}));return a=n.buildLookaheadFuncForOr(e,c,this.maxLookahead,u,this.dynamicTokensEnabled,this.lookAheadBuilderForAlternatives),this.setLaFuncCache(r,a),a}return a},e.prototype.getLookaheadFuncForOption=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.OPTION)},e.prototype.getLookaheadFuncForMany=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION)},e.prototype.getLookaheadFuncForManySep=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION_WITH_SEPARATOR)},e.prototype.getLookaheadFuncForAtLeastOne=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION_MANDATORY)},e.prototype.getLookaheadFuncForAtLeastOneSep=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR)},e.prototype.getLookaheadFuncFor=function(e,t,r,i){var a=this.getLaFuncFromCache(e);if(void 0===a){var o=this.getCurrRuleFullName(),s=this.getGAstProductions().get(o);return a=n.buildLookaheadFuncForOptionalProd(t,s,r,this.dynamicTokensEnabled,i,this.lookAheadBuilderForOptional),this.setLaFuncCache(e,a),a}return a},e.prototype.getLaFuncFromCache=function(e){},e.prototype.getLaFuncFromMap=function(e){return this.lookAheadFuncsCache.get(e)},e.prototype.getLaFuncFromObj=function(e){return this.lookAheadFuncsCache[e]},e.prototype.setLaFuncCache=function(e,t){},e.prototype.setLaFuncCacheUsingMap=function(e,t){this.lookAheadFuncsCache.set(e,t)},e.prototype.setLaFuncUsingObj=function(e,t){this.lookAheadFuncsCache[e]=t},e}();t.LooksAhead=s},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(16),i=r(0),a=r(33),o=r(9),s=r(3),c=function(){function e(){}return e.prototype.initTreeBuilder=function(e){this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.outputCst=i.has(e,"outputCst")?e.outputCst:s.DEFAULT_PARSER_CONFIG.outputCst,this.outputCst||(this.cstInvocationStateUpdate=i.NOOP,this.cstFinallyStateUpdate=i.NOOP,this.cstPostTerminal=i.NOOP,this.cstPostNonTerminal=i.NOOP,this.getLastExplicitRuleShortName=this.getLastExplicitRuleShortNameNoCst,this.getPreviousExplicitRuleShortName=this.getPreviousExplicitRuleShortNameNoCst,this.getLastExplicitRuleOccurrenceIndex=this.getLastExplicitRuleOccurrenceIndexNoCst,this.manyInternal=this.manyInternalNoCst,this.orInternal=this.orInternalNoCst,this.optionInternal=this.optionInternalNoCst,this.atLeastOneInternal=this.atLeastOneInternalNoCst,this.manySepFirstInternal=this.manySepFirstInternalNoCst,this.atLeastOneSepFirstInternal=this.atLeastOneSepFirstInternalNoCst)},e.prototype.cstNestedInvocationStateUpdate=function(e,t){this.CST_STACK.push({name:e,fullName:this.shortRuleNameToFull.get(this.getLastExplicitRuleShortName())+e,children:{}})},e.prototype.cstInvocationStateUpdate=function(e,t){this.LAST_EXPLICIT_RULE_STACK.push(this.RULE_STACK.length-1),this.CST_STACK.push({name:e,children:{}})},e.prototype.cstFinallyStateUpdate=function(){this.LAST_EXPLICIT_RULE_STACK.pop(),this.CST_STACK.pop()},e.prototype.cstNestedFinallyStateUpdate=function(){this.CST_STACK.pop()},e.prototype.cstPostTerminal=function(e,t){var r=this.CST_STACK[this.CST_STACK.length-1];n.addTerminalToCst(r,t,e)},e.prototype.cstPostNonTerminal=function(e,t){n.addNoneTerminalToCst(this.CST_STACK[this.CST_STACK.length-1],t,e)},e.prototype.getBaseCstVisitorConstructor=function(){if(i.isUndefined(this.baseCstVisitorConstructor)){var e=a.createBaseSemanticVisitorConstructor(this.className,this.allRuleNames);return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor},e.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if(i.isUndefined(this.baseCstVisitorWithDefaultsConstructor)){var e=a.createBaseVisitorConstructorWithDefaults(this.className,this.allRuleNames,this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor},e.prototype.nestedRuleBeforeClause=function(e,t){var r;return void 0!==e.NAME?(r=e.NAME,this.nestedRuleInvocationStateUpdate(r,t),r):void 0},e.prototype.nestedAltBeforeClause=function(e,t,r,n){var i,a=this.getLastExplicitRuleShortName(),s=o.getKeyForAltIndex(a,r,t,n);return void 0!==e.NAME?(i=e.NAME,this.nestedRuleInvocationStateUpdate(i,s),{shortName:s,nestedName:i}):void 0},e.prototype.nestedRuleFinallyClause=function(e,t){var r=this.CST_STACK,i=r[r.length-1];this.nestedRuleFinallyStateUpdate();var a=r[r.length-1];n.addNoneTerminalToCst(a,t,i)},e.prototype.getLastExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_STACK[e]},e.prototype.getLastExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-1]},e.prototype.getPreviousExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-2];return this.RULE_STACK[e]},e.prototype.getPreviousExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-2]},e.prototype.getLastExplicitRuleOccurrenceIndex=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_OCCURRENCE_STACK[e]},e.prototype.getLastExplicitRuleOccurrenceIndexNoCst=function(){var e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]},e.prototype.nestedRuleInvocationStateUpdate=function(e,t){this.RULE_OCCURRENCE_STACK.push(1),this.RULE_STACK.push(t),this.cstNestedInvocationStateUpdate(e,t)},e.prototype.nestedRuleFinallyStateUpdate=function(){this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstNestedFinallyStateUpdate()},e}();t.TreeBuilder=c},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(0),a=r(4),o=r(11);function s(e,t){for(var r=i.keys(e),n=r.length,a=0;a<n;a++)for(var o=e[r[a]],s=o.length,c=0;c<s;c++){var u=o[c];void 0===u.tokenTypeIdx&&(void 0!==u.fullName?this[u.fullName](u.children,t):this[u.name](u.children,t))}}function c(e,t){var r=u(e,t),n=p(e,t);return r.concat(n)}function u(e,t){var r=i.map(t,(function(t){if(!i.isFunction(e[t]))return{msg:"Missing visitor method: <"+t+"> on "+a.functionName(e.constructor)+" CST Visitor.",type:n.MISSING_METHOD,methodName:t}}));return i.compact(r)}t.defaultVisit=s,t.createBaseSemanticVisitorConstructor=function(e,t){var r=function(){};return a.defineNameProp(r,e+"BaseSemantics"),(r.prototype={visit:function(e,t){if(i.isArray(e)&&(e=e[0]),!i.isUndefined(e))return void 0!==e.fullName?this[e.fullName](e.children,t):this[e.name](e.children,t)},validateVisitor:function(){var e=c(this,t);if(!i.isEmpty(e)){var r=i.map(e,(function(e){return e.msg}));throw Error("Errors Detected in CST Visitor <"+a.functionName(this.constructor)+">:\n\t"+r.join("\n\n").replace(/\n/g,"\n\t"))}}}).constructor=r,r._RULE_NAMES=t,r},t.createBaseVisitorConstructorWithDefaults=function(e,t,r){var n=function(){};a.defineNameProp(n,e+"BaseSemanticsWithDefaults");var o=Object.create(r.prototype);return i.forEach(t,(function(e){o[e]=s})),(n.prototype=o).constructor=n,n},function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"}(n=t.CstVisitorDefinitionError||(t.CstVisitorDefinitionError={})),t.validateVisitor=c,t.validateMissingCstMethods=u;var l=["constructor","visit","validateVisitor"];function p(e,t){var r=[];for(var s in e)o.validTermsPattern.test(s)&&i.isFunction(e[s])&&!i.contains(l,s)&&!i.contains(t,s)&&r.push({msg:"Redundant visitor method: <"+s+"> on "+a.functionName(e.constructor)+" CST Visitor\nThere is no Grammar Rule corresponding to this method's name.\nFor utility methods on visitor classes use methods names that do not match /"+o.validTermsPattern.source+"/.",type:n.REDUNDANT_METHOD,methodName:s});return r}t.validateRedundantMethods=p},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=function(){function e(){}return e.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(e.prototype,"input",{get:function(){return this.tokVector},set:function(e){this.reset(),this.tokVector=e,this.tokVectorLength=e.length},enumerable:!0,configurable:!0}),e.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):n.END_OF_FILE},e.prototype.LA=function(e){return this.currIdx+e<0||this.tokVectorLength<=this.currIdx+e?n.END_OF_FILE:this.tokVector[this.currIdx+e]},e.prototype.consumeToken=function(){this.currIdx++},e.prototype.exportLexerState=function(){return this.currIdx},e.prototype.importLexerState=function(e){this.currIdx=e},e.prototype.resetLexerState=function(){this.currIdx=-1},e.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},e.prototype.getLexerPosition=function(){return this.exportLexerState()},e}();t.LexerAdapter=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(6),a=r(3),o=r(10),s=r(23),c=r(11),u=r(1),l=function(){function e(){}return e.prototype.CONSUME=function(e,t){return this.consumeInternal(e,0,t)},e.prototype.CONSUME1=function(e,t){return this.consumeInternal(e,1,t)},e.prototype.CONSUME2=function(e,t){return this.consumeInternal(e,2,t)},e.prototype.CONSUME3=function(e,t){return this.consumeInternal(e,3,t)},e.prototype.CONSUME4=function(e,t){return this.consumeInternal(e,4,t)},e.prototype.CONSUME5=function(e,t){return this.consumeInternal(e,5,t)},e.prototype.CONSUME6=function(e,t){return this.consumeInternal(e,6,t)},e.prototype.CONSUME7=function(e,t){return this.consumeInternal(e,7,t)},e.prototype.CONSUME8=function(e,t){return this.consumeInternal(e,8,t)},e.prototype.CONSUME9=function(e,t){return this.consumeInternal(e,9,t)},e.prototype.SUBRULE=function(e,t){return this.subruleInternal(e,0,t)},e.prototype.SUBRULE1=function(e,t){return this.subruleInternal(e,1,t)},e.prototype.SUBRULE2=function(e,t){return this.subruleInternal(e,2,t)},e.prototype.SUBRULE3=function(e,t){return this.subruleInternal(e,3,t)},e.prototype.SUBRULE4=function(e,t){return this.subruleInternal(e,4,t)},e.prototype.SUBRULE5=function(e,t){return this.subruleInternal(e,5,t)},e.prototype.SUBRULE6=function(e,t){return this.subruleInternal(e,6,t)},e.prototype.SUBRULE7=function(e,t){return this.subruleInternal(e,7,t)},e.prototype.SUBRULE8=function(e,t){return this.subruleInternal(e,8,t)},e.prototype.SUBRULE9=function(e,t){return this.subruleInternal(e,9,t)},e.prototype.OPTION=function(e){return this.optionInternal(e,0)},e.prototype.OPTION1=function(e){return this.optionInternal(e,1)},e.prototype.OPTION2=function(e){return this.optionInternal(e,2)},e.prototype.OPTION3=function(e){return this.optionInternal(e,3)},e.prototype.OPTION4=function(e){return this.optionInternal(e,4)},e.prototype.OPTION5=function(e){return this.optionInternal(e,5)},e.prototype.OPTION6=function(e){return this.optionInternal(e,6)},e.prototype.OPTION7=function(e){return this.optionInternal(e,7)},e.prototype.OPTION8=function(e){return this.optionInternal(e,8)},e.prototype.OPTION9=function(e){return this.optionInternal(e,9)},e.prototype.OR=function(e){return this.orInternal(e,0)},e.prototype.OR1=function(e){return this.orInternal(e,1)},e.prototype.OR2=function(e){return this.orInternal(e,2)},e.prototype.OR3=function(e){return this.orInternal(e,3)},e.prototype.OR4=function(e){return this.orInternal(e,4)},e.prototype.OR5=function(e){return this.orInternal(e,5)},e.prototype.OR6=function(e){return this.orInternal(e,6)},e.prototype.OR7=function(e){return this.orInternal(e,7)},e.prototype.OR8=function(e){return this.orInternal(e,8)},e.prototype.OR9=function(e){return this.orInternal(e,9)},e.prototype.MANY=function(e){this.manyInternal(0,e)},e.prototype.MANY1=function(e){this.manyInternal(1,e)},e.prototype.MANY2=function(e){this.manyInternal(2,e)},e.prototype.MANY3=function(e){this.manyInternal(3,e)},e.prototype.MANY4=function(e){this.manyInternal(4,e)},e.prototype.MANY5=function(e){this.manyInternal(5,e)},e.prototype.MANY6=function(e){this.manyInternal(6,e)},e.prototype.MANY7=function(e){this.manyInternal(7,e)},e.prototype.MANY8=function(e){this.manyInternal(8,e)},e.prototype.MANY9=function(e){this.manyInternal(9,e)},e.prototype.MANY_SEP=function(e){this.manySepFirstInternal(0,e)},e.prototype.MANY_SEP1=function(e){this.manySepFirstInternal(1,e)},e.prototype.MANY_SEP2=function(e){this.manySepFirstInternal(2,e)},e.prototype.MANY_SEP3=function(e){this.manySepFirstInternal(3,e)},e.prototype.MANY_SEP4=function(e){this.manySepFirstInternal(4,e)},e.prototype.MANY_SEP5=function(e){this.manySepFirstInternal(5,e)},e.prototype.MANY_SEP6=function(e){this.manySepFirstInternal(6,e)},e.prototype.MANY_SEP7=function(e){this.manySepFirstInternal(7,e)},e.prototype.MANY_SEP8=function(e){this.manySepFirstInternal(8,e)},e.prototype.MANY_SEP9=function(e){this.manySepFirstInternal(9,e)},e.prototype.AT_LEAST_ONE=function(e){this.atLeastOneInternal(0,e)},e.prototype.AT_LEAST_ONE1=function(e){return this.atLeastOneInternal(1,e)},e.prototype.AT_LEAST_ONE2=function(e){this.atLeastOneInternal(2,e)},e.prototype.AT_LEAST_ONE3=function(e){this.atLeastOneInternal(3,e)},e.prototype.AT_LEAST_ONE4=function(e){this.atLeastOneInternal(4,e)},e.prototype.AT_LEAST_ONE5=function(e){this.atLeastOneInternal(5,e)},e.prototype.AT_LEAST_ONE6=function(e){this.atLeastOneInternal(6,e)},e.prototype.AT_LEAST_ONE7=function(e){this.atLeastOneInternal(7,e)},e.prototype.AT_LEAST_ONE8=function(e){this.atLeastOneInternal(8,e)},e.prototype.AT_LEAST_ONE9=function(e){this.atLeastOneInternal(9,e)},e.prototype.AT_LEAST_ONE_SEP=function(e){this.atLeastOneSepFirstInternal(0,e)},e.prototype.AT_LEAST_ONE_SEP1=function(e){this.atLeastOneSepFirstInternal(1,e)},e.prototype.AT_LEAST_ONE_SEP2=function(e){this.atLeastOneSepFirstInternal(2,e)},e.prototype.AT_LEAST_ONE_SEP3=function(e){this.atLeastOneSepFirstInternal(3,e)},e.prototype.AT_LEAST_ONE_SEP4=function(e){this.atLeastOneSepFirstInternal(4,e)},e.prototype.AT_LEAST_ONE_SEP5=function(e){this.atLeastOneSepFirstInternal(5,e)},e.prototype.AT_LEAST_ONE_SEP6=function(e){this.atLeastOneSepFirstInternal(6,e)},e.prototype.AT_LEAST_ONE_SEP7=function(e){this.atLeastOneSepFirstInternal(7,e)},e.prototype.AT_LEAST_ONE_SEP8=function(e){this.atLeastOneSepFirstInternal(8,e)},e.prototype.AT_LEAST_ONE_SEP9=function(e){this.atLeastOneSepFirstInternal(9,e)},e.prototype.RULE=function(e,t,r){if(void 0===r&&(r=a.DEFAULT_RULE_CONFIG),n.contains(this.definedRulesNames,e)){var i={message:o.defaultGrammarValidatorErrorProvider.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:a.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(i)}if(this.definedRulesNames.push(e),!this.gastProductionsCache.containsKey(e)&&!this.serializedGrammar){var c=s.buildTopProduction(t.toString(),e,this.tokensMap);this.gastProductionsCache.put(e,c)}var u=this.defineRule(e,t,r);return this[e]=u,u},e.prototype.OVERRIDE_RULE=function(e,t,r){void 0===r&&(r=a.DEFAULT_RULE_CONFIG);var n=[];if(n=n.concat(c.validateRuleIsOverridden(e,this.definedRulesNames,this.className)),this.definitionErrors.push.apply(this.definitionErrors,n),!this.serializedGrammar){var i=s.buildTopProduction(t.toString(),e,this.tokensMap);this.gastProductionsCache.put(e,i)}var o=this.defineRule(e,t,r);return this[e]=o,o},e.prototype.BACKTRACK=function(e,t){return function(){this.isBackTrackingStack.push(1);var r=this.saveRecogState();try{return e.apply(this,t),!0}catch(e){if(i.isRecognitionException(e))return!1;throw e}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}},e.prototype.getGAstProductions=function(){return this.gastProductionsCache},e.prototype.getSerializedGastProductions=function(){return u.serializeGrammar(this.gastProductionsCache.values())},e}();t.RecognizerApi=l},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(9),a=r(6),o=r(12),s=r(13),c=r(3),u=r(25),l=r(2),p=r(7),h=r(4),f=function(){function e(){}return e.prototype.initRecognizerEngine=function(e,t){if(this.className=h.classNameFromInstance(this),this.shortRuleNameToFull=new h.HashTable,this.fullRuleNameToShort=new h.HashTable,this.ruleShortNameIdx=256,this.tokenMatcher=p.tokenStructuredMatcherNoCategories,this.definedRulesNames=[],this.tokensMap={},this.allRuleNames=[],this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache=new h.HashTable,this.serializedGrammar=n.has(t,"serializedGrammar")?t.serializedGrammar:c.DEFAULT_PARSER_CONFIG.serializedGrammar,n.isArray(e)){if(n.isEmpty(e))throw Error("A Token Vocabulary cannot be empty.\n\tNote that the first argument for the parser constructor\n\tis no longer a Token vector (since v4.0).");if("number"==typeof e[0].startOffset)throw Error("The Parser constructor no longer accepts a token vector as the first argument.\n\tSee: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_4-0-0\n\tFor Further details.")}if(n.isArray(e))this.tokensMap=n.reduce(e,(function(e,t){return e[l.tokenName(t)]=t,e}),{});else if(n.has(e,"modes")&&n.every(n.flatten(n.values(e.modes)),p.isTokenType)){var r=n.flatten(n.values(e.modes)),i=n.uniq(r);this.tokensMap=n.reduce(i,(function(e,t){return e[l.tokenName(t)]=t,e}),{})}else{if(!n.isObject(e))throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap=n.cloneObj(e)}this.tokensMap.EOF=l.EOF;var a=n.every(n.values(e),(function(e){return n.isEmpty(e.categoryMatches)}));this.tokenMatcher=a?p.tokenStructuredMatcherNoCategories:p.tokenStructuredMatcher,p.augmentTokenTypes(n.values(this.tokensMap))},e.prototype.defineRule=function(e,t,r){if(this.selfAnalysisDone)throw Error("Grammar rule <"+e+"> may not be defined after the 'performSelfAnalysis' method has been called'\nMake sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.");var o,s=n.has(r,"resyncEnabled")?r.resyncEnabled:c.DEFAULT_RULE_CONFIG.resyncEnabled,u=n.has(r,"recoveryValueFunc")?r.recoveryValueFunc:c.DEFAULT_RULE_CONFIG.recoveryValueFunc,l=this.ruleShortNameIdx<<i.BITS_FOR_METHOD_IDX+i.BITS_FOR_OCCURRENCE_IDX;return this.ruleShortNameIdx++,this.shortRuleNameToFull.put(l,e),this.fullRuleNameToShort.put(e,l),(o=function(r,n){return void 0===r&&(r=0),this.ruleInvocationStateUpdate(l,e,r),function(e){try{return!0===this.outputCst?(t.apply(this,e),this.CST_STACK[this.CST_STACK.length-1]):t.apply(this,e)}catch(e){var r=1===this.RULE_STACK.length,n=s&&!this.isBackTracking()&&this.recoveryEnabled;if(a.isRecognitionException(e)){if(n){var i,o=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(o))return e.resyncedTokens=this.reSyncTo(o),this.outputCst?((i=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,i):u();throw this.outputCst&&((i=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,e.partialCstResult=i),e}if(r)return this.moveToTerminatedState(),u();throw e}throw e}finally{this.ruleFinallyStateUpdate()}}.call(this,n)}).ruleName=e,o},e.prototype.optionInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.OPTION_IDX,t),n=this.nestedRuleBeforeClause(e,r);try{return this.optionInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.optionInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.OPTION_IDX,t);return this.optionInternalLogic(e,t,r)},e.prototype.optionInternalLogic=function(e,t,r){var n,i,a=this,o=this.getLookaheadFuncForOption(r,t);if(void 0!==e.DEF){if(n=e.DEF,void 0!==(i=e.GATE)){var s=o;o=function(){return i.call(a)&&s.call(a)}}}else n=e;if(!0===o.call(this))return n.call(this)},e.prototype.atLeastOneInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{return this.atLeastOneInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.atLeastOneInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_IDX,e);this.atLeastOneInternalLogic(e,t,r)},e.prototype.atLeastOneInternalLogic=function(e,t,r){var n,a,c=this,u=this.getLookaheadFuncForAtLeastOne(r,e);if(void 0!==t.DEF){if(n=t.DEF,void 0!==(a=t.GATE)){var l=u;u=function(){return a.call(c)&&l.call(c)}}}else n=t;if(!0!==u.call(this))throw this.raiseEarlyExitException(e,o.PROD_TYPE.REPETITION_MANDATORY,t.ERR_MSG);for(var p=this.doSingleRepetition(n);!0===u.call(this)&&!0===p;)p=this.doSingleRepetition(n);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],u,i.AT_LEAST_ONE_IDX,e,s.NextTerminalAfterAtLeastOneWalker)},e.prototype.atLeastOneSepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_SEP_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{this.atLeastOneSepFirstInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.atLeastOneSepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_SEP_IDX,e);this.atLeastOneSepFirstInternalLogic(e,t,r)},e.prototype.atLeastOneSepFirstInternalLogic=function(e,t,r){var n=this,a=t.DEF,c=t.SEP;if(!0!==this.getLookaheadFuncForAtLeastOneSep(r,e).call(this))throw this.raiseEarlyExitException(e,o.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG);a.call(this);for(var u=function(){return n.tokenMatcher(n.LA(1),c)};!0===this.tokenMatcher(this.LA(1),c);)this.CONSUME(c),a.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,c,u,a,s.NextTerminalAfterAtLeastOneSepWalker],u,i.AT_LEAST_ONE_SEP_IDX,e,s.NextTerminalAfterAtLeastOneSepWalker)},e.prototype.manyInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{return this.manyInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.manyInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_IDX,e);return this.manyInternalLogic(e,t,r)},e.prototype.manyInternalLogic=function(e,t,r){var n,a,o=this,c=this.getLookaheadFuncForMany(r,e);if(void 0!==t.DEF){if(n=t.DEF,void 0!==(a=t.GATE)){var u=c;c=function(){return a.call(o)&&u.call(o)}}}else n=t;for(var l=!0;!0===c.call(this)&&!0===l;)l=this.doSingleRepetition(n);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],c,i.MANY_IDX,e,s.NextTerminalAfterManyWalker)},e.prototype.manySepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_SEP_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{this.manySepFirstInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.manySepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_SEP_IDX,e);this.manySepFirstInternalLogic(e,t,r)},e.prototype.manySepFirstInternalLogic=function(e,t,r){var n=this,a=t.DEF,o=t.SEP;if(!0===this.getLookaheadFuncForManySep(r,e).call(this)){a.call(this);for(var c=function(){return n.tokenMatcher(n.LA(1),o)};!0===this.tokenMatcher(this.LA(1),o);)this.CONSUME(o),a.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,o,c,a,s.NextTerminalAfterManySepWalker],c,i.MANY_SEP_IDX,e,s.NextTerminalAfterManySepWalker)}},e.prototype.repetitionSepSecondInternal=function(e,t,r,n,a){for(;r();)this.CONSUME(t),n.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,r,n,a],r,i.AT_LEAST_ONE_SEP_IDX,e,a)},e.prototype.doSingleRepetition=function(e){var t=this.getLexerPosition();return e.call(this),this.getLexerPosition()>t},e.prototype.orInternalNoCst=function(e,t){var r=n.isArray(e)?e:e.DEF,i=this.getLookaheadFuncForOr(t,r).call(this,r);if(void 0!==i)return r[i].ALT.call(this);this.raiseNoAltException(t,e.ERR_MSG)},e.prototype.orInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.OR_IDX,t),a=this.nestedRuleBeforeClause(e,r);try{var o=n.isArray(e)?e:e.DEF,s=this.getLookaheadFuncForOr(t,o).call(this,o);if(void 0!==s){var c=o[s],u=this.nestedAltBeforeClause(c,t,i.OR_IDX,s);try{return c.ALT.call(this)}finally{void 0!==u&&this.nestedRuleFinallyClause(u.shortName,u.nestedName)}}this.raiseNoAltException(t,e.ERR_MSG)}finally{void 0!==a&&this.nestedRuleFinallyClause(r,a)}},e.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),0===this.RULE_STACK.length&&!this.isAtEndOfInput()){var e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new a.NotAllInputParsedException(t,e))}},e.prototype.subruleInternal=function(e,t,r){var n;try{var i=void 0!==r?r.ARGS:void 0;return n=e.call(this,t,i),this.cstPostNonTerminal(n,void 0!==r&&void 0!==r.LABEL?r.LABEL:e.ruleName),n}catch(t){throw a.isRecognitionException(t)&&void 0!==t.partialCstResult&&(this.cstPostNonTerminal(t.partialCstResult,void 0!==r&&void 0!==r.LABEL?r.LABEL:e.ruleName),delete t.partialCstResult),t}},e.prototype.consumeInternal=function(e,t,r){var n;try{var i=this.LA(1);if(!0!==this.tokenMatcher(i,e)){var o,s=this.LA(0);throw o=void 0!==r&&r.ERR_MSG?r.ERR_MSG:this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:i,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new a.MismatchedTokenException(o,i,s))}this.consumeToken(),n=i}catch(r){if(!this.recoveryEnabled||"MismatchedTokenException"!==r.name||this.isBackTracking())throw r;var c=this.getFollowsForInRuleRecovery(e,t);try{n=this.tryInRuleRecovery(e,c)}catch(e){throw e.name===u.IN_RULE_RECOVERY_EXCEPTION?r:e}}return this.cstPostTerminal(void 0!==r&&void 0!==r.LABEL?r.LABEL:e.tokenName,n),n},e.prototype.saveRecogState=function(){var e=this.errors,t=n.cloneArr(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK,LAST_EXPLICIT_RULE_STACK:this.LAST_EXPLICIT_RULE_STACK}},e.prototype.reloadRecogState=function(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK},e.prototype.ruleInvocationStateUpdate=function(e,t,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t,e)},e.prototype.isBackTracking=function(){return!n.isEmpty(this.isBackTrackingStack)},e.prototype.getCurrRuleFullName=function(){var e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull.get(e)},e.prototype.shortRuleNameToFullName=function(e){return this.shortRuleNameToFull.get(e)},e.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),l.EOF)},e.prototype.reset=function(){this.resetLexerState(),this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},e}();t.RecognizerEngine=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(6),i=r(0),a=r(12),o=r(3),s=function(){function e(){}return e.prototype.initErrorHandler=function(e){this._errors=[],this.errorMessageProvider=i.defaults(e.errorMessageProvider,o.DEFAULT_PARSER_CONFIG.errorMessageProvider)},e.prototype.SAVE_ERROR=function(e){if(n.isRecognitionException(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:i.cloneArr(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(e.prototype,"errors",{get:function(){return i.cloneArr(this._errors)},set:function(e){this._errors=e},enumerable:!0,configurable:!0}),e.prototype.raiseEarlyExitException=function(e,t,r){for(var i=this.getCurrRuleFullName(),o=this.getGAstProductions().get(i),s=a.getLookaheadPathsForOptionalProd(e,o,t,this.maxLookahead)[0],c=[],u=1;u<this.maxLookahead;u++)c.push(this.LA(u));var l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:s,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new n.EarlyExitException(l,this.LA(1),this.LA(0)))},e.prototype.raiseNoAltException=function(e,t){for(var r=this.getCurrRuleFullName(),i=this.getGAstProductions().get(r),o=a.getLookaheadPathsForOr(e,i,this.maxLookahead),s=[],c=1;c<=this.maxLookahead;c++)s.push(this.LA(c));var u=this.LA(0),l=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:o,actual:s,previous:u,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new n.NoViableAltException(l,this.LA(1),u))},e}();t.ErrorHandler=s},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(13),i=r(0),a=function(){function e(){}return e.prototype.initContentAssist=function(){},e.prototype.computeContentAssist=function(e,t){var r=this.gastProductionsCache.get(e);if(i.isUndefined(r))throw Error("Rule ->"+e+"<- does not exist in this grammar.");return n.nextPossibleTokensAfter([r],t,this.tokenMatcher,this.maxLookahead)},e.prototype.getNextPossibleTokenTypes=function(e){var t=i.first(e.ruleStack),r=this.getGAstProductions().get(t);return new n.NextAfterTokenWalker(r,e).startWalking()},e}();t.ContentAssist=a},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(17);t.createSyntaxDiagramsCode=function(e,t){var r=void 0===t?{}:t,i=r.resourceBase,a=void 0===i?"https://unpkg.com/chevrotain@"+n.VERSION+"/diagrams/":i,o=r.css;return"\n\x3c!-- This is a generated file --\x3e\n<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n  body {\n    background-color: hsl(30, 20%, 95%)\n  }\n</style>\n\n\n<link rel='stylesheet' href='"+(void 0===o?"https://unpkg.com/chevrotain@"+n.VERSION+"/diagrams/diagrams.css":o)+"'>\n\n<script src='"+a+"vendor/railroad-diagrams.js'><\/script>\n<script src='"+a+"src/diagrams_builder.js'><\/script>\n<script src='"+a+"src/diagrams_behavior.js'><\/script>\n<script src='"+a+'src/main.js\'><\/script>\n\n<div id="diagrams" align="center"></div>    \n\n<script>\n    window.serializedGrammar = '+JSON.stringify(e,null,"  ")+';\n<\/script>\n\n<script>\n    var diagramsDiv = document.getElementById("diagrams");\n    main.drawDiagramsFromSerializedGrammar(serializedGrammar, diagramsDiv);\n<\/script>\n'}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(41);t.generateParserFactory=function(e){var t=n.genWrapperFunction({name:e.name,rules:e.rules}),i=new Function("tokenVocabulary","config","chevrotain",t);return function(t){return i(e.tokenVocabulary,t,r(18))}},t.generateParserModule=function(e){return n.genUmdModule({name:e.name,rules:e.rules})}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(2),a=r(1),o="\n";function s(e){return"\nfunction "+e.name+"(tokenVocabulary, config) {\n    // invoke super constructor\n    // No support for embedded actions currently, so we can 'hardcode'\n    // The use of CstParser.\n    chevrotain.CstParser.call(this, tokenVocabulary, config)\n\n    const $ = this\n\n    "+c(e.rules)+"\n\n    // very important to call this after all the rules have been defined.\n    // otherwise the parser may not work correctly as it will lack information\n    // derived during the self analysis phase.\n    this.performSelfAnalysis(this)\n}\n\n// inheritance as implemented in javascript in the previous decade... :(\n"+e.name+".prototype = Object.create(chevrotain.CstParser.prototype)\n"+e.name+".prototype.constructor = "+e.name+"    \n    "}function c(e){return n.map(e,(function(e){return u(e,1)})).join("\n")}function u(e,t){var r=g(t,'$.RULE("'+e.name+'", function() {')+o;return(r+=m(e.definition,t+1))+(g(t+1,"})")+o)}function l(e,t){var r=i.tokenName(e.terminalType);return g(t,"$.CONSUME"+e.idx+"(this.tokensMap."+r+")"+o)}function p(e,t){return g(t,"$.SUBRULE"+e.idx+"($."+e.nonTerminalName+")"+o)}function h(e,t){var r=g(t,"$.OR"+e.idx+"([")+o;return(r+=n.map(e.definition,(function(e){return f(e,t+1)})).join(",\n"))+(o+g(t,"])\n"))}function f(e,t){var r=g(t,"{")+o;return e.name&&(r+=g(t+1,'NAME: "'+e.name+'",')+o),r+=g(t+1,"ALT: function() {")+o,r+=m(e.definition,t+1),(r+=g(t+1,"}")+o)+g(t,"}")}function d(e,t,r){var n=g(r,"$."+(e+t.idx)+"(");return t.name||t.separator?(n+="{\n",t.name&&(n+=g(r+1,'NAME: "'+t.name+'"')+","+o),t.separator&&(n+=g(r+1,"SEP: this.tokensMap."+i.tokenName(t.separator))+","+o),n+="DEF: "+v(t.definition,r+2)+o,n+=g(r,"}")+o):n+=v(t.definition,r+1),n+(g(r,")")+o)}function v(e,t){var r="function() {\n";return(r+=m(e,t))+(g(t,"}")+o)}function m(e,t){var r="";return n.forEach(e,(function(e){r+=function(e,t){if(e instanceof a.NonTerminal)return p(e,t);if(e instanceof a.Option)return d("OPTION",e,t);if(e instanceof a.RepetitionMandatory)return d("AT_LEAST_ONE",e,t);if(e instanceof a.RepetitionMandatoryWithSeparator)return d("AT_LEAST_ONE_SEP",e,t);if(e instanceof a.RepetitionWithSeparator)return d("MANY_SEP",e,t);if(e instanceof a.Repetition)return d("MANY",e,t);if(e instanceof a.Alternation)return h(e,t);if(e instanceof a.Terminal)return l(e,t);if(e instanceof a.Flat)return m(e.definition,t);throw Error("non exhaustive match")}(e,t+1)})),r}function g(e,t){return Array(4*e+1).join(" ")+t}t.genUmdModule=function(e){return"\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define(['chevrotain'], factory);\n    } else if (typeof module === 'object' && module.exports) {\n        // Node. Does not work with strict CommonJS, but\n        // only CommonJS-like environments that support module.exports,\n        // like Node.\n        module.exports = factory(require('chevrotain'));\n    } else {\n        // Browser globals (root is window)\n        root.returnExports = factory(root.b);\n    }\n}(typeof self !== 'undefined' ? self : this, function (chevrotain) {\n\n"+s(e)+"\n    \nreturn {\n    "+e.name+": "+e.name+" \n}\n}));\n"},t.genWrapperFunction=function(e){return"    \n"+s(e)+"\nreturn new "+e.name+"(tokenVocabulary, config)    \n"},t.genClass=s,t.genAllRules=c,t.genRule=u,t.genTerminal=l,t.genNonTerminal=p,t.genAlternation=h,t.genSingleAlt=f}])},"object"==typeof exports&&"object"==typeof module?module.exports=l():"function"==typeof define&&define.amd?define("chevrotain",[],l):"object"==typeof exports?exports.chevrotain=l():u.chevrotain=l();var f=window.chevrotain,d=function(){if("undefined"===typeof f)throw Error("THREE.VRMLLoader: External library chevrotain.min.js required.");function e(e){n.L.call(this,e)}function t(e){this.lexer=new f.Lexer(e)}function r(e){f.Parser.call(this,e);var t=this,r=e.Version,n=e.LCurly,i=e.RCurly,a=e.LSquare,o=e.RSquare,s=e.Identifier,c=e.RouteIdentifier,u=e.StringLiteral,l=e.HexLiteral,p=e.NumberLiteral,h=e.TrueLiteral,d=e.FalseLiteral,v=e.NullLiteral,m=e.DEF,g=e.USE,y=e.ROUTE,E=e.TO,T=e.NodeName;t.RULE("vrml",(function(){t.SUBRULE(t.version),t.AT_LEAST_ONE((function(){t.SUBRULE(t.node)})),t.MANY((function(){t.SUBRULE(t.route)}))})),t.RULE("version",(function(){t.CONSUME(r)})),t.RULE("node",(function(){t.OPTION((function(){t.SUBRULE(t.def)})),t.CONSUME(T),t.CONSUME(n),t.MANY((function(){t.SUBRULE(t.field)})),t.CONSUME(i)})),t.RULE("field",(function(){t.CONSUME(s),t.OR2([{ALT:function(){t.SUBRULE(t.singleFieldValue)}},{ALT:function(){t.SUBRULE(t.multiFieldValue)}}])})),t.RULE("def",(function(){t.CONSUME(m),t.OR([{ALT:function(){t.CONSUME(s)}},{ALT:function(){t.CONSUME(T)}}])})),t.RULE("use",(function(){t.CONSUME(g),t.OR([{ALT:function(){t.CONSUME(s)}},{ALT:function(){t.CONSUME(T)}}])})),t.RULE("singleFieldValue",(function(){t.AT_LEAST_ONE((function(){t.OR([{ALT:function(){t.SUBRULE(t.node)}},{ALT:function(){t.SUBRULE(t.use)}},{ALT:function(){t.CONSUME(u)}},{ALT:function(){t.CONSUME(l)}},{ALT:function(){t.CONSUME(p)}},{ALT:function(){t.CONSUME(h)}},{ALT:function(){t.CONSUME(d)}},{ALT:function(){t.CONSUME(v)}}])}))})),t.RULE("multiFieldValue",(function(){t.CONSUME(a),t.MANY((function(){t.OR([{ALT:function(){t.SUBRULE(t.node)}},{ALT:function(){t.SUBRULE(t.use)}},{ALT:function(){t.CONSUME(u)}},{ALT:function(){t.CONSUME(l)}},{ALT:function(){t.CONSUME(p)}},{ALT:function(){t.CONSUME(v)}}])})),t.CONSUME(o)})),t.RULE("route",(function(){t.CONSUME(y),t.CONSUME(c),t.CONSUME(E),t.CONSUME2(c)})),this.performSelfAnalysis()}function i(e,t,r){this.a=e,this.b=t,this.c=r,this.normal=new n.V}e.prototype=Object.assign(Object.create(n.L.prototype),{constructor:e,load:function(e,t,r,i){var a=this,o=""===a.path?n.f.extractUrlBase(e):a.path,s=new n.F(a.manager);s.setPath(a.path),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(e,(function(r){try{t(a.parse(r,o))}catch(l){i?i(l):console.error(l),a.manager.itemError(e)}}),r,i)},parse:function(e,o){var s={};function c(e){e.DEF&&(s[e.DEF]=e);for(var t=e.fields,r=0,n=t.length;r<n;r++){var i=t[r];if("node"===i.type)for(var a=i.values,o=0,u=a.length;o<u;o++)c(a[o])}}function u(e){return e.USE?function(e){var t=u(s[e]);return t.isObject3D||t.isMaterial?t.clone():t}(e.USE):(void 0!==e.build||(e.build=function(e){var t,r=e.name;switch(r){case"Group":case"Transform":case"Collision":t=function(e){for(var t=new n.G,r=e.fields,i=0,a=r.length;i<a;i++){var o=r[i],s=o.name,c=o.values;switch(s){case"bboxCenter":case"bboxSize":case"center":break;case"children":h(c,t);break;case"collide":break;case"rotation":var u=new n.V(c[0],c[1],c[2]),l=c[3];t.quaternion.setFromAxisAngle(u,l);break;case"scale":t.scale.set(c[0],c[1],c[2]);break;case"scaleOrientation":break;case"translation":t.position.set(c[0],c[1],c[2]);break;case"proxy":break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}return t}(e);break;case"Background":t=function(e){for(var t,r,i,a,o=new n.G,s=e.fields,c=0,u=s.length;c<u;c++){var l=s[c],p=l.name,h=l.values;switch(p){case"groundAngle":t=h;break;case"groundColor":r=h;break;case"backUrl":case"bottomUrl":case"frontUrl":case"leftUrl":case"rightUrl":case"topUrl":break;case"skyAngle":i=h;break;case"skyColor":a=h;break;default:console.warn("THREE.VRMLLoader: Unknown field:",p)}}var f=1e4;if(a){var d=new n.ao(f,32,16),v=new n.g({fog:!1,side:n.ap,depthWrite:!1,depthTest:!1});a.length>3?(M(d,f,i,C(a),!0),v.vertexColors=!0):v.color.setRGB(a[0],a[1],a[2]);var m=new n.v(d,v);o.add(m)}if(r&&r.length>0){var g=new n.ao(f,32,16,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),y=new n.g({fog:!1,side:n.ap,vertexColors:!0,depthWrite:!1,depthTest:!1});M(g,f,t,C(r),!1);var E=new n.v(g,y);o.add(E)}return o.renderOrder=-1/0,o}(e);break;case"Shape":t=function(e){for(var t,r,i=e.fields,a=new n.g({color:0}),o=0,s=i.length;o<s;o++){var c=i[o],l=c.name,p=c.values;switch(l){case"appearance":null!==p[0]&&(a=u(p[0]));break;case"geometry":null!==p[0]&&(t=u(p[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}if(t&&t.attributes.position){var h=t._type;if("points"===h){var f=new n.P({color:16777215});void 0!==t.attributes.color?f.vertexColors=!0:a.isMeshPhongMaterial&&f.color.copy(a.emissive),r=new n.z(t,f)}else if("line"===h){var d=new n.q({color:16777215});void 0!==t.attributes.color?d.vertexColors=!0:a.isMeshPhongMaterial&&d.color.copy(a.emissive),r=new n.w(t,d)}else void 0!==t._solid&&(a.side=t._solid?n.a8:n.D),void 0!==t.attributes.color&&(a.vertexColors=!0),r=new n.v(t,a)}else(r=new n.U).visible=!1;return r}(e);break;case"Appearance":t=function(e){for(var t,r=new n.al,i=e.fields,o=0,s=i.length;o<s;o++){var c=i[o],l=c.name,p=c.values;switch(l){case"material":if(null!==p[0]){var h=u(p[0]);h.diffuseColor&&r.color.copy(h.diffuseColor),h.emissiveColor&&r.emissive.copy(h.emissiveColor),h.shininess&&(r.shininess=h.shininess),h.specularColor&&r.specular.copy(h.specularColor),h.transparency&&(r.opacity=1-h.transparency),h.transparency>0&&(r.transparent=!0)}else r=new n.g({color:0});break;case"texture":var f=p[0];null!==f&&("ImageTexture"!==f.name&&"PixelTexture"!==f.name||(r.map=u(f)));break;case"textureTransform":null!==p[0]&&(t=u(p[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}if(r.map){if(r.map.__type){switch(r.map.__type){case a.INTENSITY_ALPHA:r.opacity=1;break;case a.RGB:r.color.set(16777215);break;case a.RGBA:r.color.set(16777215),r.opacity=1}delete r.map.__type}t&&(r.map.center.copy(t.center),r.map.rotation=t.rotation,r.map.repeat.copy(t.scale),r.map.offset.copy(t.translation))}return r}(e);break;case"Material":t=function(e){for(var t={},r=e.fields,i=0,a=r.length;i<a;i++){var o=r[i],s=o.name,c=o.values;switch(s){case"ambientIntensity":break;case"diffuseColor":t.diffuseColor=new n.C(c[0],c[1],c[2]);break;case"emissiveColor":t.emissiveColor=new n.C(c[0],c[1],c[2]);break;case"shininess":t.shininess=c[0];break;case"specularColor":t.emissiveColor=new n.C(c[0],c[1],c[2]);break;case"transparency":t.transparency=c[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}return t}(e);break;case"ImageTexture":t=function(e){for(var t,r=n.o,i=n.o,a=e.fields,o=0,s=a.length;o<s;o++){var c=a[o],u=c.name,l=c.values;switch(u){case"url":var p=l[0];p&&(t=P.load(p));break;case"repeatS":!1===l[0]&&(r=n.a5);break;case"repeatT":!1===l[0]&&(i=n.a5);break;default:console.warn("THREE.VRMLLoader: Unknown field:",u)}}t&&(t.wrapS=r,t.wrapT=i);return t}(e);break;case"PixelTexture":t=function(e){for(var t,r=n.o,i=n.o,a=e.fields,o=0,s=a.length;o<s;o++){var c=a[o],u=c.name,h=c.values;switch(u){case"image":for(var f=h[0],d=h[1],v=h[2],m=2===v||4===v,g=p(v),y=new Uint8Array(f*d*(!0===m?4:3)),E={r:0,g:0,b:0,a:0},T=3,x=0,A=h.length;T<A;T++,x++){var b;if(l(h[T],g,E),!0===m)y[(b=4*x)+0]=E.r,y[b+1]=E.g,y[b+2]=E.b,y[b+3]=E.a;else y[(b=3*x)+0]=E.r,y[b+1]=E.g,y[b+2]=E.b}(t=new n.aq(y,f,d,!0===m?n.ar:n.R)).__type=g;break;case"repeatS":!1===h[0]&&(r=n.a5);break;case"repeatT":!1===h[0]&&(i=n.a5);break;default:console.warn("THREE.VRMLLoader: Unknown field:",u)}}t&&(t.wrapS=r,t.wrapT=i);return t}(e);break;case"TextureTransform":t=function(e){for(var t={center:new n.a,rotation:new n.a,scale:new n.a,translation:new n.a},r=e.fields,i=0,a=r.length;i<a;i++){var o=r[i],s=o.name,c=o.values;switch(s){case"center":t.center.set(c[0],c[1]);break;case"rotation":t.rotation=c[0];break;case"scale":t.scale.set(c[0],c[1]);break;case"translation":t.translation.set(c[0],c[1]);break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}return t}(e);break;case"IndexedFaceSet":t=function(e){for(var t,r,i,a,o,s,c,l,p=!0,h=!0,f=0,g=!0,y=!0,E=e.fields,T=0,x=E.length;T<x;T++){var A=E[T],b=A.name,w=A.values;switch(b){case"color":var _=w[0];null!==_&&(t=u(_));break;case"coord":var k=w[0];null!==k&&(r=u(k));break;case"normal":var I=w[0];null!==I&&(i=u(I));break;case"texCoord":var O=w[0];null!==O&&(a=u(O));break;case"ccw":p=w[0];break;case"colorIndex":o=w;break;case"colorPerVertex":g=w[0];break;case"convex":break;case"coordIndex":s=w;break;case"creaseAngle":f=w[0];break;case"normalIndex":c=w;break;case"normalPerVertex":y=w[0];break;case"solid":h=w[0];break;case"texCoordIndex":l=w;break;default:console.warn("THREE.VRMLLoader: Unknown field:",b)}}if(void 0===s)return console.warn("THREE.VRMLLoader: Missing coordIndex."),new n.B;var C,M,P,F,D=d(s,p);if(t){if(!0===g)if(o&&o.length>0)M=R(D,d(o,p),t,3);else M=S(D,new n.d(t,3));else if(o&&o.length>0)M=N(D,v(m(t,o),s));else M=N(D,v(t,s))}if(i){if(!0===y)if(c&&c.length>0)P=R(D,d(c,p),i,3);else P=S(D,new n.d(i,3));else if(c&&c.length>0)P=N(D,v(m(i,c),s));else P=N(D,v(i,s))}else P=L(D,r,f);if(a){if(l&&l.length>0)F=R(D,d(l,p),a,2);else F=S(D,new n.d(a,2))}var U=new n.B;C=S(D,new n.d(r,3)),U.setAttribute("position",C),U.setAttribute("normal",P),M&&U.setAttribute("color",M);F&&U.setAttribute("uv",F);return U._solid=h,U._type="mesh",U}(e);break;case"IndexedLineSet":t=function(e){for(var t,r,i,a,o,s=!0,c=e.fields,l=0,p=c.length;l<p;l++){var h=c[l],f=h.name,d=h.values;switch(f){case"color":var v=d[0];null!==v&&(t=u(v));break;case"coord":var E=d[0];null!==E&&(r=u(E));break;case"colorIndex":i=d;break;case"colorPerVertex":s=d[0];break;case"coordIndex":a=d;break;default:console.warn("THREE.VRMLLoader: Unknown field:",f)}}var T=g(a);if(t){if(!0===s)if(i.length>0)o=R(T,g(i),t,3);else o=S(T,new n.d(t,3));else if(i.length>0)o=_(T,y(m(t,i),a));else o=_(T,y(t,a))}var x=new n.B,A=S(T,new n.d(r,3));x.setAttribute("position",A),o&&x.setAttribute("color",o);return x._type="line",x}(e);break;case"PointSet":t=function(e){for(var t,r,i=e.fields,a=0,o=i.length;a<o;a++){var s=i[a],c=s.name,l=s.values;switch(c){case"color":var p=l[0];null!==p&&(t=u(p));break;case"coord":var h=l[0];null!==h&&(r=u(h));break;default:console.warn("THREE.VRMLLoader: Unknown field:",c)}}var f;(f=new n.B).setAttribute("position",new n.d(r,3)),t&&f.setAttribute("color",new n.d(t,3));return f._type="points",f}(e);break;case"Box":t=function(e){for(var t=new n.V(2,2,2),r=e.fields,i=0,a=r.length;i<a;i++){var o=r[i],s=o.name,c=o.values;switch(s){case"size":t.x=c[0],t.y=c[1],t.z=c[2];break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}return new n.as(t.x,t.y,t.z)}(e);break;case"Cone":t=function(e){for(var t=1,r=2,i=!1,a=e.fields,o=0,s=a.length;o<s;o++){var c=a[o],u=c.name,l=c.values;switch(u){case"bottom":i=!l[0];break;case"bottomRadius":t=l[0];break;case"height":r=l[0];break;case"side":break;default:console.warn("THREE.VRMLLoader: Unknown field:",u)}}return new n.at(t,r,16,1,i)}(e);break;case"Cylinder":t=function(e){for(var t=1,r=2,i=e.fields,a=0,o=i.length;a<o;a++){var s=i[a],c=s.name,u=s.values;switch(c){case"bottom":break;case"radius":t=u[0];break;case"height":r=u[0];break;case"side":case"top":break;default:console.warn("THREE.VRMLLoader: Unknown field:",c)}}return new n.au(t,t,r,16,1)}(e);break;case"Sphere":t=function(e){for(var t=1,r=e.fields,i=0,a=r.length;i<a;i++){var o=r[i],s=o.name,c=o.values;switch(s){case"radius":t=c[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}return new n.ao(t,16,16)}(e);break;case"ElevationGrid":t=function(e){for(var t,r,i,a,o=!0,s=!0,c=!0,l=!0,p=0,h=2,f=2,d=1,v=1,m=e.fields,g=0,y=m.length;g<y;g++){var E=m[g],T=E.name,x=E.values;switch(T){case"color":var A=x[0];null!==A&&(t=u(A));break;case"normal":var b=x[0];null!==b&&(r=u(b));break;case"texCoord":var w=x[0];null!==w&&(i=u(w));break;case"height":a=x;break;case"ccw":l=x[0];break;case"colorPerVertex":o=x[0];break;case"creaseAngle":p=x[0];break;case"normalPerVertex":s=x[0];break;case"solid":c=x[0];break;case"xDimension":h=x[0];break;case"xSpacing":d=x[0];break;case"zDimension":f=x[0];break;case"zSpacing":v=x[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",T)}}var R=[],N=[],_=[],k=[];for(g=0;g<f;g++)for(var I=0;I<h;I++){var O=d*g,C=a[$=g*h+I],M=v*I;if(R.push(O,C,M),t&&!0===o){var P=t[3*$+0],F=t[3*$+1],D=t[3*$+2];_.push(P,F,D)}if(r&&!0===s){var U=r[3*$+0],j=r[3*$+1],V=r[3*$+2];N.push(U,j,V)}if(i){var B=i[2*$+0],H=i[2*$+1];k.push(B,H)}else k.push(g/(h-1),I/(f-1))}var G=[];for(g=0;g<h-1;g++)for(I=0;I<f-1;I++){var z=g+I*h,W=(D=g+(I+1)*h,g+1+(I+1)*h),K=g+1+I*h;!0===l?(G.push(z,W,D),G.push(W,z,K)):(G.push(z,D,W),G.push(W,K,z))}var X,q,Y=S(G,new n.d(R,3)),Z=S(G,new n.d(k,2));if(t)if(!1===o){for(g=0;g<h-1;g++)for(I=0;I<f-1;I++){P=t[3*($=g+I*(h-1))+0],F=t[3*$+1],D=t[3*$+2];_.push(P,F,D),_.push(P,F,D),_.push(P,F,D),_.push(P,F,D),_.push(P,F,D),_.push(P,F,D)}X=new n.d(_,3)}else X=S(G,new n.d(_,3));if(r)if(!1===s){for(g=0;g<h-1;g++)for(I=0;I<f-1;I++){var $;U=r[3*($=g+I*(h-1))+0],j=r[3*$+1],V=r[3*$+2];N.push(U,j,V),N.push(U,j,V),N.push(U,j,V),N.push(U,j,V),N.push(U,j,V),N.push(U,j,V)}q=new n.d(N,3)}else q=S(G,new n.d(N,3));else q=L(G,R,p);var J=new n.B;J.setAttribute("position",Y),J.setAttribute("normal",q),J.setAttribute("uv",Z),X&&J.setAttribute("color",X);return J._solid=c,J._type="mesh",J}(e);break;case"Extrusion":t=function(e){for(var t,r,i=[1,1,1,-1,-1,-1,-1,1,1,1],a=[0,0,0,0,1,0],o=!0,s=!0,c=0,u=!0,l=!0,p=e.fields,h=0,f=p.length;h<f;h++){var d=p[h],v=d.name,m=d.values;switch(v){case"beginCap":o=m[0];break;case"ccw":s=m[0];break;case"convex":break;case"creaseAngle":c=m[0];break;case"crossSection":i=m;break;case"endCap":u=m[0];break;case"orientation":r=m;break;case"scale":t=m;break;case"solid":l=m[0];break;case"spine":a=m;break;default:console.warn("THREE.VRMLLoader: Unknown field:",v)}}for(var g=i[0]===i[i.length-2]&&i[1]===i[i.length-1],y=[],E=new n.V,T=new n.V,x=new n.V,A=new n.V,b=new n.Q,w=(h=0,0),R=0,N=a.length;h<N;h+=3,w+=2,R+=4){E.fromArray(a,h),T.x=t?t[w+0]:1,T.y=1,T.z=t?t[w+1]:1,x.x=r?r[R+0]:0,x.y=r?r[R+1]:0,x.z=r?r[R+2]:1;for(var _=r?r[R+3]:0,k=0,I=i.length;k<I;k+=2)A.x=i[k+0],A.y=0,A.z=i[k+1],A.multiply(T),b.setFromAxisAngle(x,_),A.applyQuaternion(b),A.add(E),y.push(A.x,A.y,A.z)}var O=[],C=a.length/3,M=i.length/2;for(h=0;h<C-1;h++)for(w=0;w<M-1;w++){var P=w+h*M,F=w+1+h*M,D=w+(h+1)*M,U=w+1+(h+1)*M;w===M-2&&!0===g&&(F=h*M,U=(h+1)*M),!0===s?(O.push(P,F,D),O.push(D,F,U)):(O.push(P,D,F),O.push(D,U,F))}if(!0===o||!0===u){var j=[];for(h=0,f=i.length;h<f;h+=2)j.push(new n.a(i[h],i[h+1]));var V=n.av.triangulateShape(j,[]),B=[];for(h=0,f=V.length;h<f;h++){var H=V[h];B.push(H[0],H[1],H[2])}if(!0===o)for(h=0,f=B.length;h<f;h+=3)!0===s?O.push(B[h+0],B[h+1],B[h+2]):O.push(B[h+0],B[h+2],B[h+1]);if(!0===u){var G=M*(C-1);for(h=0,f=B.length;h<f;h+=3)!0===s?O.push(G+B[h+0],G+B[h+2],G+B[h+1]):O.push(G+B[h+0],G+B[h+1],G+B[h+2])}}var z=S(O,new n.d(y,3)),W=L(O,y,c),K=new n.B;return K.setAttribute("position",z),K.setAttribute("normal",W),K._solid=l,K._type="mesh",K}(e);break;case"Color":case"Coordinate":case"Normal":case"TextureCoordinate":t=function(e){return e.fields[0].values}(e);break;case"WorldInfo":t=function(e){for(var t={},r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"title":t.title=s[0];break;case"info":t.info=s;break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return t}(e);break;case"Anchor":case"Billboard":case"Inline":case"LOD":case"Switch":case"AudioClip":case"DirectionalLight":case"PointLight":case"Script":case"Sound":case"SpotLight":case"CylinderSensor":case"PlaneSensor":case"ProximitySensor":case"SphereSensor":case"TimeSensor":case"TouchSensor":case"VisibilitySensor":case"Text":case"FontStyle":case"MovieTexture":case"ColorInterpolator":case"CoordinateInterpolator":case"NormalInterpolator":case"OrientationInterpolator":case"PositionInterpolator":case"ScalarInterpolator":case"Fog":case"NavigationInfo":case"Viewpoint":break;default:console.warn("THREE.VRMLLoader: Unknown node:",r)}void 0!==t&&void 0!==e.DEF&&!0===t.hasOwnProperty("name")&&(t.name=e.DEF);return t}(e)),e.build)}function l(e,t,r){switch(t){case a.INTENSITY:var n=parseInt(e);r.r=n,r.g=n,r.b=n;break;case a.INTENSITY_ALPHA:n=parseInt("0x"+e.substring(2,4));r.r=n,r.g=n,r.b=n,r.a=parseInt("0x"+e.substring(4,6));break;case a.RGB:r.r=parseInt("0x"+e.substring(2,4)),r.g=parseInt("0x"+e.substring(4,6)),r.b=parseInt("0x"+e.substring(6,8));break;case a.RGBA:r.r=parseInt("0x"+e.substring(2,4)),r.g=parseInt("0x"+e.substring(4,6)),r.b=parseInt("0x"+e.substring(6,8)),r.a=parseInt("0x"+e.substring(8,10))}}function p(e){var t;switch(e){case 1:t=a.INTENSITY;break;case 2:t=a.INTENSITY_ALPHA;break;case 3:t=a.RGB;break;case 4:t=a.RGBA}return t}function h(e,t){for(var r=0,i=e.length;r<i;r++){var a=u(e[r]);a instanceof n.U&&t.add(a)}}function d(e,t){for(var r=[],n=0,i=0,a=e.length;i<a;i++){var o=e[n],s=e[i+(t?1:2)],c=e[i+(t?2:1)];r.push(o,s,c),(-1===e[i+3]||i+3>=a)&&(n=(i+=3)+1)}return r}function v(e,t){for(var r=[],n=0,i=0,a=t.length;i<a;i++){var o=3*n,s=e[o],c=e[o+1],u=e[o+2];r.push(s,c,u),(-1===t[i+3]||i+3>=a)&&(i+=3,n++)}return r}function m(e,t){for(var r=[],n=0,i=t.length;n<i;n++){var a=3*t[n],o=e[a],s=e[a+1],c=e[a+2];r.push(o,s,c)}return r}function g(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r],a=e[r+1];t.push(i,a),(-1===e[r+2]||r+2>=n)&&(r+=2)}return t}function y(e,t){for(var r=[],n=0,i=0,a=t.length;i<a;i++){var o=3*n,s=e[o],c=e[o+1],u=e[o+2];r.push(s,c,u),(-1===t[i+2]||i+2>=a)&&(i+=2,n++)}return r}var E=new n.V,T=new n.V,x=new n.V,A=new n.a,b=new n.a,w=new n.a;function R(e,t,r,i){for(var a=[],o=0,s=e.length;o<s;o+=3){var c=t[o],u=t[o+1],l=t[o+2];2===i?(A.fromArray(r,c*i),b.fromArray(r,u*i),w.fromArray(r,l*i),a.push(A.x,A.y),a.push(b.x,b.y),a.push(w.x,w.y)):(E.fromArray(r,c*i),T.fromArray(r,u*i),x.fromArray(r,l*i),a.push(E.x,E.y,E.z),a.push(T.x,T.y,T.z),a.push(x.x,x.y,x.z))}return new n.d(a,i)}function N(e,t){for(var r=[],i=0,a=0,o=e.length;i<o;i+=3,a++)E.fromArray(t,3*a),r.push(E.x,E.y,E.z),r.push(E.x,E.y,E.z),r.push(E.x,E.y,E.z);return new n.d(r,3)}function _(e,t){for(var r=[],i=0,a=0,o=e.length;i<o;i+=2,a++)E.fromArray(t,3*a),r.push(E.x,E.y,E.z),r.push(E.x,E.y,E.z);return new n.d(r,3)}function S(e,t){for(var r=t.array,i=t.itemSize,a=new r.constructor(e.length*i),o=0,s=0,c=0,u=e.length;c<u;c++){o=e[c]*i;for(var l=0;l<i;l++)a[s++]=r[o++]}return new n.d(a,i)}var k=new n.V,I=new n.V;function L(e,t,r){for(var a=[],o={},s=0,c=e.length;s<c;s+=3){var u=e[s],l=e[s+1],p=e[s+2],h=new i(u,l,p);E.fromArray(t,3*u),T.fromArray(t,3*l),x.fromArray(t,3*p),I.subVectors(x,T),k.subVectors(E,T),I.cross(k),I.normalize(),h.normal.copy(I),void 0===o[u]&&(o[u]=[]),void 0===o[l]&&(o[l]=[]),void 0===o[p]&&(o[p]=[]),o[u].push(h.normal),o[l].push(h.normal),o[p].push(h.normal),a.push(h)}var f=[];for(s=0,c=a.length;s<c;s++){var d=O(o[(h=a[s]).a],h.normal,r),v=O(o[h.b],h.normal,r),m=O(o[h.c],h.normal,r);E.fromArray(t,3*h.a),T.fromArray(t,3*h.b),x.fromArray(t,3*h.c),f.push(d.x,d.y,d.z),f.push(v.x,v.y,v.z),f.push(m.x,m.y,m.z)}return new n.d(f,3)}function O(e,t,r){var i=new n.V;if(0===r)i.copy(t);else for(var a=0,o=e.length;a<o;a++)e[a].angleTo(t)<r&&i.add(e[a]);return i.normalize()}function C(e){for(var t=[],r=0,i=e.length;r<i;r+=3)t.push(new n.C(e[r],e[r+1],e[r+2]));return t}function M(e,t,r,i,a){for(var o=[],s=!0===a?0:Math.PI,c=0,u=i.length;c<u;c++){var l=0===c?0:r[c-1];l=!0===a?l:s-l;var p=new n.V;p.setFromSphericalCoords(t,l,0),o.push(p)}var h=e.index,f=e.attributes.position,d=new n.c(new Float32Array(3*e.attributes.position.count),3),v=new n.V,m=new n.C;for(c=0;c<h.count;c++){var g,y,E=h.getX(c);v.fromBufferAttribute(f,E);for(var T=1,x=1;x<o.length;x++){y=x;var A=o[g=x-1],b=o[y];if(!0===a){if(v.y<=A.y&&v.y>b.y){T=Math.abs(A.y-v.y)/Math.abs(A.y-b.y);break}}else if(v.y>=A.y&&v.y<b.y){T=Math.abs(A.y-v.y)/Math.abs(A.y-b.y);break}}var w=i[g],R=i[y];m.copy(w).lerp(R,T),d.setXYZ(E,m.r,m.g,m.b)}e.setAttribute("color",d)}var P=new n.j(this.manager);if(P.setPath(this.resourcePath||o).setCrossOrigin(this.crossOrigin),-1===e.indexOf("#VRML V2.0"))throw Error("THREE.VRMLLexer: Version of VRML asset not supported.");return function(e){for(var t=e.nodes,r=new n.ai,i=0,a=t.length;i<a;i++){c(o=t[i])}for(i=0,a=t.length;i<a;i++){var o,s=u(o=t[i]);s instanceof n.U&&r.add(s),"WorldInfo"===o.name&&(r.userData.worldInfo=s)}return r}(function(e){var n=function(){for(var e=f.createToken,t=e({name:"RouteIdentifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*[\.][^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/}),r=e({name:"Identifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/,longer_alt:t}),n=["Anchor","Billboard","Collision","Group","Transform","Inline","LOD","Switch","AudioClip","DirectionalLight","PointLight","Script","Shape","Sound","SpotLight","WorldInfo","CylinderSensor","PlaneSensor","ProximitySensor","SphereSensor","TimeSensor","TouchSensor","VisibilitySensor","Box","Cone","Cylinder","ElevationGrid","Extrusion","IndexedFaceSet","IndexedLineSet","PointSet","Sphere","Color","Coordinate","Normal","TextureCoordinate","Appearance","FontStyle","ImageTexture","Material","MovieTexture","PixelTexture","TextureTransform","ColorInterpolator","CoordinateInterpolator","NormalInterpolator","OrientationInterpolator","PositionInterpolator","ScalarInterpolator","Background","Fog","NavigationInfo","Viewpoint","Text"],i=e({name:"Version",pattern:/#VRML.*/,longer_alt:r}),a=e({name:"NodeName",pattern:new RegExp(n.join("|")),longer_alt:r}),o=e({name:"DEF",pattern:/DEF/,longer_alt:r}),s=e({name:"USE",pattern:/USE/,longer_alt:r}),c=e({name:"ROUTE",pattern:/ROUTE/,longer_alt:r}),u=e({name:"TO",pattern:/TO/,longer_alt:r}),l=e({name:"StringLiteral",pattern:/"(:?[^\\"\n\r]+|\\(:?[bfnrtv"\\/]|u[0-9a-fA-F]{4}))*"/}),p=e({name:"HexLiteral",pattern:/0[xX][0-9a-fA-F]+/}),h=e({name:"NumberLiteral",pattern:/[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/}),d=e({name:"TrueLiteral",pattern:/TRUE/}),v=e({name:"FalseLiteral",pattern:/FALSE/}),m=e({name:"NullLiteral",pattern:/NULL/}),g=e({name:"LSquare",pattern:/\[/}),y=e({name:"RSquare",pattern:/]/}),E=e({name:"LCurly",pattern:/{/}),T=e({name:"RCurly",pattern:/}/}),x=e({name:"Comment",pattern:/#.*/,group:f.Lexer.SKIPPED}),A=[e({name:"WhiteSpace",pattern:/[ ,\s]/,group:f.Lexer.SKIPPED}),a,o,s,c,u,d,v,m,i,r,t,l,p,h,g,y,E,T,x],b={},w=0,R=A.length;w<R;w++){var N=A[w];b[N.name]=N}return{tokens:A,tokenVocabulary:b}}(),i=new t(n.tokens),a=new r(n.tokenVocabulary),o=function(e){function t(){e.call(this),this.validateVisitor()}function r(e,t){var r={type:null,values:[]};if(t.node){r.type="node";for(var n=0,i=t.node.length;n<i;n++){var a=t.node[n];r.values.push(e.visit(a))}}if(t.use){r.type="use";for(n=0,i=t.use.length;n<i;n++){var o=t.use[n];r.values.push(e.visit(o))}}if(t.StringLiteral){r.type="string";for(n=0,i=t.StringLiteral.length;n<i;n++){var s=t.StringLiteral[n];r.values.push(s.image.replace(/'|"/g,""))}}if(t.NumberLiteral){r.type="number";for(n=0,i=t.NumberLiteral.length;n<i;n++){var c=t.NumberLiteral[n];r.values.push(parseFloat(c.image))}}if(t.HexLiteral){r.type="hex";for(n=0,i=t.HexLiteral.length;n<i;n++){var u=t.HexLiteral[n];r.values.push(u.image)}}if(t.TrueLiteral){r.type="boolean";for(n=0,i=t.TrueLiteral.length;n<i;n++){"TRUE"===t.TrueLiteral[n].image&&r.values.push(!0)}}if(t.FalseLiteral){r.type="boolean";for(n=0,i=t.FalseLiteral.length;n<i;n++){"FALSE"===t.FalseLiteral[n].image&&r.values.push(!1)}}return t.NullLiteral&&(r.type="null",t.NullLiteral.forEach((function(){r.values.push(null)}))),r}return t.prototype=Object.assign(Object.create(e.prototype),{constructor:t,vrml:function(e){for(var t={version:this.visit(e.version),nodes:[],routes:[]},r=0,n=e.node.length;r<n;r++){var i=e.node[r];t.nodes.push(this.visit(i))}if(e.route)for(r=0,n=e.route.length;r<n;r++){var a=e.route[r];t.routes.push(this.visit(a))}return t},version:function(e){return e.Version[0].image},node:function(e){var t={name:e.NodeName[0].image,fields:[]};if(e.field)for(var r=0,n=e.field.length;r<n;r++){var i=e.field[r];t.fields.push(this.visit(i))}return e.def&&(t.DEF=this.visit(e.def[0])),t},field:function(e){var t,r={name:e.Identifier[0].image,type:null,values:null};return e.singleFieldValue&&(t=this.visit(e.singleFieldValue[0])),e.multiFieldValue&&(t=this.visit(e.multiFieldValue[0])),r.type=t.type,r.values=t.values,r},def:function(e){return(e.Identifier||e.NodeName)[0].image},use:function(e){return{USE:(e.Identifier||e.NodeName)[0].image}},singleFieldValue:function(e){return r(this,e)},multiFieldValue:function(e){return r(this,e)},route:function(e){return{FROM:e.RouteIdentifier[0].image,TO:e.RouteIdentifier[1].image}}}),new t}(a.getBaseCstVisitorConstructor()),s=i.lex(e);a.input=s.tokens;var c=a.vrml();if(a.errors.length>0)throw console.error(a.errors),Error("THREE.VRMLLoader: Parsing errors detected.");return o.visit(c)}(e))}}),t.prototype={constructor:t,lex:function(e){var t=this.lexer.tokenize(e);if(t.errors.length>0)throw console.error(t.errors),Error("THREE.VRMLLexer: Lexing errors detected.");return t}},r.prototype=Object.create(f.Parser.prototype),r.prototype.constructor=r;var a={INTENSITY:1,INTENSITY_ALPHA:2,RGB:3,RGBA:4};return e}(),v=function(e){n.L.call(this,e),this.littleEndian=!0};v.prototype=Object.assign(Object.create(n.L.prototype),{constructor:v,load:function(e,t,r,i){var a=this,o=new n.F(a.manager);o.setPath(a.path),o.setResponseType("arraybuffer"),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(e,(function(r){try{t(a.parse(r,e))}catch(l){i?i(l):console.error(l),a.manager.itemError(e)}}),r,i)},parse:function(e,t){var r=n.f.decodeText(new Uint8Array(e)),i=function(e){var t={},r=e.search(/[\r\n]DATA\s(\S*)\s/i),n=/[\r\n]DATA\s(\S*)\s/i.exec(e.substr(r-1));if(t.data=n[1],t.headerLen=n[0].length+r,t.str=e.substr(0,t.headerLen),t.str=t.str.replace(/\#.*/gi,""),t.version=/VERSION (.*)/i.exec(t.str),t.fields=/FIELDS (.*)/i.exec(t.str),t.size=/SIZE (.*)/i.exec(t.str),t.type=/TYPE (.*)/i.exec(t.str),t.count=/COUNT (.*)/i.exec(t.str),t.width=/WIDTH (.*)/i.exec(t.str),t.height=/HEIGHT (.*)/i.exec(t.str),t.viewpoint=/VIEWPOINT (.*)/i.exec(t.str),t.points=/POINTS (.*)/i.exec(t.str),null!==t.version&&(t.version=parseFloat(t.version[1])),null!==t.fields&&(t.fields=t.fields[1].split(" ")),null!==t.type&&(t.type=t.type[1].split(" ")),null!==t.width&&(t.width=parseInt(t.width[1])),null!==t.height&&(t.height=parseInt(t.height[1])),null!==t.viewpoint&&(t.viewpoint=t.viewpoint[1]),null!==t.points&&(t.points=parseInt(t.points[1],10)),null===t.points&&(t.points=t.width*t.height),null!==t.size&&(t.size=t.size[1].split(" ").map((function(e){return parseInt(e,10)}))),null!==t.count)t.count=t.count[1].split(" ").map((function(e){return parseInt(e,10)}));else{t.count=[];for(var i=0,a=t.fields.length;i<a;i++)t.count.push(1)}t.offset={};var o=0;for(i=0,a=t.fields.length;i<a;i++)"ascii"===t.data?t.offset[t.fields[i]]=i:(t.offset[t.fields[i]]=o,o+=t.size[i]*t.count[i]);return t.rowSize=o,t}(r),a=[],o=[],s=[];if("ascii"===i.data)for(var c=i.offset,u=r.substr(i.headerLen).split("\n"),l=0,p=u.length;l<p;l++)if(""!==u[l]){var h=u[l].split(" ");if(void 0!==c.x&&(a.push(parseFloat(h[c.x])),a.push(parseFloat(h[c.y])),a.push(parseFloat(h[c.z]))),void 0!==c.rgb){var f=parseFloat(h[c.rgb]),d=f>>16&255,v=f>>8&255,m=f>>0&255;s.push(d/255,v/255,m/255)}void 0!==c.normal_x&&(o.push(parseFloat(h[c.normal_x])),o.push(parseFloat(h[c.normal_y])),o.push(parseFloat(h[c.normal_z])))}if("binary_compressed"===i.data){var g=new Uint32Array(e.slice(i.headerLen,i.headerLen+8)),y=g[0],E=g[1],T=function(e,t){var r,n,i,a=e.length,o=new Uint8Array(t),s=0,c=0;do{if((r=e[s++])<32){if(c+ ++r>t)throw new Error("Output buffer is not large enough");if(s+r>a)throw new Error("Invalid compressed data");do{o[c++]=e[s++]}while(--r)}else{if(n=r>>5,i=c-((31&r)<<8)-1,s>=a)throw new Error("Invalid compressed data");if(7===n&&(n+=e[s++],s>=a))throw new Error("Invalid compressed data");if(i-=e[s++],c+n+2>t)throw new Error("Output buffer is not large enough");if(i<0)throw new Error("Invalid compressed data");if(i>=c)throw new Error("Invalid compressed data");do{o[c++]=o[i++]}while(2+--n)}}while(s<a);return o}(new Uint8Array(e,i.headerLen+8,y),E),x=new DataView(T.buffer);for(c=i.offset,l=0;l<i.points;l++)void 0!==c.x&&(a.push(x.getFloat32(i.points*c.x+i.size[0]*l,this.littleEndian)),a.push(x.getFloat32(i.points*c.y+i.size[1]*l,this.littleEndian)),a.push(x.getFloat32(i.points*c.z+i.size[2]*l,this.littleEndian))),void 0!==c.rgb&&(s.push(x.getUint8(i.points*c.rgb+i.size[3]*l+0)/255),s.push(x.getUint8(i.points*c.rgb+i.size[3]*l+1)/255),s.push(x.getUint8(i.points*c.rgb+i.size[3]*l+2)/255)),void 0!==c.normal_x&&(o.push(x.getFloat32(i.points*c.normal_x+i.size[4]*l,this.littleEndian)),o.push(x.getFloat32(i.points*c.normal_y+i.size[5]*l,this.littleEndian)),o.push(x.getFloat32(i.points*c.normal_z+i.size[6]*l,this.littleEndian)))}if("binary"===i.data){x=new DataView(e,i.headerLen),c=i.offset,l=0;for(var A=0;l<i.points;l++,A+=i.rowSize)void 0!==c.x&&(a.push(x.getFloat32(A+c.x,this.littleEndian)),a.push(x.getFloat32(A+c.y,this.littleEndian)),a.push(x.getFloat32(A+c.z,this.littleEndian))),void 0!==c.rgb&&(s.push(x.getUint8(A+c.rgb+2)/255),s.push(x.getUint8(A+c.rgb+1)/255),s.push(x.getUint8(A+c.rgb+0)/255)),void 0!==c.normal_x&&(o.push(x.getFloat32(A+c.normal_x,this.littleEndian)),o.push(x.getFloat32(A+c.normal_y,this.littleEndian)),o.push(x.getFloat32(A+c.normal_z,this.littleEndian)))}var b=new n.B;a.length>0&&b.setAttribute("position",new n.d(a,3)),o.length>0&&b.setAttribute("normal",new n.d(o,3)),s.length>0&&b.setAttribute("color",new n.d(s,3)),b.computeBoundingSphere();var w=new n.P({size:.005});s.length>0?w.vertexColors=!0:w.color.setHex(16777215*Math.random());var R=new n.z(b,w),N=t.split("").reverse().join("");return N=(N=/([^\/]*)/.exec(N))[1].split("").reverse().join(""),R.name=N,R}});var m=function(e){n.L.call(this,e),this.propertyNameMapping={}};m.prototype=Object.assign(Object.create(n.L.prototype),{constructor:m,load:function(e,t,r,i){var a=this,o=new n.F(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(r){try{t(a.parse(r))}catch(l){i?i(l):console.error(l),a.manager.itemError(e)}}),r,i)},setPropertyNameMapping:function(e){this.propertyNameMapping=e},parse:function(e){function t(e){var t="",r=0,n=/ply([\s\S]*)end_header\r?\n/.exec(e);null!==n&&(t=n[1],r=new Blob([n[0]]).size);var i,a,o,s={comments:[],elements:[],headerLength:r,objInfo:""},c=t.split("\n");function u(e,t){var r={type:e[0]};return"list"===r.type?(r.name=e[3],r.countType=e[1],r.itemType=e[2]):r.name=e[1],r.name in t&&(r.name=t[r.name]),r}for(var l=0;l<c.length;l++){var h=c[l];if(""!==(h=h.trim()))switch(a=(o=h.split(/\s+/)).shift(),h=o.join(" "),a){case"format":s.format=o[0],s.version=o[1];break;case"comment":s.comments.push(h);break;case"element":void 0!==i&&s.elements.push(i),(i={}).name=o[0],i.count=parseInt(o[1]),i.properties=[];break;case"property":i.properties.push(u(o,p.propertyNameMapping));break;case"obj_info":s.objInfo=h;break;default:console.log("unhandled",a,o)}}return void 0!==i&&s.elements.push(i),s}function r(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function i(e,t){for(var n=t.split(/\s+/),i={},a=0;a<e.length;a++)if("list"===e[a].type){for(var o=[],s=r(n.shift(),e[a].countType),c=0;c<s;c++)o.push(r(n.shift(),e[a].itemType));i[e[a].name]=o}else i[e[a].name]=r(n.shift(),e[a].type);return i}function a(e,t){var r,n={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},a="";null!==(r=/end_header\s([\s\S]*)$/.exec(e))&&(a=r[1]);for(var c=a.split("\n"),u=0,l=0,p=0;p<c.length;p++){var h=c[p];if(""!==(h=h.trim())){l>=t.elements[u].count&&(u++,l=0);var f=i(t.elements[u].properties,h);s(n,t.elements[u].name,f),l++}}return o(n)}function o(e){var t=new n.B;return e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new n.d(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new n.d(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new n.d(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new n.d(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed()).setAttribute("uv",new n.d(e.faceVertexUvs,2)),t.computeBoundingSphere(),t}function s(e,t,r){if("vertex"===t)e.vertices.push(r.x,r.y,r.z),"nx"in r&&"ny"in r&&"nz"in r&&e.normals.push(r.nx,r.ny,r.nz),"s"in r&&"t"in r&&e.uvs.push(r.s,r.t),"red"in r&&"green"in r&&"blue"in r&&e.colors.push(r.red/255,r.green/255,r.blue/255);else if("face"===t){var n=r.vertex_indices||r.vertex_index,i=r.texcoord;3===n.length?(e.indices.push(n[0],n[1],n[2]),i&&6===i.length&&(e.faceVertexUvs.push(i[0],i[1]),e.faceVertexUvs.push(i[2],i[3]),e.faceVertexUvs.push(i[4],i[5]))):4===n.length&&(e.indices.push(n[0],n[1],n[3]),e.indices.push(n[1],n[2],n[3]))}}function c(e,t,r,n){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,n),2];case"uint16":case"ushort":return[e.getUint16(t,n),2];case"int32":case"int":return[e.getInt32(t,n),4];case"uint32":case"uint":return[e.getUint32(t,n),4];case"float32":case"float":return[e.getFloat32(t,n),4];case"float64":case"double":return[e.getFloat64(t,n),8]}}function u(e,t,r,n){for(var i,a={},o=0,s=0;s<r.length;s++)if("list"===r[s].type){var u=[],l=(i=c(e,t+o,r[s].countType,n))[0];o+=i[1];for(var p=0;p<l;p++)i=c(e,t+o,r[s].itemType,n),u.push(i[0]),o+=i[1];a[r[s].name]=u}else i=c(e,t+o,r[s].type,n),a[r[s].name]=i[0],o+=i[1];return[a,o]}var l,p=this;if(e instanceof ArrayBuffer){var h=n.f.decodeText(new Uint8Array(e)),f=t(h);l="ascii"===f.format?a(h,f):function(e,t){for(var r,n={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},i="binary_little_endian"===t.format,a=new DataView(e,t.headerLength),c=0,l=0;l<t.elements.length;l++)for(var p=0;p<t.elements[l].count;p++){c+=(r=u(a,c,t.elements[l].properties,i))[1];var h=r[0];s(n,t.elements[l].name,h)}return o(n)}(e,f)}else l=a(e,t(e));return l}});var g={},y=Uint8Array,E=Uint16Array,T=Uint32Array,x=new y([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),A=new y([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),b=new y([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),w=function(e,t){for(var r=new E(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];var i=new T(r[30]);for(n=1;n<30;++n)for(var a=r[n];a<r[n+1];++a)i[a]=a-r[n]<<5|n;return[r,i]},R=w(x,2),N=R[0],_=R[1];N[28]=258,_[258]=28;for(var S=w(A,0),k=S[0],I=S[1],L=new E(32768),O=0;O<32768;++O){var C=(43690&O)>>>1|(21845&O)<<1;C=(61680&(C=(52428&C)>>>2|(13107&C)<<2))>>>4|(3855&C)<<4,L[O]=((65280&C)>>>8|(255&C)<<8)>>>1}var M=function(e,t,r){for(var n=e.length,i=0,a=new E(t);i<n;++i)++a[e[i]-1];var o,s=new E(t);for(i=0;i<t;++i)s[i]=s[i-1]+a[i-1]<<1;if(r){o=new E(1<<t);var c=15-t;for(i=0;i<n;++i)if(e[i])for(var u=i<<4|e[i],l=t-e[i],p=s[e[i]-1]++<<l,h=p|(1<<l)-1;p<=h;++p)o[L[p]>>>c]=u}else for(o=new E(n),i=0;i<n;++i)e[i]&&(o[i]=L[s[e[i]-1]++]>>>15-e[i]);return o},P=new y(288);for(O=0;O<144;++O)P[O]=8;for(O=144;O<256;++O)P[O]=9;for(O=256;O<280;++O)P[O]=7;for(O=280;O<288;++O)P[O]=8;var F=new y(32);for(O=0;O<32;++O)F[O]=5;var D=M(P,9,0),U=M(P,9,1),j=M(F,5,0),V=M(F,5,1),B=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},H=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},G=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},z=function(e){return(e/8|0)+(7&e&&1)},W=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var n=new(e instanceof E?E:e instanceof T?T:y)(r-t);return n.set(e.subarray(t,r)),n},K=function(e,t,r){var n=e.length;if(!n||r&&!r.l&&n<5)return t||new y(0);var i=!t||r,a=!r||r.i;r||(r={}),t||(t=new y(3*n));var o=function(e){var r=t.length;if(e>r){var n=new y(Math.max(2*r,e));n.set(t),t=n}},s=r.f||0,c=r.p||0,u=r.b||0,l=r.l,p=r.d,h=r.m,f=r.n,d=8*n;do{if(!l){r.f=s=H(e,c,1);var v=H(e,c+1,3);if(c+=3,!v){var m=e[(C=z(c)+4)-4]|e[C-3]<<8,g=C+m;if(g>n){if(a)throw"unexpected EOF";break}i&&o(u+m),t.set(e.subarray(C,g),u),r.b=u+=m,r.p=c=8*g;continue}if(1==v)l=U,p=V,h=9,f=5;else{if(2!=v)throw"invalid block type";var E=H(e,c,31)+257,T=H(e,c+10,15)+4,w=E+H(e,c+5,31)+1;c+=14;for(var R=new y(w),_=new y(19),S=0;S<T;++S)_[b[S]]=H(e,c+3*S,7);c+=3*T;var I=B(_),L=(1<<I)-1;if(!a&&c+w*(I+7)>d)break;var O=M(_,I,1);for(S=0;S<w;){var C,P=O[H(e,c,L)];if(c+=15&P,(C=P>>>4)<16)R[S++]=C;else{var F=0,D=0;for(16==C?(D=3+H(e,c,3),c+=2,F=R[S-1]):17==C?(D=3+H(e,c,7),c+=3):18==C&&(D=11+H(e,c,127),c+=7);D--;)R[S++]=F}}var j=R.subarray(0,E),K=R.subarray(E);h=B(j),f=B(K),l=M(j,h,1),p=M(K,f,1)}if(c>d)throw"unexpected EOF"}i&&o(u+131072);for(var X=(1<<h)-1,q=(1<<f)-1,Y=h+f+18;a||c+Y<d;){var Z=(F=l[G(e,c)&X])>>>4;if((c+=15&F)>d)throw"unexpected EOF";if(!F)throw"invalid length/literal";if(Z<256)t[u++]=Z;else{if(256==Z){l=null;break}var $=Z-254;if(Z>264){var J=x[S=Z-257];$=H(e,c,(1<<J)-1)+N[S],c+=J}var Q=p[G(e,c)&q],ee=Q>>>4;if(!Q)throw"invalid distance";c+=15&Q;K=k[ee];if(ee>3){J=A[ee];K+=G(e,c)&(1<<J)-1,c+=J}if(c>d)throw"unexpected EOF";i&&o(u+131072);for(var te=u+$;u<te;u+=4)t[u]=t[u-K],t[u+1]=t[u+1-K],t[u+2]=t[u+2-K],t[u+3]=t[u+3-K];u=te}}r.l=l,r.p=c,r.b=u,l&&(s=1,r.m=h,r.d=p,r.n=f)}while(!s);return u==t.length?t:W(t,0,u)},X=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>>8},q=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16},Y=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var i=r.length,a=r.slice();if(!i)return[re,0];if(1==i){var o=new y(r[0].s+1);return o[r[0].s]=1,[o,1]}r.sort((function(e,t){return e.f-t.f})),r.push({s:-1,f:25001});var s=r[0],c=r[1],u=0,l=1,p=2;for(r[0]={s:-1,f:s.f+c.f,l:s,r:c};l!=i-1;)s=r[r[u].f<r[p].f?u++:p++],c=r[u!=l&&r[u].f<r[p].f?u++:p++],r[l++]={s:-1,f:s.f+c.f,l:s,r:c};var h=a[0].s;for(n=1;n<i;++n)a[n].s>h&&(h=a[n].s);var f=new E(h+1),d=Z(r[l-1],f,0);if(d>t){n=0;var v=0,m=d-t,g=1<<m;for(a.sort((function(e,t){return f[t.s]-f[e.s]||e.f-t.f}));n<i;++n){var T=a[n].s;if(!(f[T]>t))break;v+=g-(1<<d-f[T]),f[T]=t}for(v>>>=m;v>0;){var x=a[n].s;f[x]<t?v-=1<<t-f[x]++-1:++n}for(;n>=0&&v;--n){var A=a[n].s;f[A]==t&&(--f[A],++v)}d=t}return[new y(f),d]},Z=function(e,t,r){return-1==e.s?Math.max(Z(e.l,t,r+1),Z(e.r,t,r+1)):t[e.s]=r},$=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new E(++t),n=0,i=e[0],a=1,o=function(e){r[n++]=e},s=1;s<=t;++s)if(e[s]==i&&s!=t)++a;else{if(!i&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(i),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(i);a=1,i=e[s]}return[r.subarray(0,n),t]},J=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},Q=function(e,t,r){var n=r.length,i=z(t+2);e[i]=255&n,e[i+1]=n>>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var a=0;a<n;++a)e[i+a+4]=r[a];return 8*(i+4+n)},ee=function(e,t,r,n,i,a,o,s,c,u,l){X(t,l++,r),++i[256];for(var p=Y(i,15),h=p[0],f=p[1],d=Y(a,15),v=d[0],m=d[1],g=$(h),y=g[0],T=g[1],w=$(v),R=w[0],N=w[1],_=new E(19),S=0;S<y.length;++S)_[31&y[S]]++;for(S=0;S<R.length;++S)_[31&R[S]]++;for(var k=Y(_,7),I=k[0],L=k[1],O=19;O>4&&!I[b[O-1]];--O);var C,U,V,B,H=u+5<<3,G=J(i,P)+J(a,F)+o,z=J(i,h)+J(a,v)+o+14+3*O+J(_,I)+(2*_[16]+3*_[17]+7*_[18]);if(H<=G&&H<=z)return Q(t,l,e.subarray(c,c+u));if(X(t,l,1+(z<G)),l+=2,z<G){C=M(h,f,0),U=h,V=M(v,m,0),B=v;var W=M(I,L,0);X(t,l,T-257),X(t,l+5,N-1),X(t,l+10,O-4),l+=14;for(S=0;S<O;++S)X(t,l+3*S,I[b[S]]);l+=3*O;for(var K=[y,R],Z=0;Z<2;++Z){var ee=K[Z];for(S=0;S<ee.length;++S){var te=31&ee[S];X(t,l,W[te]),l+=I[te],te>15&&(X(t,l,ee[S]>>>5&127),l+=ee[S]>>>12)}}}else C=D,U=P,V=j,B=F;for(S=0;S<s;++S)if(n[S]>255){te=n[S]>>>18&31;q(t,l,C[te+257]),l+=U[te+257],te>7&&(X(t,l,n[S]>>>23&31),l+=x[te]);var re=31&n[S];q(t,l,V[re]),l+=B[re],re>3&&(q(t,l,n[S]>>>5&8191),l+=A[re])}else q(t,l,C[n[S]]),l+=U[n[S]];return q(t,l,C[256]),l+U[256]},te=new T([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),re=new y(0),ne=function(e,t,r,n,i,a){var o=e.length,s=new y(n+o+5*(1+Math.ceil(o/7e3))+i),c=s.subarray(n,s.length-i),u=0;if(!t||o<8)for(var l=0;l<=o;l+=65535){var p=l+65535;p<o?u=Q(c,u,e.subarray(l,p)):(c[l]=a,u=Q(c,u,e.subarray(l,o)))}else{for(var h=te[t-1],f=h>>>13,d=8191&h,v=(1<<r)-1,m=new E(32768),g=new E(v+1),b=Math.ceil(r/3),w=2*b,R=function(t){return(e[t]^e[t+1]<<b^e[t+2]<<w)&v},N=new T(25e3),S=new E(288),k=new E(32),L=0,O=0,C=(l=0,0),M=0,P=0;l<o;++l){var F=R(l),D=32767&l,U=g[F];if(m[D]=U,g[F]=D,M<=l){var j=o-l;if((L>7e3||C>24576)&&j>423){u=ee(e,c,0,N,S,k,O,C,P,l-P,u),C=L=O=0,P=l;for(var V=0;V<286;++V)S[V]=0;for(V=0;V<30;++V)k[V]=0}var B=2,H=0,G=d,K=D-U&32767;if(j>2&&F==R(l-K))for(var X=Math.min(f,j)-1,q=Math.min(32767,l),Y=Math.min(258,j);K<=q&&--G&&D!=U;){if(e[l+B]==e[l+B-K]){for(var Z=0;Z<Y&&e[l+Z]==e[l+Z-K];++Z);if(Z>B){if(B=Z,H=K,Z>X)break;var $=Math.min(K,Z-2),J=0;for(V=0;V<$;++V){var ne=l-K+V+32768&32767,ie=ne-m[ne]+32768&32767;ie>J&&(J=ie,U=ne)}}}K+=(D=U)-(U=m[D])+32768&32767}if(H){N[C++]=268435456|_[B]<<18|I[H];var ae=31&_[B],oe=31&I[H];O+=x[ae]+A[oe],++S[257+ae],++k[oe],M=l+B,++L}else N[C++]=e[l],++S[e[l]]}}u=ee(e,c,a,N,S,k,O,C,P,l-P,u),!a&&7&u&&(u=Q(c,u+1,re))}return W(s,0,n+z(u)+i)},ie=function(){for(var e=new T(256),t=0;t<256;++t){for(var r=t,n=9;--n;)r=(1&r&&3988292384)^r>>>1;e[t]=r}return e}(),ae=function(){var e=-1;return{p:function(t){for(var r=e,n=0;n<t.length;++n)r=ie[255&r^t[n]]^r>>>8;e=r},d:function(){return~e}}},oe=function(){var e=1,t=0;return{p:function(r){for(var n=e,i=t,a=r.length,o=0;o!=a;){for(var s=Math.min(o+2655,a);o<s;++o)i+=n+=r[o];n=(65535&n)+15*(n>>16),i=(65535&i)+15*(i>>16)}e=n,t=i},d:function(){return((e%=65521)>>>8<<16|(255&(t%=65521))<<8|t>>>8)+2*((255&e)<<23)}}},se=function(e,t,r,n,i){return ne(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,r,n,!i)},ce=function(e,t){var r={};for(var n in e)r[n]=e[n];for(var n in t)r[n]=t[n];return r},ue=function(e,t,r){for(var n=e(),i=e.toString(),a=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<n.length;++o){var s=n[o],c=a[o];if("function"==typeof s){t+=";"+c+"=";var u=s.toString();if(s.prototype)if(-1!=u.indexOf("[native code]")){var l=u.indexOf(" ",8)+1;t+=u.slice(l,u.indexOf("(",l))}else for(var p in t+=u,s.prototype)t+=";"+c+".prototype."+p+"="+s.prototype[p].toString();else t+=u}else r[c]=s}return[t,r]},le=[],pe=function(e,t,r,n){var i;if(!le[r]){for(var a="",o={},s=e.length-1,c=0;c<s;++c)a=(i=ue(e[c],a,o))[0],o=i[1];le[r]=ue(e[s],a,o)}var u=ce({},le[r][1]);return function(e,t,r,n,i){var a=g[t]||(g[t]=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))),o=new Worker(a);return o.onerror=function(e){return i(e.error,null)},o.onmessage=function(e){return i(null,e.data)},o.postMessage(r,n),o}(le[r][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",r,u,function(e){var t=[];for(var r in e)(e[r]instanceof y||e[r]instanceof E||e[r]instanceof T)&&t.push((e[r]=new e[r].constructor(e[r])).buffer);return t}(u),n)},he=function(){return[y,E,T,x,A,b,N,k,U,V,L,M,B,H,G,z,W,K,Be,ye,Ee]},fe=function(){return[y,E,T,x,A,b,_,I,D,P,j,F,L,te,re,M,X,q,Y,Z,$,J,Q,ee,z,W,ne,se,De,ye]},de=function(){return[_e,Ie,Ne,ae,ie]},ve=function(){return[Se,ke]},me=function(){return[Le,Ne,oe]},ge=function(){return[Oe]},ye=function(e){return postMessage(e,[e.buffer])},Ee=function(e){return e&&e.size&&new y(e.size)},Te=function(e,t,r,n,i,a){var o=pe(r,n,i,(function(e,t){o.terminate(),a(e,t)}));return o.postMessage([e,t],t.consume?[e.buffer]:[]),function(){o.terminate()}},xe=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},Ae=function(e,t,r,n,i){var a,o=pe(e,n,i,(function(e,r){e?(o.terminate(),t.ondata.call(t,e)):(r[1]&&o.terminate(),t.ondata.call(t,e,r[0],r[1]))}));o.postMessage(r),t.push=function(e,r){if(a)throw"stream finished";if(!t.ondata)throw"no stream handler";o.postMessage([e,a=r],[e.buffer])},t.terminate=function(){o.terminate()}},be=function(e,t){return e[t]|e[t+1]<<8},we=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+2*(e[t+3]<<23)},Re=function(e,t){return we(e,t)|4294967296*we(e,t)},Ne=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},_e=function(e,t){var r=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&Ne(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),r){e[3]=8;for(var n=0;n<=r.length;++n)e[n+10]=r.charCodeAt(n)}},Se=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],r=10;4&t&&(r+=e[10]|2+(e[11]<<8));for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!e[r++]);return r+(2&t)},ke=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16)+2*(e[t-1]<<23)},Ie=function(e){return 10+(e.filename&&e.filename.length+1||0)},Le=function(e,t){var r=t.level,n=0==r?0:r<6?1:9==r?3:2;e[0]=120,e[1]=n<<6|(n?32-2*n:1)},Oe=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function Ce(e,t){return!t&&"function"==typeof e&&(t=e,e={}),this.ondata=t,e}var Me=function(){function e(e,t){!t&&"function"==typeof e&&(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(se(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}(),Pe=function(e,t){Ae([fe,function(){return[xe,Me]}],this,Ce.call(this,e,t),(function(e){var t=new Me(e.data);onmessage=xe(t)}),6)};function Fe(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return Te(e,t,[fe],(function(e){return ye(De(e.data[0],e.data[1]))}),0,r)}function De(e,t){return se(e,t||{},0,0)}var Ue=function(){function e(e){this.s={},this.p=new y(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,r=new y(t+e.length);r.set(this.p),r.set(e,t),this.p=r},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,r=K(this.p,this.o,this.s);this.ondata(W(r,t,this.s.b),this.d),this.o=W(r,this.s.b-32768),this.s.b=this.o.length,this.p=W(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}(),je=function(e){this.ondata=e,Ae([he,function(){return[xe,Ue]}],this,0,(function(){var e=new Ue;onmessage=xe(e)}),7)};function Ve(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return Te(e,t,[he],(function(e){return ye(Be(e.data[0],Ee(e.data[1])))}),1,r)}function Be(e,t){return K(e,t)}var He=function(){function e(e,t){this.c=ae(),this.l=0,this.v=1,Me.call(this,e,t)}return e.prototype.push=function(e,t){Me.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var r=se(e,this.o,this.v&&Ie(this.o),t&&8,!t);this.v&&(_e(r,this.o),this.v=0),t&&(Ne(r,r.length-8,this.c.d()),Ne(r,r.length-4,this.l)),this.ondata(r,t)},e}(),Ge=function(e,t){Ae([fe,de,function(){return[xe,Me,He]}],this,Ce.call(this,e,t),(function(e){var t=new He(e.data);onmessage=xe(t)}),8)};function ze(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return Te(e,t,[fe,de,function(){return[We]}],(function(e){return ye(We(e.data[0],e.data[1]))}),2,r)}function We(e,t){t||(t={});var r=ae(),n=e.length;r.p(e);var i=se(e,t,Ie(t),8),a=i.length;return _e(i,t),Ne(i,a-8,r.d()),Ne(i,a-4,n),i}var Ke=function(){function e(e){this.v=1,Ue.call(this,e)}return e.prototype.push=function(e,t){if(Ue.prototype.e.call(this,e),this.v){var r=this.p.length>3?Se(this.p):4;if(r>=this.p.length&&!t)return;this.p=this.p.subarray(r),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Ue.prototype.c.call(this,t)},e}(),Xe=function(e){this.ondata=e,Ae([he,ve,function(){return[xe,Ue,Ke]}],this,0,(function(){var e=new Ke;onmessage=xe(e)}),9)};function qe(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return Te(e,t,[he,ve,function(){return[Ye]}],(function(e){return ye(Ye(e.data[0]))}),3,r)}function Ye(e,t){return K(e.subarray(Se(e),-8),t||new y(ke(e)))}var Ze=function(){function e(e,t){this.c=oe(),this.v=1,Me.call(this,e,t)}return e.prototype.push=function(e,t){Me.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var r=se(e,this.o,this.v&&2,t&&4,!t);this.v&&(Le(r,this.o),this.v=0),t&&Ne(r,r.length-4,this.c.d()),this.ondata(r,t)},e}(),$e=function(e,t){Ae([fe,me,function(){return[xe,Me,Ze]}],this,Ce.call(this,e,t),(function(e){var t=new Ze(e.data);onmessage=xe(t)}),10)};function Je(e,t){t||(t={});var r=oe();r.p(e);var n=se(e,t,2,4);return Le(n,t),Ne(n,n.length-4,r.d()),n}var Qe=function(){function e(e){this.v=1,Ue.call(this,e)}return e.prototype.push=function(e,t){if(Ue.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Ue.prototype.c.call(this,t)},e}(),et=function(e){this.ondata=e,Ae([he,ge,function(){return[xe,Ue,Qe]}],this,0,(function(){var e=new Qe;onmessage=xe(e)}),11)};function tt(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return Te(e,t,[he,ge,function(){return[rt]}],(function(e){return ye(rt(e.data[0],Ee(e.data[1])))}),5,r)}function rt(e,t){return K((Oe(e),e.subarray(2,-4)),t)}var nt=function(){function e(e){this.G=Ke,this.I=Ue,this.Z=Qe,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var r=new y(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var n=this,i=function(){n.ondata.apply(n,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(i):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(i):new this.Z(i),this.s.push(this.p,t),this.p=null}}},e}(),it=function(){function e(e){this.G=Xe,this.I=je,this.Z=et,this.ondata=e}return e.prototype.push=function(e,t){nt.prototype.push.call(this,e,t)},e}();var at=function(e,t,r,n){for(var i in e){var a=e[i],o=t+i;a instanceof y?r[o]=[a,n]:Array.isArray(a)?r[o]=[a[0],ce(n,a[1])]:at(a,o+"/",r,n)}},ot="undefined"!=typeof TextEncoder&&new TextEncoder,st="undefined"!=typeof TextDecoder&&new TextDecoder,ct=0;try{st.decode(re,{stream:!0}),ct=1}catch(Kt){}var ut=function(e){for(var t="",r=0;;){var n=e[r++],i=(n>127)+(n>223)+(n>239);if(r+i>e.length)return[t,W(e,r-1)];i?3==i?(n=((15&n)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536,t+=String.fromCharCode(55296|n>>10,56320|1023&n)):t+=1&i?String.fromCharCode((31&n)<<6|63&e[r++]):String.fromCharCode((15&n)<<12|(63&e[r++])<<6|63&e[r++]):t+=String.fromCharCode(n)}},lt=function(){function e(e){this.ondata=e,ct?this.t=new TextDecoder:this.p=re}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t||(t=!1),this.t)return this.ondata(this.t.decode(e,{stream:!t}),t);var r=new y(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length);var n=ut(r),i=n[0],a=n[1];if(t&&a.length)throw"invalid utf-8 data";this.p=a,this.ondata(i,t)},e}(),pt=function(){function e(e){this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";this.ondata(ht(e),t||!1)},e}();function ht(e,t){if(t){for(var r=new y(e.length),n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return r}if(ot)return ot.encode(e);var i=e.length,a=new y(e.length+(e.length>>1)),o=0,s=function(e){a[o++]=e};for(n=0;n<i;++n){if(o+5>a.length){var c=new y(o+8+(i-n<<1));c.set(a),a=c}var u=e.charCodeAt(n);u<128||t?s(u):u<2048?(s(192|u>>>6),s(128|63&u)):u>55295&&u<57344?(s(240|(u=65536+(1047552&u)|1023&e.charCodeAt(++n))>>>18),s(128|u>>>12&63),s(128|u>>>6&63),s(128|63&u)):(s(224|u>>>12),s(128|u>>>6&63),s(128|63&u))}return W(a,0,o)}function ft(e,t){if(t){for(var r="",n=0;n<e.length;n+=16384)r+=String.fromCharCode.apply(null,e.subarray(n,n+16384));return r}if(st)return st.decode(e);var i=ut(e),a=i[0];if(i[1].length)throw"invalid utf-8 data";return a}var dt=function(e){return 1==e?3:e<6?2:9==e?1:0},vt=function(e,t){return t+30+be(e,t+26)+be(e,t+28)},mt=function(e,t,r){var n=be(e,t+28),i=ft(e.subarray(t+46,t+46+n),!(2048&be(e,t+8))),a=t+46+n,o=we(e,t+20),s=r&&4294967295==o?gt(e,a):[o,we(e,t+24),we(e,t+42)],c=s[0],u=s[1],l=s[2];return[be(e,t+10),c,u,i,a+be(e,t+30)+be(e,t+32),l]},gt=function(e,t){for(;1!=be(e,t);t+=4+be(e,t+2));return[Re(e,t+12),Re(e,t+4),Re(e,t+20)]},yt=function(e){var t=0;if(e)for(var r in e){var n=e[r].length;if(n>65535)throw"extra field too long";t+=n+4}return t},Et=function(e,t,r,n,i,a,o,s){var c=n.length,u=r.extra,l=s&&s.length,p=yt(u);Ne(e,t,null!=o?33639248:67324752),t+=4,null!=o&&(e[t++]=20,e[t++]=r.os),e[t]=20,t+=2,e[t++]=r.flag<<1|(null==a&&8),e[t++]=i&&8,e[t++]=255&r.compression,e[t++]=r.compression>>8;var h=new Date(null==r.mtime?Date.now():r.mtime),f=h.getFullYear()-1980;if(f<0||f>119)throw"date not in range 1980-2099";if(Ne(e,t,2*(f<<24)|h.getMonth()+1<<21|h.getDate()<<16|h.getHours()<<11|h.getMinutes()<<5|h.getSeconds()>>>1),t+=4,null!=a&&(Ne(e,t,r.crc),Ne(e,t+4,a),Ne(e,t+8,r.size)),Ne(e,t+12,c),Ne(e,t+14,p),t+=16,null!=o&&(Ne(e,t,l),Ne(e,t+6,r.attrs),Ne(e,t+10,o),t+=14),e.set(n,t),t+=c,p)for(var d in u){var v=u[d],m=v.length;Ne(e,t,+d),Ne(e,t+2,m),e.set(v,t+4),t+=4+m}return l&&(e.set(s,t),t+=l),t},Tt=function(e,t,r,n,i){Ne(e,t,101010256),Ne(e,t+8,r),Ne(e,t+10,r),Ne(e,t+12,n),Ne(e,t+16,i)},xt=function(){function e(e){this.filename=e,this.c=ae(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}(),At=function(){function e(e,t){var r=this;t||(t={}),xt.call(this,e),this.d=new Me(t,(function(e,t){r.ondata(null,e,t)})),this.compression=8,this.flag=dt(t.level)}return e.prototype.process=function(e,t){try{this.d.push(e,t)}catch(l){this.ondata(l,null,t)}},e.prototype.push=function(e,t){xt.prototype.push.call(this,e,t)},e}(),bt=function(){function e(e,t){var r=this;t||(t={}),xt.call(this,e),this.d=new Pe(t,(function(e,t,n){r.ondata(e,t,n)})),this.compression=8,this.flag=dt(t.level),this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){xt.prototype.push.call(this,e,t)},e}(),wt=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var r=ht(e.filename),n=r.length,i=e.comment,a=i&&ht(i),o=n!=e.filename.length||a&&i.length!=a.length,s=n+yt(e.extra)+30;if(n>65535)throw"filename too long";var c=new y(s);Et(c,0,e,r,o);var u=[c],l=function(){for(var e=0,r=u;e<r.length;e++){var n=r[e];t.ondata(null,n,!1)}u=[]},p=this.d;this.d=0;var h=this.u.length,f=ce(e,{f:r,u:o,o:a,t:function(){e.terminate&&e.terminate()},r:function(){if(l(),p){var e=t.u[h+1];e?e.r():t.d=1}p=1}}),d=0;e.ondata=function(r,n,i){if(r)t.ondata(r,n,i),t.terminate();else if(d+=n.length,u.push(n),i){var a=new y(16);Ne(a,0,134695760),Ne(a,4,e.crc),Ne(a,8,d),Ne(a,12,e.size),u.push(a),f.c=d,f.b=s+d+16,f.crc=e.crc,f.size=e.size,p&&f.r(),p=1}else p&&l()},this.u.push(f)},e.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,t=0,r=0,n=0,i=this.u;n<i.length;n++){r+=46+(c=i[n]).f.length+yt(c.extra)+(c.o?c.o.length:0)}for(var a=new y(r+22),o=0,s=this.u;o<s.length;o++){var c=s[o];Et(a,e,c,c.f,c.u,c.c,t,c.o),e+=46+c.f.length+yt(c.extra)+(c.o?c.o.length:0),t+=c.b}Tt(a,e,this.u.length,r,t),this.ondata(null,a,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){t[e].t()}this.d=2},e}();var Rt=function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e}(),Nt=function(){function e(){var e=this;this.i=new Ue((function(t,r){e.ondata(null,t,r)}))}return e.prototype.push=function(e,t){try{this.i.push(e,t)}catch(l){this.ondata(l,e,t)}},e.compression=8,e}(),_t=function(){function e(e,t){var r=this;t<32e4?this.i=new Ue((function(e,t){r.ondata(null,e,t)})):(this.i=new je((function(e,t,n){r.ondata(e,t,n)})),this.terminate=this.i.terminate)}return e.prototype.push=function(e,t){this.i.terminate&&(e=W(e,0)),this.i.push(e,t)},e.compression=8,e}(),St=function(){function e(e){this.onfile=e,this.k=[],this.o={0:Rt},this.p=re}return e.prototype.push=function(e,t){var r=this;if(!this.onfile)throw"no callback";if(this.c>0){var n=Math.min(this.c,e.length),i=e.subarray(0,n);if(this.c-=n,this.d?this.d.push(i,!this.c):this.k[0].push(i),(e=e.subarray(n)).length)return this.push(e,t)}else{var a=0,o=0,s=void 0,c=void 0;this.p.length?e.length?((c=new y(this.p.length+e.length)).set(this.p),c.set(e,this.p.length)):c=this.p:c=e;for(var u=c.length,l=this.c,p=l&&this.d,h=function(){var e,t=we(c,o);if(67324752==t){a=1,s=o,f.d=null,f.c=0;var n=be(c,o+6),i=be(c,o+8),p=2048&n,h=8&n,d=be(c,o+26),v=be(c,o+28);if(u>o+30+d+v){var m=[];f.k.unshift(m),a=2;var g=we(c,o+18),y=we(c,o+22),E=ft(c.subarray(o+30,o+=30+d),!p);4294967295==g?(e=h?[-2]:gt(c,o),g=e[0],y=e[1]):h&&(g=-1),o+=v,f.c=g;var T={name:E,compression:i,start:function(){if(!T.ondata)throw"no callback";if(g){var e=r.o[i];if(!e)throw"unknown compression type "+i;var t=g<0?new e(E):new e(E,g,y);t.ondata=function(e,t,r){T.ondata(e,t,r)};for(var n=0,a=m;n<a.length;n++){var o=a[n];t.push(o,!1)}r.k[0]==m?r.d=t:t.push(re,!0)}else T.ondata(null,re,!0)},terminate:function(){r.k[0]==m&&r.d.terminate&&r.d.terminate()}};g>=0&&(T.size=g,T.originalSize=y),f.onfile(T)}return"break"}if(l){if(134695760==t)return s=o+=12+(-2==l&&8),a=2,f.c=0,"break";if(33639248==t)return s=o-=4,a=2,f.c=0,"break"}},f=this;o<u-4;++o){if("break"===h())break}if(this.p=re,l<0){var d=a?c.subarray(0,s-12-(-2==l&&8)-(134695760==we(c,s-16)&&4)):c.subarray(0,o);p?p.push(d,!!a):this.k[+(2==a)].push(d)}if(2&a)return this.push(c.subarray(o),t);this.p=c.subarray(o)}if(t&&this.c)throw"invalid zip file"},e.prototype.register=function(e){this.o[e.compression]=e},e}();var kt=Object.freeze({__proto__:null,AsyncCompress:Ge,AsyncDecompress:it,AsyncDeflate:Pe,AsyncGunzip:Xe,AsyncGzip:Ge,AsyncInflate:je,AsyncUnzipInflate:_t,AsyncUnzlib:et,AsyncZipDeflate:bt,AsyncZlib:$e,Compress:He,DecodeUTF8:lt,Decompress:nt,Deflate:Me,EncodeUTF8:pt,Gunzip:Ke,Gzip:He,Inflate:Ue,Unzip:St,UnzipInflate:Nt,UnzipPassThrough:Rt,Unzlib:Qe,Zip:wt,ZipDeflate:At,ZipPassThrough:xt,Zlib:Ze,compress:ze,compressSync:We,decompress:function(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return 31==e[0]&&139==e[1]&&8==e[2]?qe(e,t,r):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Ve(e,t,r):tt(e,t,r)},decompressSync:function(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?Ye(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Be(e,t):rt(e,t)},deflate:Fe,deflateSync:De,gunzip:qe,gunzipSync:Ye,gzip:ze,gzipSync:We,inflate:Ve,inflateSync:Be,strFromU8:ft,strToU8:ht,unzip:function(e,t){if("function"!=typeof t)throw"no callback";for(var r=[],n=function(){for(var e=0;e<r.length;++e)r[e]()},i={},a=e.length-22;101010256!=we(e,a);--a)if(!a||e.length-a>65558)return void t("invalid zip file",null);var o=be(e,a+8);o||t(null,{});var s=o,c=we(e,a+16),u=4294967295==c;if(u){if(a=we(e,a-12),101075792!=we(e,a))return void t("invalid zip file",null);s=o=we(e,a+32),c=we(e,a+48)}for(var l=function(a){var s=mt(e,c,u),l=s[0],p=s[1],h=s[2],f=s[3],d=s[4],v=s[5],m=vt(e,v);c=d;var g=function(e,r){e?(n(),t(e,null)):(i[f]=r,--o||t(null,i))};if(l)if(8==l){var E=e.subarray(m,m+p);if(p<32e4)try{g(null,Be(E,new y(h)))}catch(T){g(T,null)}else r.push(Ve(E,{size:h},g))}else g("unknown compression type "+l,null);else g(null,W(e,m,m+p))},p=0;p<s;++p)l();return n},unzipSync:function(e){for(var t={},r=e.length-22;101010256!=we(e,r);--r)if(!r||e.length-r>65558)throw"invalid zip file";var n=be(e,r+8);if(!n)return{};var i=we(e,r+16),a=4294967295==i;if(a){if(r=we(e,r-12),101075792!=we(e,r))throw"invalid zip file";n=we(e,r+32),i=we(e,r+48)}for(var o=0;o<n;++o){var s=mt(e,i,a),c=s[0],u=s[1],l=s[2],p=s[3],h=s[4],f=s[5],d=vt(e,f);if(i=h,c){if(8!=c)throw"unknown compression type "+c;t[p]=Be(e.subarray(d,d+u),new y(l))}else t[p]=W(e,d,d+u)}return t},unzlib:tt,unzlibSync:rt,zip:function(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";var n={};at(e,"",n,t);var i=Object.keys(n),a=i.length,o=0,s=0,c=a,u=new Array(a),l=[],p=function(){for(var e=0;e<l.length;++e)l[e]()},h=function(){var e=new y(s+22),t=o,n=s-o;s=0;for(var i=0;i<c;++i){var a=u[i];try{var l=a.c.length;Et(e,s,a,a.f,a.u,l);var p=30+a.f.length+yt(a.extra),h=s+p;e.set(a.c,h),Et(e,o,a,a.f,a.u,l,s,a.m),o+=16+p+(a.m?a.m.length:0),s=h+l}catch(f){return r(f,null)}}Tt(e,o,u.length,n,t),r(null,e)};a||h();for(var f=function(e){var t=i[e],c=n[t],f=c[0],d=c[1],v=ae(),m=f.length;v.p(f);var g=ht(t),y=g.length,E=d.comment,T=E&&ht(E),x=T&&T.length,A=yt(d.extra),b=0==d.level?0:8,w=function(n,i){if(n)p(),r(n,null);else{var c=i.length;u[e]=ce(d,{size:m,crc:v.d(),c:i,f:g,m:T,u:y!=t.length||T&&E.length!=x,compression:b}),o+=30+y+A+c,s+=76+2*(y+A)+(x||0)+c,--a||h()}};if(y>65535&&w("filename too long",null),b)if(m<16e4)try{w(null,De(f,d))}catch(R){w(R,null)}else l.push(Fe(f,d,w));else w(null,f)},d=0;d<c;++d)f(d);return p},zipSync:function(e,t){t||(t={});var r={},n=[];at(e,"",r,t);var i=0,a=0;for(var o in r){var s=r[o],c=s[0],u=s[1],l=0==u.level?0:8,p=(w=ht(o)).length,h=u.comment,f=h&&ht(h),d=f&&f.length,v=yt(u.extra);if(p>65535)throw"filename too long";var m=l?De(c,u):c,g=m.length,E=ae();E.p(c),n.push(ce(u,{size:c.length,crc:E.d(),c:m,f:w,m:f,u:p!=o.length||f&&h.length!=d,o:i,compression:l})),i+=30+p+v+g,a+=76+2*(p+v)+(d||0)+g}for(var T=new y(a+22),x=i,A=a-i,b=0;b<n.length;++b){var w=n[b];Et(T,w.o,w,w.f,w.u,w.c.length);var R=30+w.f.length+yt(w.extra);T.set(w.c,w.o+R),Et(T,i,w,w.f,w.u,w.c.length,w.o,w.m),i+=16+R+(w.m?w.m.length:0)}return Tt(T,i,n.length,A,x),T},zlib:function(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return Te(e,t,[fe,me,function(){return[Je]}],(function(e){return ye(Je(e.data[0],e.data[1]))}),4,r)},zlibSync:Je,default:null}),It={findSpan:function(e,t,r){var n=r.length-e-1;if(t>=r[n])return n-1;if(t<=r[e])return e;for(var i=e,a=n,o=Math.floor((i+a)/2);t<r[o]||t>=r[o+1];)t<r[o]?a=o:i=o,o=Math.floor((i+a)/2);return o},calcBasisFunctions:function(e,t,r,n){var i=[],a=[],o=[];i[0]=1;for(var s=1;s<=r;++s){a[s]=t-n[e+1-s],o[s]=n[e+s]-t;for(var c=0,u=0;u<s;++u){var l=o[u+1],p=a[s-u],h=i[u]/(l+p);i[u]=c+l*h,c=p*h}i[s]=c}return i},calcBSplinePoint:function(e,t,r,i){for(var a=this.findSpan(e,i,t),o=this.calcBasisFunctions(a,i,e,t),s=new n.aw(0,0,0,0),c=0;c<=e;++c){var u=r[a-e+c],l=o[c],p=u.w*l;s.x+=u.x*p,s.y+=u.y*p,s.z+=u.z*p,s.w+=u.w*l}return s},calcBasisFunctionDerivatives:function(e,t,r,n,i){for(var a=[],o=0;o<=r;++o)a[o]=0;var s=[];for(o=0;o<=n;++o)s[o]=a.slice(0);var c=[];for(o=0;o<=r;++o)c[o]=a.slice(0);c[0][0]=1;for(var u=a.slice(0),l=a.slice(0),p=1;p<=r;++p){u[p]=t-i[e+1-p],l[p]=i[e+p]-t;for(var h=0,f=0;f<p;++f){var d=l[f+1],v=u[p-f];c[p][f]=d+v;var m=c[f][p-1]/c[p][f];c[f][p]=h+d*m,h=v*m}c[p][p]=h}for(p=0;p<=r;++p)s[0][p]=c[p][r];for(f=0;f<=r;++f){var g=0,y=1,E=[];for(o=0;o<=r;++o)E[o]=a.slice(0);E[0][0]=1;for(var T=1;T<=n;++T){var x=0,A=f-T,b=r-T;f>=T&&(E[y][0]=E[g][0]/c[b+1][A],x=E[y][0]*c[A][b]);var w=f-1<=b?T-1:r-f;for(p=A>=-1?1:-A;p<=w;++p)E[y][p]=(E[g][p]-E[g][p-1])/c[b+1][A+p],x+=E[y][p]*c[A+p][b];f<=b&&(E[y][T]=-E[g][T-1]/c[b+1][f],x+=E[y][T]*c[f][b]),s[T][f]=x;p=g;g=y,y=p}}for(f=r,T=1;T<=n;++T){for(p=0;p<=r;++p)s[T][p]*=f;f*=r-T}return s},calcBSplineDerivatives:function(e,t,r,i,a){for(var o=a<e?a:e,s=[],c=this.findSpan(e,i,t),u=this.calcBasisFunctionDerivatives(c,i,e,o,t),l=[],p=0;p<r.length;++p){var h=(d=r[p].clone()).w;d.x*=h,d.y*=h,d.z*=h,l[p]=d}for(var f=0;f<=o;++f){for(var d=l[c-e].clone().multiplyScalar(u[f][0]),v=1;v<=e;++v)d.add(l[c-e+v].clone().multiplyScalar(u[f][v]));s[f]=d}for(f=o+1;f<=a+1;++f)s[f]=new n.aw(0,0,0);return s},calcKoverI:function(e,t){for(var r=1,n=2;n<=e;++n)r*=n;var i=1;for(n=2;n<=t;++n)i*=n;for(n=2;n<=e-t;++n)i*=n;return r/i},calcRationalCurveDerivatives:function(e){for(var t=e.length,r=[],i=[],a=0;a<t;++a){var o=e[a];r[a]=new n.V(o.x,o.y,o.z),i[a]=o.w}for(var s=[],c=0;c<t;++c){var u=r[c].clone();for(a=1;a<=c;++a)u.sub(s[c-a].clone().multiplyScalar(this.calcKoverI(c,a)*i[a]));s[c]=u.divideScalar(i[0])}return s},calcNURBSDerivatives:function(e,t,r,n,i){var a=this.calcBSplineDerivatives(e,t,r,n,i);return this.calcRationalCurveDerivatives(a)},calcSurfacePoint:function(e,t,r,i,a,o,s,c){for(var u=this.findSpan(e,o,r),l=this.findSpan(t,s,i),p=this.calcBasisFunctions(u,o,e,r),h=this.calcBasisFunctions(l,s,t,i),f=[],d=0;d<=t;++d){f[d]=new n.aw(0,0,0,0);for(var v=0;v<=e;++v){var m=a[u-e+v][l-t+d].clone(),g=m.w;m.x*=g,m.y*=g,m.z*=g,f[d].add(m.multiplyScalar(p[v]))}}var y=new n.aw(0,0,0,0);for(d=0;d<=t;++d)y.add(f[d].multiplyScalar(h[d]));y.divideScalar(y.w),c.set(y.x,y.y,y.z)}},Lt=function(e,t,r,i,a){n.ax.call(this),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=a||this.knots.length-1;for(var o=0;o<r.length;++o){var s=r[o];this.controlPoints[o]=new n.aw(s.x,s.y,s.z,s.w)}};(Lt.prototype=Object.create(n.ax.prototype)).constructor=Lt,Lt.prototype.getPoint=function(e,t){var r=t||new n.V,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),a=It.calcBSplinePoint(this.degree,this.knots,this.controlPoints,i);return 1!=a.w&&a.divideScalar(a.w),r.set(a.x,a.y,a.z)},Lt.prototype.getTangent=function(e,t){var r=t||new n.V,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),a=It.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,i,1);return r.copy(a[1]).normalize(),r};var Ot=function(){var e,t,r;function i(e){n.L.call(this,e)}function a(e,t){this.textureLoader=e,this.manager=t}function o(){}function s(){}function c(){}function u(){}function p(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function h(){}function f(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function d(e){return e/46186158e3}i.prototype=Object.assign(Object.create(n.L.prototype),{constructor:i,load:function(e,t,r,i){var a=this,o=""===a.path?n.f.extractUrlBase(e):a.path,s=new n.F(this.manager);s.setPath(a.path),s.setResponseType("arraybuffer"),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(e,(function(r){try{t(a.parse(r,o))}catch(l){i?i(l):console.error(l),a.manager.itemError(e)}}),r,i)},parse:function(t,r){if(function(e){var t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===A(e,0,t.length)}(t))e=(new u).parse(t);else{var i=A(t);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;function n(t){var n=e[t-1];return e=e.slice(r+t),r++,n}for(var i=0;i<t.length;++i){if(n(1)===t[i])return!1}return!0}(i))throw new Error("THREE.FBXLoader: Unknown format.");if(f(i)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+f(i));e=(new c).parse(i)}return new a(new n.j(this.manager).setPath(this.resourcePath||r).setCrossOrigin(this.crossOrigin),this.manager).parse(e)}}),a.prototype={constructor:a,parse:function(){t=this.parseConnections();var e=this.parseImages(),n=this.parseTextures(e),i=this.parseMaterials(n),a=this.parseDeformers(),s=(new o).parse(a);return this.parseScene(a,s,i),r},parseConnections:function(){var t=new Map;"Connections"in e&&e.Connections.connections.forEach((function(e){var r=e[0],n=e[1],i=e[2];t.has(r)||t.set(r,{parents:[],children:[]});var a={ID:n,relationship:i};t.get(r).parents.push(a),t.has(n)||t.set(n,{parents:[],children:[]});var o={ID:r,relationship:i};t.get(n).children.push(o)}));return t},parseImages:function(){var t={},r={};if("Video"in e.Objects){var n=e.Objects.Video;for(var i in n){var a=n[i];if(t[u=parseInt(i)]=a.RelativeFilename||a.Filename,"Content"in a){var o=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,s="string"===typeof a.Content&&""!==a.Content;if(o||s){var c=this.parseImage(n[i]);r[a.RelativeFilename||a.Filename]=c}}}}for(var u in t){var l=t[u];void 0!==r[l]?t[u]=r[l]:t[u]=t[u].split("\\").pop()}return t},parseImage:function(e){var t,r=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"===typeof r)return"data:"+t+";base64,"+r;var a=new Uint8Array(r);return window.URL.createObjectURL(new Blob([a],{type:t}))},parseTextures:function(t){var r=new Map;if("Texture"in e.Objects){var n=e.Objects.Texture;for(var i in n){var a=this.parseTexture(n[i],t);r.set(parseInt(i),a)}}return r},parseTexture:function(e,t){var r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;var i=e.WrapModeU,a=e.WrapModeV,o=void 0!==i?i.value:0,s=void 0!==a?a.value:0;if(r.wrapS=0===o?n.o:n.a5,r.wrapT=0===s?n.o:n.a5,"Scaling"in e){var c=e.Scaling.value;r.repeat.x=c[0],r.repeat.y=c[1]}return r},loadTexture:function(e,r){var i,a,o=this.textureLoader.path,s=t.get(e.id).children;void 0!==s&&s.length>0&&void 0!==r[s[0].ID]&&(0!==(i=r[s[0].ID]).indexOf("blob:")&&0!==i.indexOf("data:")||this.textureLoader.setPath(void 0));var c=e.FileName.slice(-3).toLowerCase();if("tga"===c){var u=this.manager.getHandler(".tga");null===u?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),a=new n.ah):a=u.load(i)}else"psd"===c?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),a=new n.ah):a=this.textureLoader.load(i);return this.textureLoader.setPath(o),a},parseMaterials:function(t){var r=new Map;if("Material"in e.Objects){var n=e.Objects.Material;for(var i in n){var a=this.parseMaterial(n[i],t);null!==a&&r.set(parseInt(i),a)}}return r},parseMaterial:function(e,r){var i=e.id,a=e.attrName,o=e.ShadingModel;if("object"===typeof o&&(o=o.value),!t.has(i))return null;var s,c=this.parseParameters(e,r,i);switch(o.toLowerCase()){case"phong":s=new n.al;break;case"lambert":s=new n.ak;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),s=new n.al}return s.setValues(c),s.name=a,s},parseParameters:function(e,r,i){var a={};e.BumpFactor&&(a.bumpScale=e.BumpFactor.value),e.Diffuse?a.color=(new n.C).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(a.color=(new n.C).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(a.displacementScale=e.DisplacementFactor.value),e.Emissive?a.emissive=(new n.C).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(a.emissive=(new n.C).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(a.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(a.opacity=parseFloat(e.Opacity.value)),a.opacity<1&&(a.transparent=!0),e.ReflectionFactor&&(a.reflectivity=e.ReflectionFactor.value),e.Shininess&&(a.shininess=e.Shininess.value),e.Specular?a.specular=(new n.C).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(a.specular=(new n.C).fromArray(e.SpecularColor.value));var o=this;return t.get(i).children.forEach((function(e){var t=e.relationship;switch(t){case"Bump":a.bumpMap=o.getTexture(r,e.ID);break;case"Maya|TEX_ao_map":a.aoMap=o.getTexture(r,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":a.map=o.getTexture(r,e.ID),a.map.encoding=n.s;break;case"DisplacementColor":a.displacementMap=o.getTexture(r,e.ID);break;case"EmissiveColor":a.emissiveMap=o.getTexture(r,e.ID),a.emissiveMap.encoding=n.s;break;case"NormalMap":case"Maya|TEX_normal_map":a.normalMap=o.getTexture(r,e.ID);break;case"ReflectionColor":a.envMap=o.getTexture(r,e.ID),a.envMap.mapping=n.ay,a.envMap.encoding=n.s;break;case"SpecularColor":a.specularMap=o.getTexture(r,e.ID),a.specularMap.encoding=n.s;break;case"TransparentColor":case"TransparencyFactor":a.alphaMap=o.getTexture(r,e.ID),a.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",t)}})),a},getTexture:function(r,n){return"LayeredTexture"in e.Objects&&n in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=t.get(n).children[0].ID),r.get(n)},parseDeformers:function(){var r={},n={};if("Deformer"in e.Objects){var i=e.Objects.Deformer;for(var a in i){var o=i[a],s=t.get(parseInt(a));if("Skin"===o.attrType){var c=this.parseSkeleton(s,i);c.ID=a,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),c.geometryID=s.parents[0].ID,r[a]=c}else if("BlendShape"===o.attrType){var u={id:a};u.rawTargets=this.parseMorphTargets(s,i),u.id=a,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[a]=u}}}return{skeletons:r,morphTargets:n}},parseSkeleton:function(e,t){var r=[];return e.children.forEach((function(e){var i=t[e.ID];if("Cluster"===i.attrType){var a={ID:e.ID,indices:[],weights:[],transformLink:(new n.W).fromArray(i.TransformLink.a)};"Indexes"in i&&(a.indices=i.Indexes.a,a.weights=i.Weights.a),r.push(a)}})),{rawBones:r,bones:[]}},parseMorphTargets:function(e,r){for(var n=[],i=0;i<e.children.length;i++){var a=e.children[i],o=r[a.ID],s={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;s.geoID=t.get(parseInt(a.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,n.push(s)}return n},parseScene:function(i,a,o){r=new n.G;var c=this.parseModels(i.skeletons,a,o),u=e.Objects.Model,l=this;c.forEach((function(e){var n=u[e.ID];l.setLookAtProperties(e,n),t.get(e.ID).parents.forEach((function(t){var r=c.get(t.ID);void 0!==r&&r.add(e)})),null===e.parent&&r.add(e)})),this.bindSkeleton(i.skeletons,a,c),this.createAmbientLight(),this.setupMorphMaterials(),r.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);var t=E(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));var p=(new s).parse();1===r.children.length&&r.children[0].isGroup&&(r.children[0].animations=p,r=r.children[0]),r.animations=p},parseModels:function(r,i,a){var o=new Map,s=e.Objects.Model;for(var c in s){var u=parseInt(c),l=s[c],p=t.get(u),h=this.buildSkeleton(p,r,u,l.attrName);if(!h){switch(l.attrType){case"Camera":h=this.createCamera(p);break;case"Light":h=this.createLight(p);break;case"Mesh":h=this.createMesh(p,i,a);break;case"NurbsCurve":h=this.createCurve(p,i);break;case"LimbNode":case"Root":h=new n.N;break;case"Null":default:h=new n.G}h.name=l.attrName?n.r.sanitizeNodeName(l.attrName):"",h.ID=u}this.getTransformData(h,l),o.set(u,h)}return o},buildSkeleton:function(e,t,r,i){var a=null;return e.parents.forEach((function(e){for(var o in t){var s=t[o];s.rawBones.forEach((function(t,o){if(t.ID===e.ID){var c=a;(a=new n.N).matrixWorld.copy(t.transformLink),a.name=i?n.r.sanitizeNodeName(i):"",a.ID=r,s.bones[o]=a,null!==c&&a.add(c)}}))}})),a},createCamera:function(t){var r,i;if(t.children.forEach((function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(i=r)})),void 0===i)r=new n.U;else{var a=0;void 0!==i.CameraProjectionType&&1===i.CameraProjectionType.value&&(a=1);var o=1;void 0!==i.NearPlane&&(o=i.NearPlane.value/1e3);var s=1e3;void 0!==i.FarPlane&&(s=i.FarPlane.value/1e3);var c=window.innerWidth,u=window.innerHeight;void 0!==i.AspectWidth&&void 0!==i.AspectHeight&&(c=i.AspectWidth.value,u=i.AspectHeight.value);var l=c/u,p=45;void 0!==i.FieldOfView&&(p=i.FieldOfView.value);var h=i.FocalLength?i.FocalLength.value:null;switch(a){case 0:r=new n.A(p,l,o,s),null!==h&&r.setFocalLength(h);break;case 1:r=new n.O(-c/2,c/2,u/2,-u/2,o,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+a+"."),r=new n.U}}return r},createLight:function(t){var r,i;if(t.children.forEach((function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(i=r)})),void 0===i)r=new n.U;else{var a;a=void 0===i.LightType?0:i.LightType.value;var o=16777215;void 0!==i.Color&&(o=(new n.C).fromArray(i.Color.value));var s=void 0===i.Intensity?1:i.Intensity.value/100;void 0!==i.CastLightOnObject&&0===i.CastLightOnObject.value&&(s=0);var c=0;void 0!==i.FarAttenuationEnd&&(c=void 0!==i.EnableFarAttenuation&&0===i.EnableFarAttenuation.value?0:i.FarAttenuationEnd.value);switch(a){case 0:r=new n.Z(o,s,c,1);break;case 1:r=new n._(o,s);break;case 2:var u=Math.PI/3;void 0!==i.InnerAngle&&(u=n.H.degToRad(i.InnerAngle.value));var l=0;void 0!==i.OuterAngle&&(l=n.H.degToRad(i.OuterAngle.value),l=Math.max(l,1)),r=new n.Y(o,s,c,u,l,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),r=new n.Z(o,s)}void 0!==i.CastShadows&&1===i.CastShadows.value&&(r.castShadow=!0)}return r},createMesh:function(e,t,r){var i,a=null,o=null,s=[];return e.children.forEach((function(e){t.has(e.ID)&&(a=t.get(e.ID)),r.has(e.ID)&&s.push(r.get(e.ID))})),s.length>1?o=s:s.length>0?o=s[0]:(o=new n.al({color:13421772}),s.push(o)),"color"in a.attributes&&s.forEach((function(e){e.vertexColors=!0})),a.FBX_Deformer?(s.forEach((function(e){e.skinning=!0})),(i=new n.t(a,o)).normalizeSkinWeights()):i=new n.v(a,o),i},createCurve:function(e,t){var r=e.children.reduce((function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e}),null),i=new n.q({color:3342591,linewidth:1});return new n.x(r,i)},getTransformData:function(e,t){var r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?T(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r},setLookAtProperties:function(i,a){"LookAtProperty"in a&&t.get(i.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){var a=e.Objects.Model[t.ID];if("Lcl_Translation"in a){var o=a.Lcl_Translation.value;void 0!==i.target?(i.target.position.fromArray(o),r.add(i.target)):i.lookAt((new n.V).fromArray(o))}}}))},bindSkeleton:function(e,r,i){var a=this.parsePoseNodes();for(var o in e){var s=e[o];t.get(parseInt(s.ID)).parents.forEach((function(e){if(r.has(e.ID)){var o=e.ID;t.get(o).parents.forEach((function(e){i.has(e.ID)&&i.get(e.ID).bind(new n.X(s.bones),a[e.ID])}))}}))}},parsePoseNodes:function(){var t={};if("Pose"in e.Objects){var r=e.Objects.Pose;for(var i in r)if("BindPose"===r[i].attrType){var a=r[i].PoseNode;Array.isArray(a)?a.forEach((function(e){t[e.Node]=(new n.W).fromArray(e.Matrix.a)})):t[a.Node]=(new n.W).fromArray(a.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,i=t[0],a=t[1],o=t[2];if(0!==i||0!==a||0!==o){var s=new n.C(i,a,o);r.add(new n.am(s,1))}}},setupMorphMaterials:function(){var e=this;r.traverse((function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach((function(r,n){e.setupMorphMaterial(t,r,n)})):e.setupMorphMaterial(t,t.material))}))},setupMorphMaterial:function(e,t,n){var i=e.uuid,a=t.uuid,o=!1;if(r.traverse((function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(t){t.uuid===a&&e.uuid!==i&&(o=!0)})):e.material.uuid===a&&e.uuid!==i&&(o=!0))})),!0===o){var s=t.clone();s.morphTargets=!0,void 0===n?e.material=s:e.material[n]=s}else t.morphTargets=!0}},o.prototype={constructor:o,parse:function(r){var n=new Map;if("Geometry"in e.Objects){var i=e.Objects.Geometry;for(var a in i){var o=t.get(parseInt(a)),s=this.parseGeometry(o,i[a],r);n.set(parseInt(a),s)}}return n},parseGeometry:function(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(t,r,n){var i=n.skeletons,a=[],o=t.parents.map((function(t){return e.Objects.Model[t.ID]}));if(0!==o.length){var s=t.children.reduce((function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e}),null);t.children.forEach((function(e){void 0!==n.morphTargets[e.ID]&&a.push(n.morphTargets[e.ID])}));var c=o[0],u={};"RotationOrder"in c&&(u.eulerOrder=T(c.RotationOrder.value)),"InheritType"in c&&(u.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(u.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(u.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(u.scale=c.GeometricScaling.value);var l=E(u);return this.genGeometry(r,s,a,l)}},genGeometry:function(e,t,r,i){var a=new n.B;e.attrName&&(a.name=e.attrName);var o=this.parseGeoNode(e,t),s=this.genBuffers(o),c=new n.d(s.vertex,3);if(c.applyMatrix4(i),a.setAttribute("position",c),s.colors.length>0&&a.setAttribute("color",new n.d(s.colors,3)),t&&(a.setAttribute("skinIndex",new n.az(s.weightsIndices,4)),a.setAttribute("skinWeight",new n.d(s.vertexWeights,4)),a.FBX_Deformer=t),s.normal.length>0){var u=(new n.aA).getNormalMatrix(i),l=new n.d(s.normal,3);l.applyNormalMatrix(u),a.setAttribute("normal",l)}if(s.uvs.forEach((function(e,t){var r="uv"+(t+1).toString();0===t&&(r="uv"),a.setAttribute(r,new n.d(s.uvs[t],2))})),o.material&&"AllSame"!==o.material.mappingType){var p=s.materialIndex[0],h=0;if(s.materialIndex.forEach((function(e,t){e!==p&&(a.addGroup(h,t-h,p),p=e,h=t)})),a.groups.length>0){var f=a.groups[a.groups.length-1],d=f.start+f.count;d!==s.materialIndex.length&&a.addGroup(d,s.materialIndex.length-d,p)}0===a.groups.length&&a.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(a,e,r,i),a},parseGeoNode:function(e,t){var r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];for(var n=0;e.LayerElementUV[n];)e.LayerElementUV[n].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[n])),n++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(n,i){void 0===r.weightTable[n]&&(r.weightTable[n]=[]),r.weightTable[n].push({id:t,weight:e.weights[i]})}))}))),r},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},r=0,n=0,i=!1,a=[],o=[],s=[],c=[],u=[],l=[],p=this;return e.vertexIndices.forEach((function(h,f){var d=!1;h<0&&(h^=-1,d=!0);var v=[],g=[];if(a.push(3*h,3*h+1,3*h+2),e.color){var y=m(f,r,h,e.color);s.push(y[0],y[1],y[2])}if(e.skeleton){if(void 0!==e.weightTable[h]&&e.weightTable[h].forEach((function(e){g.push(e.weight),v.push(e.id)})),g.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);var E=[0,0,0,0],T=[0,0,0,0];g.forEach((function(e,t){var r=e,n=v[t];T.forEach((function(e,t,i){if(r>e){i[t]=r,r=e;var a=E[t];E[t]=n,n=a}}))})),v=E,g=T}for(;g.length<4;)g.push(0),v.push(0);for(var x=0;x<4;++x)u.push(g[x]),l.push(v[x])}if(e.normal){y=m(f,r,h,e.normal);o.push(y[0],y[1],y[2])}if(e.material&&"AllSame"!==e.material.mappingType)var A=m(f,r,h,e.material)[0];e.uv&&e.uv.forEach((function(e,t){var n=m(f,r,h,e);void 0===c[t]&&(c[t]=[]),c[t].push(n[0]),c[t].push(n[1])})),n++,d&&(p.genFace(t,e,a,A,o,s,c,u,l,n),r++,n=0,a=[],o=[],s=[],c=[],u=[],l=[])})),t},genFace:function(e,t,r,n,i,a,o,s,c,u){for(var l=2;l<u;l++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[3*(l-1)]]),e.vertex.push(t.vertexPositions[r[3*(l-1)+1]]),e.vertex.push(t.vertexPositions[r[3*(l-1)+2]]),e.vertex.push(t.vertexPositions[r[3*l]]),e.vertex.push(t.vertexPositions[r[3*l+1]]),e.vertex.push(t.vertexPositions[r[3*l+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(l-1)]),e.vertexWeights.push(s[4*(l-1)+1]),e.vertexWeights.push(s[4*(l-1)+2]),e.vertexWeights.push(s[4*(l-1)+3]),e.vertexWeights.push(s[4*l]),e.vertexWeights.push(s[4*l+1]),e.vertexWeights.push(s[4*l+2]),e.vertexWeights.push(s[4*l+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[4*(l-1)]),e.weightsIndices.push(c[4*(l-1)+1]),e.weightsIndices.push(c[4*(l-1)+2]),e.weightsIndices.push(c[4*(l-1)+3]),e.weightsIndices.push(c[4*l]),e.weightsIndices.push(c[4*l+1]),e.weightsIndices.push(c[4*l+2]),e.weightsIndices.push(c[4*l+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[3*(l-1)]),e.colors.push(a[3*(l-1)+1]),e.colors.push(a[3*(l-1)+2]),e.colors.push(a[3*l]),e.colors.push(a[3*l+1]),e.colors.push(a[3*l+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[3*(l-1)]),e.normal.push(i[3*(l-1)+1]),e.normal.push(i[3*(l-1)+2]),e.normal.push(i[3*l]),e.normal.push(i[3*l+1]),e.normal.push(i[3*l+2])),t.uv&&t.uv.forEach((function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(o[r][0]),e.uvs[r].push(o[r][1]),e.uvs[r].push(o[r][2*(l-1)]),e.uvs[r].push(o[r][2*(l-1)+1]),e.uvs[r].push(o[r][2*l]),e.uvs[r].push(o[r][2*l+1])}))},addMorphTargets:function(t,r,n,i){if(0!==n.length){t.morphTargetsRelative=!0,t.morphAttributes.position=[];var a=this;n.forEach((function(n){n.rawTargets.forEach((function(n){var o=e.Objects.Geometry[n.geoID];void 0!==o&&a.genMorphGeometry(t,r,o,i,n.name)}))}))}},genMorphGeometry:function(e,t,r,i,a){for(var o=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==r.Vertices?r.Vertices.a:[],c=void 0!==r.Indexes?r.Indexes.a:[],u=3*e.attributes.position.count,l=new Float32Array(u),p=0;p<c.length;p++){var h=3*c[p];l[h]=s[3*p],l[h+1]=s[3*p+1],l[h+2]=s[3*p+2]}var f={vertexIndices:o,vertexPositions:l},d=this.genBuffers(f),v=new n.d(d.vertex,3);v.name=a||r.attrName,v.applyMatrix4(i),e.morphAttributes.position.push(v)},parseNormals:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Normals.a,i=[];return"IndexToDirect"===r&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:i,mappingType:t,referenceType:r}},parseUVs:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.UV.a,i=[];return"IndexToDirect"===r&&(i=e.UVIndex.a),{dataSize:2,buffer:n,indices:i,mappingType:t,referenceType:r}},parseVertexColors:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Colors.a,i=[];return"IndexToDirect"===r&&(i=e.ColorIndex.a),{dataSize:4,buffer:n,indices:i,mappingType:t,referenceType:r}},parseMaterialIndices:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};for(var n=e.Materials.a,i=[],a=0;a<n.length;++a)i.push(a);return{dataSize:1,buffer:n,indices:i,mappingType:t,referenceType:r}},parseNurbsGeometry:function(e){if(void 0===Lt)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new n.B;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new n.B;for(var r,i,a=t-1,o=e.KnotVector.a,s=[],c=e.Points.a,u=0,l=c.length;u<l;u+=4)s.push((new n.aw).fromArray(c,u));if("Closed"===e.Form)s.push(s[0]);else if("Periodic"===e.Form){r=a,i=o.length-1-r;for(u=0;u<a;++u)s.push(s[u])}var p=new Lt(a,o,s,r,i).getPoints(7*s.length),h=new Float32Array(3*p.length);p.forEach((function(e,t){e.toArray(h,3*t)}));var f=new n.B;return f.setAttribute("position",new n.c(h,3)),f}},s.prototype={constructor:s,parse:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var r in t){var n=t[r],i=this.addClip(n);e.push(i)}return e},parseClips:function(){if(void 0!==e.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var r=this.parseAnimationLayers(t);return this.parseAnimStacks(r)}},parseAnimationCurveNodes:function(){var t=e.Objects.AnimationCurveNode,r=new Map;for(var n in t){var i=t[n];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){var a={id:i.id,attr:i.attrName,curves:{}};r.set(a.id,a)}}return r},parseAnimationCurves:function(r){var n=e.Objects.AnimationCurve;for(var i in n){var a={id:n[i].id,times:n[i].KeyTime.a.map(d),values:n[i].KeyValueFloat.a},o=t.get(a.id);if(void 0!==o){var s=o.parents[0].ID,c=o.parents[0].relationship;c.match(/X/)?r.get(s).curves.x=a:c.match(/Y/)?r.get(s).curves.y=a:c.match(/Z/)?r.get(s).curves.z=a:c.match(/d|DeformPercent/)&&r.has(s)&&(r.get(s).curves.morph=a)}}},parseAnimationLayers:function(i){var a=e.Objects.AnimationLayer,o=new Map;for(var s in a){var c=[],u=t.get(parseInt(s));if(void 0!==u)u.children.forEach((function(a,o){if(i.has(a.ID)){var s=i.get(a.ID);if(void 0!==s.curves.x||void 0!==s.curves.y||void 0!==s.curves.z){if(void 0===c[o])if(void 0!==(d=t.get(a.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID)){if(void 0===(l=e.Objects.Model[d.toString()]))return void console.warn("THREE.FBXLoader: Encountered a unused curve.",a);var u={modelName:l.attrName?n.r.sanitizeNodeName(l.attrName):"",ID:l.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};r.traverse((function(e){e.ID===l.id&&(u.transform=e.matrix,e.userData.transformData&&(u.eulerOrder=e.userData.transformData.eulerOrder))})),u.transform||(u.transform=new n.W),"PreRotation"in l&&(u.preRotation=l.PreRotation.value),"PostRotation"in l&&(u.postRotation=l.PostRotation.value),c[o]=u}c[o]&&(c[o][s.attr]=s)}else if(void 0!==s.curves.morph){if(void 0===c[o]){var l,p=t.get(a.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,h=t.get(p).parents[0].ID,f=t.get(h).parents[0].ID,d=t.get(f).parents[0].ID;u={modelName:(l=e.Objects.Model[d]).attrName?n.r.sanitizeNodeName(l.attrName):"",morphName:e.Objects.Deformer[p].attrName};c[o]=u}c[o][s.attr]=s}}})),o.set(parseInt(s),c)}return o},parseAnimStacks:function(r){var n=e.Objects.AnimationStack,i={};for(var a in n){var o=t.get(parseInt(a)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=r.get(o[0].ID);i[a]={name:n[a].attrName,layer:s}}return i},addClip:function(e){var t=[],r=this;return e.layer.forEach((function(e){t=t.concat(r.generateTracks(e))})),new n.K(e.name,-1,t)},generateTracks:function(e){var t=[],r=new n.V,i=new n.Q,a=new n.V;if(e.transform&&e.transform.decompose(r,i,a),r=r.toArray(),i=(new n.aj).setFromQuaternion(i,e.eulerOrder).toArray(),a=a.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var o=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==o&&t.push(o)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var s=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);void 0!==s&&t.push(s)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var c=this.generateVectorTrack(e.modelName,e.S.curves,a,"scale");void 0!==c&&t.push(c)}if(void 0!==e.DeformPercent){var u=this.generateMorphTrack(e);void 0!==u&&t.push(u)}return t},generateVectorTrack:function(e,t,r,i){var a=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(a,t,r);return new n.ac(e+"."+i,a,o)},generateRotationTrack:function(e,t,r,i,a,o){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(n.H.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(n.H.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(n.H.degToRad));var s=this.getTimesForAllAxes(t),c=this.getKeyframeTrackValues(s,t,r);void 0!==i&&((i=i.map(n.H.degToRad)).push(o),i=(new n.aj).fromArray(i),i=(new n.Q).setFromEuler(i)),void 0!==a&&((a=a.map(n.H.degToRad)).push(o),a=(new n.aj).fromArray(a),a=(new n.Q).setFromEuler(a).invert());for(var u=new n.Q,l=new n.aj,p=[],h=0;h<c.length;h+=3)l.set(c[h],c[h+1],c[h+2],o),u.setFromEuler(l),void 0!==i&&u.premultiply(i),void 0!==a&&u.multiply(a),u.toArray(p,h/3*4);return new n.ad(e+".quaternion",s,p)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,i=t.values.map((function(e){return e/100})),a=r.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new n.ae(e.modelName+".morphTargetInfluences["+a+"]",t.times,i)},getTimesForAllAxes:function(e){var t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),(t=t.sort((function(e,t){return e-t}))).length>1){for(var r=1,n=t[0],i=1;i<t.length;i++){var a=t[i];a!==n&&(t[r]=a,n=a,r++)}t=t.slice(0,r)}return t},getKeyframeTrackValues:function(e,t,r){var n=r,i=[],a=-1,o=-1,s=-1;return e.forEach((function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==a){var r=t.x.values[a];i.push(r),n[0]=r}else i.push(n[0]);if(-1!==o){var c=t.y.values[o];i.push(c),n[1]=c}else i.push(n[1]);if(-1!==s){var u=t.z.values[s];i.push(u),n[2]=u}else i.push(n[2])})),i},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var r=e.values[t-1],n=e.values[t]-r,i=Math.abs(n);if(i>=180){for(var a=i/180,o=n/a,s=r+o,c=e.times[t-1],u=(e.times[t]-c)/a,l=c+u,p=[],h=[];l<e.times[t];)p.push(l),l+=u,h.push(s),s+=o;e.times=b(e.times,t,p),e.values=b(e.values,t,h)}}}},c.prototype={constructor:c,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new h,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,r=e.split(/[\r\n]+/);return r.forEach((function(e,n){var i=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(!i&&!a){var o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):s?t.parseNodeProperty(e,s,r[++n]):c?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}})),this.allNodes},parseNodeBegin:function(e,t){var r=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:r},a=this.parseNodeAttr(n),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,i):r in o?("PoseNode"===r?o.PoseNode.push(i):void 0!==o[r].id&&(o[r]={},o[r][o[r].id]=o[r]),""!==a.id&&(o[r][a.id]=i)):"number"===typeof a.id?(o[r]={},o[r][a.id]=i):"Properties70"!==r&&(o[r]="PoseNode"===r?[i]:i),"number"===typeof a.id&&(i.id=a.id),""!==a.name&&(i.attrName=a.name),""!==a.type&&(i.attrType=a.type),this.pushStack(i)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var r="",n="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r,type:n}},parseNodeProperty:function(e,t,r){var n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===i&&(i=r.replace(/"/g,"").replace(/,$/,"").trim());var a=this.getCurrentNode();if("Properties70"!==a.name){if("C"===n){var o=i.split(",").slice(1),s=parseInt(o[0]),c=parseInt(o[1]),u=i.split(",").slice(3);n="connections",function(e,t){for(var r=0,n=e.length,i=t.length;r<i;r++,n++)e[n]=t[r]}(i=[s,c],u=u.map((function(e){return e.trim().replace(/^"/,"")}))),void 0===a[n]&&(a[n]=[])}"Node"===n&&(a.id=i),n in a&&Array.isArray(a[n])?a[n].push(i):"a"!==n?a[n]=i:a.a=i,this.setCurrentProp(a,n),"a"===n&&","!==i.slice(-1)&&(a.a=x(i))}else this.parseNodeSpecialProperty(e,n,i)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=x(t.a))},parseNodeSpecialProperty:function(e,t,r){var n=r.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=n[0],a=n[1],o=n[2],s=n[3],c=n[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=x(c)}this.getPrevNode()[i]={type:a,type2:o,flag:s,value:c},this.setCurrentProp(this.getPrevNode(),i)}},u.prototype={constructor:u,parse:function(e){var t=new p(e);t.skip(23);var r=t.getUint32();if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);for(var n=new h;!this.endOfContent(t);){var i=this.parseNode(t,r);null!==i&&n.add(i.name,i)}return n},endOfContent:function(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var r={},n=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();var a=e.getUint8(),o=e.getString(a);if(0===n)return null;for(var s=[],c=0;c<i;c++)s.push(this.parseProperty(e));var u=s.length>0?s[0]:"",l=s.length>1?s[1]:"",p=s.length>2?s[2]:"";for(r.singleProperty=1===i&&e.getOffset()===n;n>e.getOffset();){var h=this.parseNode(e,t);null!==h&&this.parseSubNode(o,r,h)}return r.propertyList=s,"number"===typeof u&&(r.id=u),""!==l&&(r.attrName=l),""!==p&&(r.attrType=p),""!==o&&(r.name=o),r},parseSubNode:function(e,t,r){if(!0===r.singleProperty){var n=r.propertyList[0];Array.isArray(n)?(t[r.name]=r,r.a=n):t[r.name]=n}else if("Connections"===e&&"C"===r.name){var i=[];r.propertyList.forEach((function(e,t){0!==t&&i.push(e)})),void 0===t.connections&&(t.connections=[]),t.connections.push(i)}else if("Properties70"===r.name){Object.keys(r).forEach((function(e){t[e]=r[e]}))}else if("Properties70"===e&&"P"===r.name){var a,o=r.propertyList[0],s=r.propertyList[1],c=r.propertyList[2],u=r.propertyList[3];0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),a="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[o]={type:s,type2:c,flag:u,value:a}}else void 0===t[r.name]?"number"===typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var r=e.getUint32();return e.getArrayBuffer(r);case"S":r=e.getUint32();return e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var n=e.getUint32(),i=e.getUint32(),a=e.getUint32();if(0===i)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}"undefined"===typeof kt&&console.error("THREE.FBXLoader: External library fflate.min.js required.");var o=new p(rt(new Uint8Array(e.getArrayBuffer(a))).buffer);switch(t){case"b":case"c":return o.getBooleanArray(n);case"d":return o.getFloat64Array(n);case"f":return o.getFloat32Array(n);case"i":return o.getInt32Array(n);case"l":return o.getInt64Array(n)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},p.prototype={constructor:p,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1===(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],r=0;r<e;r++)t[r]=this.getUint8();var i=t.indexOf(0);return i>=0&&(t=t.slice(0,i)),n.f.decodeText(new Uint8Array(t))}},h.prototype={constructor:h,add:function(e,t){this[e]=t}};var v=[];function m(e,t,r,n){var i;switch(n.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=r;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(i=n.indices[i]);var a=i*n.dataSize,o=a+n.dataSize;return function(e,t,r,n){for(var i=r,a=0;i<n;i++,a++)e[a]=t[i];return e}(v,n.buffer,a,o)}var g=new n.aj,y=new n.V;function E(e){var t,r=new n.W,i=new n.W,a=new n.W,o=new n.W,s=new n.W,c=new n.W,u=new n.W,l=new n.W,p=new n.W,h=new n.W,f=new n.W,d=new n.W,v=e.inheritType?e.inheritType:0;(e.translation&&r.setPosition(y.fromArray(e.translation)),e.preRotation)&&((t=e.preRotation.map(n.H.degToRad)).push(e.eulerOrder),i.makeRotationFromEuler(g.fromArray(t)));e.rotation&&((t=e.rotation.map(n.H.degToRad)).push(e.eulerOrder),a.makeRotationFromEuler(g.fromArray(t)));e.postRotation&&((t=e.postRotation.map(n.H.degToRad)).push(e.eulerOrder),o.makeRotationFromEuler(g.fromArray(t)),o.invert());e.scale&&s.scale(y.fromArray(e.scale)),e.scalingOffset&&u.setPosition(y.fromArray(e.scalingOffset)),e.scalingPivot&&c.setPosition(y.fromArray(e.scalingPivot)),e.rotationOffset&&l.setPosition(y.fromArray(e.rotationOffset)),e.rotationPivot&&p.setPosition(y.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(f.copy(e.parentMatrix),h.copy(e.parentMatrixWorld));var m=(new n.W).copy(i).multiply(a).multiply(o),E=new n.W;E.extractRotation(h);var T=new n.W;T.copyPosition(h);var x=new n.W,A=(new n.W).copy(T).invert().multiply(h);x.copy(E).invert().multiply(A);var b=s,w=new n.W;if(0===v)w.copy(E).multiply(m).multiply(x).multiply(b);else if(1===v)w.copy(E).multiply(x).multiply(m).multiply(b);else{var R=(new n.W).scale((new n.V).setFromMatrixScale(f)),N=(new n.W).copy(R).invert(),_=(new n.W).copy(x).multiply(N);w.copy(E).multiply(m).multiply(_).multiply(b)}var S=new n.W;S.copy(p).invert();var k=new n.W;k.copy(c).invert();var I=new n.W;I.copy(r).multiply(l).multiply(p).multiply(i).multiply(a).multiply(o).multiply(S).multiply(u).multiply(c).multiply(s).multiply(k);var L=(new n.W).copyPosition(I),O=(new n.W).copy(h).multiply(L);return d.copyPosition(O),(I=(new n.W).copy(d).multiply(w)).premultiply(h.invert()),I}function T(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function x(e){return e.split(",").map((function(e){return parseFloat(e)}))}function A(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),n.f.decodeText(new Uint8Array(e,t,r))}function b(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}return i}(),Ct=function(e){n.L.call(this,e),this.defaultDPI=90,this.defaultUnit="px"};Ct.prototype=Object.assign(Object.create(n.L.prototype),{constructor:Ct,load:function(e,t,r,i){var a=this,o=new n.F(a.manager);o.setPath(a.path),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(e,(function(r){try{t(a.parse(r))}catch(l){i?i(l):console.error(l),a.manager.itemError(e)}}),r,i)},parse:function(e){var t=this;function r(e,t,r,n,a,o,s,c){if(0!=t&&0!=r){n=n*Math.PI/180,t=Math.abs(t),r=Math.abs(r);var u=(s.x-c.x)/2,l=(s.y-c.y)/2,p=Math.cos(n)*u+Math.sin(n)*l,h=-Math.sin(n)*u+Math.cos(n)*l,f=t*t,d=r*r,v=p*p,m=h*h,g=v/f+m/d;if(g>1){var y=Math.sqrt(g);f=(t*=y)*t,d=(r*=y)*r}var E=f*m+d*v,T=(f*d-E)/E,x=Math.sqrt(Math.max(0,T));a===o&&(x=-x);var A=x*t*h/r,b=-x*r*p/t,w=Math.cos(n)*A-Math.sin(n)*b+(s.x+c.x)/2,R=Math.sin(n)*A+Math.cos(n)*b+(s.y+c.y)/2,N=i(1,0,(p-A)/t,(h-b)/r),_=i((p-A)/t,(h-b)/r,(-p-A)/t,(-h-b)/r)%(2*Math.PI);e.currentPath.absellipse(w,R,t,r,N,N+_,0===o,n)}else e.lineTo(c.x,c.y)}function i(e,t,r,n){var i=e*r+t*n,a=Math.sqrt(e*e+t*t)*Math.sqrt(r*r+n*n),o=Math.acos(Math.max(-1,Math.min(1,i/a)));return e*n-t*r<0&&(o=-o),o}function a(e,t){t=Object.assign({},t);var r={};if(e.hasAttribute("class"))for(var n=e.getAttribute("class").split(/\s/).filter(Boolean).map((e=>e.trim())),i=0;i<n.length;i++)r=Object.assign(r,d["."+n[i]]);function a(n,i,a){void 0===a&&(a=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(n)&&(t[i]=a(e.getAttribute(n))),r[n]&&(t[i]=a(r[n])),e.style&&""!==e.style[n]&&(t[i]=a(e.style[n]))}function o(e){return Math.max(0,Math.min(1,l(e)))}function s(e){return Math.max(0,l(e))}return e.hasAttribute("id")&&(r=Object.assign(r,d["#"+e.getAttribute("id")])),a("fill","fill"),a("fill-opacity","fillOpacity",o),a("opacity","opacity",o),a("stroke","stroke"),a("stroke-opacity","strokeOpacity",o),a("stroke-width","strokeWidth",s),a("stroke-linejoin","strokeLineJoin"),a("stroke-linecap","strokeLineCap"),a("stroke-miterlimit","strokeMiterLimit",s),a("visibility","visibility"),t}function o(e,t){return e-(t-e)}function s(e){if("string"!==typeof e)throw new TypeError("Invalid input: "+typeof e);var t={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i},r=0,n=!0,i=[],a="",o="";function s(e,t,r){var n=new SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw n.partial=r,n}function c(){""!==a&&(""===o?i.push(Number(a)):i.push(Number(a)*Math.pow(10,Number(o)))),a="",o=""}var u,l=0,p=e.length;for(l=0;l<p;l++){if(u=e[l],0===r){if(t.WHITESPACE.test(u))continue;if(t.DIGIT.test(u)||t.SIGN.test(u)){r=1,a=u;continue}if(t.POINT.test(u)){r=2,a=u;continue}t.COMMA.test(u)&&(n&&s(u,l,i),n=!0)}if(1===r){if(t.DIGIT.test(u)){a+=u;continue}if(t.POINT.test(u)){a+=u,r=2;continue}if(t.EXP.test(u)){r=3;continue}t.SIGN.test(u)&&1===a.length&&t.SIGN.test(a[0])&&s(u,l,i)}if(2===r){if(t.DIGIT.test(u)){a+=u;continue}if(t.EXP.test(u)){r=3;continue}t.POINT.test(u)&&"."===a[a.length-1]&&s(u,l,i)}if(3==r){if(t.DIGIT.test(u)){o+=u;continue}if(t.SIGN.test(u)){if(""===o){o+=u;continue}1===o.length&&t.SIGN.test(o)&&s(u,l,i)}}t.WHITESPACE.test(u)?(c(),r=0,n=!1):t.COMMA.test(u)?(c(),r=0,n=!0):t.SIGN.test(u)?(c(),r=1,a=u):t.POINT.test(u)?(c(),r=2,a=u):s(u,l,i)}return c(),i}var c=["mm","cm","in","pt","pc","px"],u={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function l(e){var r="px";if("string"===typeof e||e instanceof String)for(var n=0,i=c.length;n<i;n++){var a=c[n];if(e.endsWith(a)){r=a,e=e.substring(0,e.length-a.length);break}}var o=void 0;return"px"===r&&"px"!==t.defaultUnit?o=u.in[t.defaultUnit]/t.defaultDPI:(o=u[r][t.defaultUnit])<0&&(o=u[r].in*t.defaultDPI),o*parseFloat(e)}function p(e){var t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function h(e){var t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}var f=[],d={},v=[],m=new n.aA,g=new n.aA,y=new n.aA,E=new n.aA,T=new n.a,x=new n.V,A=new n.aA,b=(new DOMParser).parseFromString(e,"image/svg+xml");return function e(t,i){if(1===t.nodeType){var c=function(e){if(!(e.hasAttribute("transform")||"use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))))return null;var t=function(e){var t=new n.aA,r=m;if("use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))){var i=l(e.getAttribute("x")),a=l(e.getAttribute("y"));t.translate(i,a)}if(e.hasAttribute("transform"))for(var o=e.getAttribute("transform").split(")"),c=o.length-1;c>=0;c--){var u=o[c].trim();if(""!==u){var p=u.indexOf("("),h=u.length;if(p>0&&p<h){var f=u.substr(0,p),d=s(u.substr(p+1,h-p-1));switch(r.identity(),f){case"translate":if(d.length>=1){a=i=d[0];d.length>=2&&(a=d[1]),r.translate(i,a)}break;case"rotate":if(d.length>=1){var v=0,T=0,x=0;v=-d[0]*Math.PI/180,d.length>=3&&(T=d[1],x=d[2]),g.identity().translate(-T,-x),y.identity().rotate(v),E.multiplyMatrices(y,g),g.identity().translate(T,x),r.multiplyMatrices(g,E)}break;case"scale":if(d.length>=1){var A=d[0],b=A;d.length>=2&&(b=d[1]),r.scale(A,b)}break;case"skewX":1===d.length&&r.set(1,Math.tan(d[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===d.length&&r.set(1,0,0,Math.tan(d[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===d.length&&r.set(d[0],d[2],d[4],d[1],d[3],d[5],0,0,1)}}t.premultiply(r)}}return t}(e);v.length>0&&t.premultiply(v[v.length-1]);return A.copy(t),v.push(t),t}(t),u=!0,b=null;switch(t.nodeName){case"svg":break;case"style":!function(e){if(!e.sheet||!e.sheet.cssRules||!e.sheet.cssRules.length)return;for(var t=0;t<e.sheet.cssRules.length;t++){var r=e.sheet.cssRules[t];if(1===r.type)for(var n=r.selectorText.split(/,/gm).filter(Boolean).map((e=>e.trim())),i=0;i<n.length;i++)d[n[i]]=Object.assign(d[n[i]]||{},r.style)}}(t);break;case"g":i=a(t,i);break;case"path":i=a(t,i),t.hasAttribute("d")&&(b=function(e){for(var t=new n.aB,i=new n.a,a=new n.a,c=new n.a,u=!0,l=!1,p=e.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi),h=0,f=p.length;h<f;h++){var d=p[h],v=d.charAt(0),m=d.substr(1).trim();switch(!0===u&&(l=!0,u=!1),v){case"M":for(var g=0,y=(A=s(m)).length;g<y;g+=2)i.x=A[g+0],i.y=A[g+1],a.x=i.x,a.y=i.y,0===g?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y),0===g&&!0===l&&c.copy(i);break;case"H":for(g=0,y=(A=s(m)).length;g<y;g++)i.x=A[g],a.x=i.x,a.y=i.y,t.lineTo(i.x,i.y),0===g&&!0===l&&c.copy(i);break;case"V":for(g=0,y=(A=s(m)).length;g<y;g++)i.y=A[g],a.x=i.x,a.y=i.y,t.lineTo(i.x,i.y),0===g&&!0===l&&c.copy(i);break;case"L":for(g=0,y=(A=s(m)).length;g<y;g+=2)i.x=A[g+0],i.y=A[g+1],a.x=i.x,a.y=i.y,t.lineTo(i.x,i.y),0===g&&!0===l&&c.copy(i);break;case"C":for(g=0,y=(A=s(m)).length;g<y;g+=6)t.bezierCurveTo(A[g+0],A[g+1],A[g+2],A[g+3],A[g+4],A[g+5]),a.x=A[g+2],a.y=A[g+3],i.x=A[g+4],i.y=A[g+5],0===g&&!0===l&&c.copy(i);break;case"S":for(g=0,y=(A=s(m)).length;g<y;g+=4)t.bezierCurveTo(o(i.x,a.x),o(i.y,a.y),A[g+0],A[g+1],A[g+2],A[g+3]),a.x=A[g+0],a.y=A[g+1],i.x=A[g+2],i.y=A[g+3],0===g&&!0===l&&c.copy(i);break;case"Q":for(g=0,y=(A=s(m)).length;g<y;g+=4)t.quadraticCurveTo(A[g+0],A[g+1],A[g+2],A[g+3]),a.x=A[g+0],a.y=A[g+1],i.x=A[g+2],i.y=A[g+3],0===g&&!0===l&&c.copy(i);break;case"T":for(g=0,y=(A=s(m)).length;g<y;g+=2){var E=o(i.x,a.x),T=o(i.y,a.y);t.quadraticCurveTo(E,T,A[g+0],A[g+1]),a.x=E,a.y=T,i.x=A[g+0],i.y=A[g+1],0===g&&!0===l&&c.copy(i)}break;case"A":for(g=0,y=(A=s(m)).length;g<y;g+=7)if(A[g+5]!=i.x||A[g+6]!=i.y){var x=i.clone();i.x=A[g+5],i.y=A[g+6],a.x=i.x,a.y=i.y,r(t,A[g],A[g+1],A[g+2],A[g+3],A[g+4],x,i),0===g&&!0===l&&c.copy(i)}break;case"m":for(g=0,y=(A=s(m)).length;g<y;g+=2)i.x+=A[g+0],i.y+=A[g+1],a.x=i.x,a.y=i.y,0===g?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y),0===g&&!0===l&&c.copy(i);break;case"h":for(g=0,y=(A=s(m)).length;g<y;g++)i.x+=A[g],a.x=i.x,a.y=i.y,t.lineTo(i.x,i.y),0===g&&!0===l&&c.copy(i);break;case"v":for(g=0,y=(A=s(m)).length;g<y;g++)i.y+=A[g],a.x=i.x,a.y=i.y,t.lineTo(i.x,i.y),0===g&&!0===l&&c.copy(i);break;case"l":for(g=0,y=(A=s(m)).length;g<y;g+=2)i.x+=A[g+0],i.y+=A[g+1],a.x=i.x,a.y=i.y,t.lineTo(i.x,i.y),0===g&&!0===l&&c.copy(i);break;case"c":for(g=0,y=(A=s(m)).length;g<y;g+=6)t.bezierCurveTo(i.x+A[g+0],i.y+A[g+1],i.x+A[g+2],i.y+A[g+3],i.x+A[g+4],i.y+A[g+5]),a.x=i.x+A[g+2],a.y=i.y+A[g+3],i.x+=A[g+4],i.y+=A[g+5],0===g&&!0===l&&c.copy(i);break;case"s":for(g=0,y=(A=s(m)).length;g<y;g+=4)t.bezierCurveTo(o(i.x,a.x),o(i.y,a.y),i.x+A[g+0],i.y+A[g+1],i.x+A[g+2],i.y+A[g+3]),a.x=i.x+A[g+0],a.y=i.y+A[g+1],i.x+=A[g+2],i.y+=A[g+3],0===g&&!0===l&&c.copy(i);break;case"q":for(g=0,y=(A=s(m)).length;g<y;g+=4)t.quadraticCurveTo(i.x+A[g+0],i.y+A[g+1],i.x+A[g+2],i.y+A[g+3]),a.x=i.x+A[g+0],a.y=i.y+A[g+1],i.x+=A[g+2],i.y+=A[g+3],0===g&&!0===l&&c.copy(i);break;case"t":for(g=0,y=(A=s(m)).length;g<y;g+=2){E=o(i.x,a.x),T=o(i.y,a.y);t.quadraticCurveTo(E,T,i.x+A[g+0],i.y+A[g+1]),a.x=E,a.y=T,i.x=i.x+A[g+0],i.y=i.y+A[g+1],0===g&&!0===l&&c.copy(i)}break;case"a":var A;for(g=0,y=(A=s(m)).length;g<y;g+=7)if(0!=A[g+5]||0!=A[g+6]){x=i.clone();i.x+=A[g+5],i.y+=A[g+6],a.x=i.x,a.y=i.y,r(t,A[g],A[g+1],A[g+2],A[g+3],A[g+4],x,i),0===g&&!0===l&&c.copy(i)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(i.copy(c),t.currentPath.currentPoint.copy(i),u=!0);break;default:console.warn(d)}l=!1}return t}(t));break;case"rect":i=a(t,i),b=function(e){var t=l(e.getAttribute("x")||0),r=l(e.getAttribute("y")||0),i=l(e.getAttribute("rx")||0),a=l(e.getAttribute("ry")||0),o=l(e.getAttribute("width")),s=l(e.getAttribute("height")),c=new n.aB;c.moveTo(t+2*i,r),c.lineTo(t+o-2*i,r),(0!==i||0!==a)&&c.bezierCurveTo(t+o,r,t+o,r,t+o,r+2*a);c.lineTo(t+o,r+s-2*a),(0!==i||0!==a)&&c.bezierCurveTo(t+o,r+s,t+o,r+s,t+o-2*i,r+s);c.lineTo(t+2*i,r+s),(0!==i||0!==a)&&c.bezierCurveTo(t,r+s,t,r+s,t,r+s-2*a);c.lineTo(t,r+2*a),(0!==i||0!==a)&&c.bezierCurveTo(t,r,t,r,t+2*i,r);return c}(t);break;case"polygon":i=a(t,i),b=function(e){function t(e,t,r){var n=l(t),o=l(r);0===a?i.moveTo(n,o):i.lineTo(n,o),a++}var r=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,i=new n.aB,a=0;return e.getAttribute("points").replace(r,t),i.currentPath.autoClose=!0,i}(t);break;case"polyline":i=a(t,i),b=function(e){function t(e,t,r){var n=l(t),o=l(r);0===a?i.moveTo(n,o):i.lineTo(n,o),a++}var r=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,i=new n.aB,a=0;return e.getAttribute("points").replace(r,t),i.currentPath.autoClose=!1,i}(t);break;case"circle":i=a(t,i),b=function(e){var t=l(e.getAttribute("cx")),r=l(e.getAttribute("cy")),i=l(e.getAttribute("r")),a=new n.aC;a.absarc(t,r,i,0,2*Math.PI);var o=new n.aB;return o.subPaths.push(a),o}(t);break;case"ellipse":i=a(t,i),b=function(e){var t=l(e.getAttribute("cx")),r=l(e.getAttribute("cy")),i=l(e.getAttribute("rx")),a=l(e.getAttribute("ry")),o=new n.aC;o.absellipse(t,r,i,a,0,2*Math.PI);var s=new n.aB;return s.subPaths.push(o),s}(t);break;case"line":i=a(t,i),b=function(e){var t=l(e.getAttribute("x1")),r=l(e.getAttribute("y1")),i=l(e.getAttribute("x2")),a=l(e.getAttribute("y2")),o=new n.aB;return o.moveTo(t,r),o.lineTo(i,a),o.currentPath.autoClose=!1,o}(t);break;case"defs":u=!1;break;case"use":i=a(t,i);var w=t.href.baseVal.substring(1),R=t.viewportElement.getElementById(w);R?e(R,i):console.warn("SVGLoader: 'use node' references non-existent node id: "+w)}if(b&&(void 0!==i.fill&&"none"!==i.fill&&b.color.setStyle(i.fill),function(e,t){function r(e){x.set(e.x,e.y,1).applyMatrix3(t),e.set(x.x,x.y)}for(var n=function(e){return 0!==e.elements[1]||0!==e.elements[3]}(t),i=e.subPaths,a=0,o=i.length;a<o;a++)for(var s=i[a].curves,c=0;c<s.length;c++){var u=s[c];u.isLineCurve?(r(u.v1),r(u.v2)):u.isCubicBezierCurve?(r(u.v0),r(u.v1),r(u.v2),r(u.v3)):u.isQuadraticBezierCurve?(r(u.v0),r(u.v1),r(u.v2)):u.isEllipseCurve&&(n&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),T.set(u.aX,u.aY),r(T),u.aX=T.x,u.aY=T.y,u.xRadius*=p(t),u.yRadius*=h(t))}}(b,A),f.push(b),b.userData={node:t,style:i}),u)for(var N=t.childNodes,_=0;_<N.length;_++)e(N[_],i);c&&(v.pop(),v.length>0?A.copy(v[v.length-1]):A.identity())}}(b.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:f,xml:b.documentElement}}}),Ct.getStrokeStyle=function(e,t,r,n,i){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:r=void 0!==r?r:"miter",strokeLineCap:n=void 0!==n?n:"butt",strokeMiterLimit:i=void 0!==i?i:4}},Ct.pointsToStroke=function(e,t,r,i){var a=[],o=[],s=[];if(0===Ct.pointsToStrokeWithBuffers(e,t,r,i,a,o,s))return null;var c=new n.B;return c.setAttribute("position",new n.d(a,3)),c.setAttribute("normal",new n.d(o,3)),c.setAttribute("uv",new n.d(s,2)),c},Ct.pointsToStrokeWithBuffers=function(){var e=new n.a,t=new n.a,r=new n.a,i=new n.a,a=new n.a,o=new n.a,s=new n.a,c=new n.a,u=new n.a,l=new n.a,p=new n.a,h=new n.a,f=new n.a,d=new n.a,v=new n.a,m=new n.a,g=new n.a;return function(n,y,E,T,x,A,b,w){E=void 0!==E?E:12,T=void 0!==T?T:.001,w=void 0!==w?w:0;var R=(n=function(e){for(var t=!1,r=1,n=e.length-1;r<n;r++)if(e[r].distanceTo(e[r+1])<T){t=!0;break}if(!t)return e;var i=[];i.push(e[0]);for(r=1,n=e.length-1;r<n;r++)e[r].distanceTo(e[r+1])>=T&&i.push(e[r]);return i.push(e[e.length-1]),i}(n)).length;if(R<2)return 0;var N,_,S,k,I,L=n[0].equals(n[R-1]),O=n[0],C=y.strokeWidth/2,M=1/(R-1),P=0,F=!1,D=0,U=3*w,j=2*w;$(n[0],n[1],e).multiplyScalar(C),c.copy(n[0]).sub(e),u.copy(n[0]).add(e),l.copy(c),p.copy(u);for(var V=1;V<R;V++){N=n[V],_=V===R-1?L?n[1]:void 0:n[V+1];var B=e;$(O,N,B),r.copy(B).multiplyScalar(C),h.copy(N).sub(r),f.copy(N).add(r);var H=P+M;if(S=!1,void 0!==_){$(N,_,t),r.copy(t).multiplyScalar(C),d.copy(N).sub(r),v.copy(N).add(r),k=!0,r.subVectors(_,O),B.dot(r)<0&&(k=!1),1===V&&(F=k),r.subVectors(_,N),r.normalize();var G=Math.abs(B.dot(r));if(0!==G){var z=C/G;r.multiplyScalar(-z),i.subVectors(N,O),a.copy(i).setLength(z).add(r),m.copy(a).negate();var W=a.length(),K=i.length();i.divideScalar(K),o.subVectors(_,N);var X=o.length();switch(o.divideScalar(X),i.dot(m)<K&&o.dot(m)<X&&(S=!0),g.copy(a).add(N),m.add(N),I=!1,S?k?(v.copy(m),f.copy(m)):(d.copy(m),h.copy(m)):ee(),y.strokeLineJoin){case"bevel":te(k,S,H);break;case"round":re(k,S),k?Q(N,h,d,H,0):Q(N,v,f,H,1);break;case"miter":case"miter-clip":default:var q=C*y.strokeMiterLimit/W;if(q<1){if("miter-clip"!==y.strokeLineJoin){te(k,S,H);break}re(k,S),k?(o.subVectors(g,h).multiplyScalar(q).add(h),s.subVectors(g,d).multiplyScalar(q).add(d),J(h,H,0),J(o,H,0),J(N,H,.5),J(N,H,.5),J(o,H,0),J(s,H,0),J(N,H,.5),J(s,H,0),J(d,H,0)):(o.subVectors(g,f).multiplyScalar(q).add(f),s.subVectors(g,v).multiplyScalar(q).add(v),J(f,H,1),J(o,H,1),J(N,H,.5),J(N,H,.5),J(o,H,1),J(s,H,1),J(N,H,.5),J(s,H,1),J(v,H,1))}else S?(k?(J(u,P,1),J(c,P,0),J(g,H,0),J(u,P,1),J(g,H,0),J(m,H,1)):(J(u,P,1),J(c,P,0),J(g,H,1),J(c,P,0),J(m,H,0),J(g,H,1)),k?d.copy(g):v.copy(g)):k?(J(h,H,0),J(g,H,0),J(N,H,.5),J(N,H,.5),J(g,H,0),J(d,H,0)):(J(f,H,1),J(g,H,1),J(N,H,.5),J(N,H,.5),J(g,H,1),J(v,H,1)),I=!0}}else ee()}else ee();L||V!==R-1||ne(n[0],l,p,k,!0,P),P=H,O=N,c.copy(d),u.copy(v)}if(L){if(S&&x){var Y=g,Z=m;F!==k&&(Y=m,Z=g),k?(I||F)&&(Z.toArray(x,0),Z.toArray(x,9),I&&Y.toArray(x,3)):!I&&F||(Z.toArray(x,3),Z.toArray(x,9),I&&Y.toArray(x,0))}}else ne(N,h,f,k,!1,H);return D;function $(e,t,r){return r.subVectors(t,e),r.set(-r.y,r.x).normalize()}function J(e,t,r){x&&(x[U]=e.x,x[U+1]=e.y,x[U+2]=0,A&&(A[U]=0,A[U+1]=0,A[U+2]=1),U+=3,b&&(b[j]=t,b[j+1]=r,j+=2)),D+=3}function Q(n,a,o,s,c){e.copy(a).sub(n).normalize(),t.copy(o).sub(n).normalize();var u=Math.PI,l=e.dot(t);Math.abs(l)<1&&(u=Math.abs(Math.acos(l))),u/=E,r.copy(a);for(var p=0,h=E-1;p<h;p++)i.copy(r).rotateAround(n,u),J(r,s,c),J(i,s,c),J(n,s,.5),r.copy(i);J(i,s,c),J(o,s,c),J(n,s,.5)}function ee(){J(u,P,1),J(c,P,0),J(h,H,0),J(u,P,1),J(h,H,1),J(f,H,0)}function te(e,t,r){t?e?(J(u,P,1),J(c,P,0),J(h,H,0),J(u,P,1),J(h,H,0),J(m,H,1),J(h,r,0),J(d,r,0),J(m,r,.5)):(J(u,P,1),J(c,P,0),J(f,H,1),J(c,P,0),J(m,H,0),J(f,H,1),J(f,r,1),J(v,r,0),J(m,r,.5)):e?(J(h,r,0),J(d,r,0),J(N,r,.5)):(J(f,r,1),J(v,r,0),J(N,r,.5))}function re(e,t){t&&(e?(J(u,P,1),J(c,P,0),J(h,H,0),J(u,P,1),J(h,H,0),J(m,H,1),J(h,P,0),J(N,H,.5),J(m,H,1),J(N,H,.5),J(d,P,0),J(m,H,1)):(J(u,P,1),J(c,P,0),J(f,H,1),J(c,P,0),J(m,H,0),J(f,H,1),J(f,P,1),J(m,H,0),J(N,H,.5),J(N,H,.5),J(m,H,0),J(v,P,1)))}function ne(n,a,o,s,c,u){switch(y.strokeLineCap){case"round":c?Q(n,o,a,u,.5):Q(n,a,o,u,.5);break;case"square":if(c)e.subVectors(a,n),t.set(e.y,-e.x),r.addVectors(e,t).add(n),i.subVectors(t,e).add(n),s?(r.toArray(x,3),i.toArray(x,0),i.toArray(x,9)):(r.toArray(x,3),r.toArray(x,9),i.toArray(x,0));else{e.subVectors(o,n),t.set(e.y,-e.x),r.addVectors(e,t).add(n),i.subVectors(t,e).add(n);var l=x.length;s?(r.toArray(x,l-3),i.toArray(x,l-6),i.toArray(x,l-12)):(r.toArray(x,l-6),i.toArray(x,l-3),i.toArray(x,l-12))}}}}}(),n.U.DefaultUp.set(0,0,1);var Mt="hotpink",Pt=function(e,t,r){e.isMesh?(r&&(e.castShadow=!0,e.receiveShadow=!0),1!==t&&(e.material.isMaterial?(e.material.transparent=!0,e.material.opacity=t):Array.isArray(e.material)&&e.material.forEach((function(e){e.transparent=!0,e.opacity=t})))):"PointLight"===e.type?e.visible=!1:(e.isObject3D||e.isGroup)&&e.children.forEach((function(e){Pt(e,t,r)}))},Ft=function(e){var t=(0,n.aD)(a,e.url),r=(0,i.useMemo)((function(){return t.clone()}),[t]);return i.createElement("mesh",{position:[e.t[0],e.t[1],e.t[2]],quaternion:[e.q[0],e.q[1],e.q[2],e.q[3]],scale:[e.scale[0],e.scale[1],e.scale[2]],castShadow:!0,receiveShadow:!0,name:"loaded"},i.createElement("primitive",{object:r,attach:"geometry"}),i.createElement("meshStandardMaterial",{color:e.color?e.color:Mt,transparent:1!==e.opacity,opacity:e.opacity?e.opacity:1}))},Dt=function(e){var t=(0,n.aD)(o,e.url);return(0,i.useEffect)((function(){t.scene.children.forEach((function(t){Pt(t,e.opacity,!0)}))})),i.createElement("mesh",{position:[e.t[0],e.t[1],e.t[2]],quaternion:[e.q[0],e.q[1],e.q[2],e.q[3]],scale:[e.scale[0],e.scale[1],e.scale[2]],castShadow:!0,receiveShadow:!0},i.createElement("primitive",{object:t.scene,opacity:e.opacity,castShadow:!0,receiveShadow:!0}))},Ut=function(e){var t=(0,n.aD)(c,e.url),r=(0,i.useMemo)((function(){return t.scene.clone()}),[t.scene]);return(0,i.useEffect)((function(){r.children.forEach((function(t){Pt(t,e.opacity,!0)})),r.name="loaded"})),i.createElement("primitive",{object:r,position:e.t,scale:e.scale,quaternion:e.q})},jt=function(e){var t=e.url.slice(0,e.url.length-3)+"mtl",r=(0,n.aD)(h,t),a=(0,n.aD)(p,e.url,(function(e){r.preload()}));return(0,i.useEffect)((function(){a.children.forEach((function(t){Pt(t,e.opacity,!0)}))})),i.createElement("mesh",{position:[e.t[0],e.t[1],e.t[2]],quaternion:[e.q[0],e.q[1],e.q[2],e.q[3]],scale:[e.scale[0],e.scale[1],e.scale[2]],castShadow:!0,receiveShadow:!0},i.createElement("primitive",{object:a}))},Vt=function(e){var t=(0,n.aD)(d,e.url);return(0,i.useEffect)((function(){t.children.forEach((function(t){Pt(t,e.opacity,!0)}))})),i.createElement("mesh",{position:[e.t[0],e.t[1],e.t[2]],quaternion:[e.q[0],e.q[1],e.q[2],e.q[3]],scale:[e.scale[0],e.scale[1],e.scale[2]],castShadow:!0,receiveShadow:!0},i.createElement("primitive",{object:t}))},Bt=function(e){var t=(0,n.aD)(v,e.url);return(0,i.useEffect)((function(){})),i.createElement("mesh",{position:[e.t[0],e.t[1],e.t[2]],quaternion:[e.q[0],e.q[1],e.q[2],e.q[3]],scale:[e.scale[0],e.scale[1],e.scale[2]],castShadow:!0,receiveShadow:!0},i.createElement("primitive",{object:t}))},Ht=function(e){var t=(0,n.aD)(m,e.url);return i.createElement("mesh",{position:[e.t[0],e.t[1],e.t[2]],quaternion:[e.q[0],e.q[1],e.q[2],e.q[3]],scale:[e.scale[0],e.scale[1],e.scale[2]],castShadow:!0,receiveShadow:!0},i.createElement("primitive",{object:t,attach:"geometry"}),i.createElement("meshStandardMaterial",{color:e.color?e.color:Mt,transparent:1!==e.opacity,opacity:e.opacity?e.opacity:1}))},Gt=function(e){var t=(0,n.aD)(Ot,e.url);return(0,i.useEffect)((function(){t.children.forEach((function(t){Pt(t,e.opacity,!0)}))})),i.createElement("mesh",{position:[e.t[0],e.t[1],e.t[2]],quaternion:[e.q[0],e.q[1],e.q[2],e.q[3]],scale:[e.scale[0],e.scale[1],e.scale[2]],castShadow:!0,receiveShadow:!0},i.createElement("primitive",{object:t}))},zt=function(e){var t=e.shape,r=e.color,n=e.index,a=e.opacity;return i.createElement("mesh",null,i.createElement("meshLambertMaterial",{attach:"material",color:r,polygonOffset:!0,polygonOffsetFactor:-.1*n,transparent:1!==a,opacity:a||1}),i.createElement("shapeBufferGeometry",{attach:"geometry",args:[t]}))},Wt=i.memo((function(e){var t=(0,n.aD)(Ct,e.url).paths,r=(0,i.useMemo)((function(){return t.flatMap((function(e,t){return e.toShapes(!0).map((function(r){return{index:t,shape:r,color:e.color}}))}))}),[t]);return i.createElement("group",{children:r.map((function(t,r){return i.createElement(zt,(0,n.aE)({key:r,opacity:e.opacity},t))})),scale:[-.01*e.scale[0],.01*e.scale[1],.01*e.scale[2]],position:[e.t[0],e.t[1],e.t[2]],quaternion:[e.q[0],e.q[1],e.q[2],e.q[3]]})}));t.default=function(e){var t=e.filename.split(".").pop().toLowerCase(),r=e.filename;switch(r="retrieve/"+r,t){case"stl":return i.createElement(Ft,(0,n.aE)({url:r},e));case"gltf":case"glb":return i.createElement(Dt,(0,n.aE)({url:r},e));case"dae":return i.createElement(Ut,(0,n.aE)({url:r},e));case"obj":return i.createElement(jt,(0,n.aE)({url:r},e));case"wrl":return i.createElement(Vt,(0,n.aE)({url:r},e));case"pcd":return i.createElement(Bt,(0,n.aE)({url:r},e));case"ply":return i.createElement(Ht,(0,n.aE)({url:r},e));case"fbx":return i.createElement(Gt,(0,n.aE)({url:r},e));case"svg":return i.createElement(Wt,(0,n.aE)({url:r},e));default:return i.createElement(Ut,(0,n.aE)({url:r},e))}}}}]);